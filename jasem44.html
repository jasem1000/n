هذا مجلد نظام عياده طبيب اريد اطوره يرسل رسائل تذكير بقرب مراجعة المريض عبر الواتساب تلقائي دون تدخل مني ويكون مجاني يرسل 1000 رساله بلشهر وهذه الاكود مع اسم ملفه اريد ترسلي الاكواد المعدله كامله والخطوات بلتفصيل                                       api.php         <?php

header('Content-Type: text/html; charset=utf-8');

include 'db.php';



$action = $_GET['action'] ?? '';



switch ($action) {

    case 'add_patient':

        add_patient($conn);

        break;

    case 'get_waiting':

        get_waiting_list($conn);

        break;

    case 'get_doctor_list':

        get_doctor_list($conn);

        break;

    case 'update_visit':

        update_visit($conn);

        break;

    case 'search_patients':

        search_patients($conn);

        break;

    case 'get_patient_history':

        get_patient_history($conn);

        break;

    case 'get_stats':

        get_stats($conn);

        break;

    case 'add_inventory':  // جديد: إضافة مادة إلى المخزن

        add_inventory($conn);

        break;

    case 'get_inventory':  // جديد: جلب قائمة المخزن

        get_inventory($conn);

        break;

    case 'update_inventory':  // جديد: تحديث مادة

        update_inventory($conn);

        break;

    case 'delete_inventory':  // جديد: حذف مادة

        delete_inventory($conn);

        break;

    case 'get_upcoming_reviews':  // جديد: جلب المراجعات القادمة للتذكيرات

        get_upcoming_reviews($conn);

        break;

    default:

        echo "Invalid Action";

}



function add_patient($conn) {

    $name = $_POST['name'];

    $age = $_POST['age'];

    $price = $_POST['price'];

    $phone = '+964' . preg_replace('/\D/', '', $_POST['phone']);  // ثابت +964، تنظيف الأرقام

    $today = date("Y-m-d");



    // تحقق إذا كان المريض موجوداً

    $stmt = $conn->prepare("SELECT id FROM patients WHERE patient_name = ? AND patient_age = ?");

    $stmt->bind_param("si", $name, $age);

    $stmt->execute();

    $result = $stmt->get_result();

    if ($result->num_rows > 0) {

        $patient = $result->fetch_assoc();

        $patient_id = $patient['id'];

        // تحديث الهاتف إذا تغير

        $stmt_update = $conn->prepare("UPDATE patients SET phone = ? WHERE id = ?");

        $stmt_update->bind_param("si", $phone, $patient_id);

        $stmt_update->execute();

    } else {

        $stmt_insert = $conn->prepare("INSERT INTO patients (patient_name, patient_age, phone) VALUES (?, ?, ?)");

        $stmt_insert->bind_param("sis", $name, $age, $phone);

        $stmt_insert->execute();

        $patient_id = $stmt_insert->insert_id;

    }



    // إضافة الزيارة

    $stmt = $conn->prepare("INSERT INTO visits (patient_id, ticket_price, visit_date) VALUES (?, ?, ?)");

    $stmt->bind_param("ids", $patient_id, $price, $today);

    $stmt->execute();



    echo "Success";

}



function get_waiting_list($conn) {

    $today = date("Y-m-d");

    // تعديل: عرض فقط المرضى غير المشخصين (prescription IS NULL)

    $result = $conn->query("SELECT p.patient_name, p.patient_age FROM patients p JOIN visits v ON p.id = v.patient_id WHERE v.visit_date = '$today' AND v.prescription IS NULL ORDER BY v.id ASC");

    $output = "<ul class='list-group'>";

    if ($result->num_rows > 0) {

        while ($row = $result->fetch_assoc()) {

            $output .= "<li class='list-group-item'>{$row['patient_name']} ({$row['patient_age']} سنة)</li>";

        }

    } else {

        $output .= "<li class='list-group-item'>لا يوجد مرضى في قائمة الانتظار.</li>";

    }

    $output .= "</ul>";

    echo $output;

}



function get_doctor_list($conn) {

    $today = date("Y-m-d");

    // تعديل: عرض فقط المرضى غير المشخصين (prescription IS NULL)

    $result = $conn->query("SELECT p.patient_name, p.patient_age, v.id as visit_id, v.prescription, v.notes FROM patients p JOIN visits v ON p.id = v.patient_id WHERE v.visit_date = '$today' AND v.prescription IS NULL ORDER BY v.id ASC");

    if ($result->num_rows === 0) {

        echo "<p>لا يوجد مرضى اليوم.</p>";

        return;

    }

    while ($row = $result->fetch_assoc()) {

        $status = empty($row['prescription']) ? "بانتظار التشخيص" : "تم التشخيص";

        $buttons = "";

        if (empty($row['prescription'])) {

            $buttons = "<button class='add-details-btn btn btn-primary' data-id='{$row['visit_id']}' data-name='{$row['patient_name']}'>إضافة تفاصيل</button>";

        } else {

            $print_data = http_build_query([

                'patient_name' => $row['patient_name'],

                'prescription' => $row['prescription'],

                'notes' => $row['notes']

            ]);

            $buttons = "<button onclick=\"window.open('print.html?{$print_data}', '_blank', 'width=800,height=600')\" class='print-btn btn btn-success'>طباعة</button>";

        }



        echo "<div class='patient-card card mb-2'>

                <div class='card-body d-flex justify-content-between align-items-center'>

                    <span><strong>{$row['patient_name']}</strong> ({$row['patient_age']} سنة) - <small>$status</small></span>

                    <div>{$buttons}</div>

                </div>

              </div>";

    }

}



function update_visit($conn) {

    $visit_id = $_POST['visit_id'];

    $prescription = $_POST['prescription'];

    $notes = $_POST['notes'];

    $next_review = $_POST['next_review'] ?? null;  // جديد: تاريخ المراجعة التالية

    $image_path = null;



    if (isset($_FILES['image']) && $_FILES['image']['error'] == 0) {

        $target_dir = "uploads/";

        if (!is_dir($target_dir)) {

            mkdir($target_dir, 0777, true);

        }

        $filename = time() . '_' . basename($_FILES["image"]["name"]);

        $target_file = $target_dir . $filename;

        if (move_uploaded_file($_FILES["image"]["tmp_name"], $target_file)) {

            $image_path = $target_file;

        }

    }

    

    $stmt = $conn->prepare("UPDATE visits SET prescription = ?, notes = ?, image_path = ?, next_review_date = ? WHERE id = ?");

    $stmt->bind_param("ssssi", $prescription, $notes, $image_path, $next_review, $visit_id);

    if ($stmt->execute()) {

        echo "Success";

    } else {

        echo "Error";

    }

}



function search_patients($conn) {

    $query = "%" . ($_GET['query'] ?? '') . "%";

    $stmt = $conn->prepare("SELECT id, patient_name, patient_age FROM patients WHERE patient_name LIKE ? ORDER BY patient_name LIMIT 10");

    $stmt->bind_param("s", $query);

    $stmt->execute();

    $result = $stmt->get_result();

    $output = "<ul class='list-group'>";

    if ($result->num_rows > 0) {

        while ($row = $result->fetch_assoc()) {

            $output .= "<li class='list-group-item patient-result' data-id='{$row['id']}'>{$row['patient_name']} ({$row['patient_age']} سنة)</li>";

        }

    } else {

        $output .= "<li class='list-group-item'>لا توجد نتائج.</li>";

    }

    $output .= "</ul>";

    echo $output;

}



function get_patient_history($conn) {

    $patient_id = $_GET['id'] ?? 0;

    $stmt = $conn->prepare("SELECT * FROM visits WHERE patient_id = ? ORDER BY visit_date DESC");

    $stmt->bind_param("i", $patient_id);

    $stmt->execute();

    $result = $stmt->get_result();

    $output = "";

    if ($result->num_rows > 0) {

        while ($row = $result->fetch_assoc()) {

            $image_tag = !empty($row['image_path']) ? "<p><a href='{$row['image_path']}' target='_blank'>عرض الصورة المرفقة</a></p>" : "";

            $output .= "<div class='visit-record card mb-3'>

                <div class='card-body'>

                    <h4 class='card-title'>تاريخ الزيارة: {$row['visit_date']}</h4>

                    <p class='card-text'><strong>الوصفة:</strong><br>" . nl2br(htmlspecialchars($row['prescription'])) . "</p>

                    <p class='card-text'><strong>ملاحظات:</strong><br>" . nl2br(htmlspecialchars($row['notes'])) . "</p>

                    {$image_tag}

                </div>

            </div>";

        }

    } else {

        $output = "<p>لا يوجد سجل زيارات لهذا المريض.</p>";

    }

    echo $output;

}



function get_stats($conn) {

    header('Content-Type: application/json; charset=utf-8');

    

    $today = date("Y-m-d");

    $month = date("m");

    $year = date("Y");



    $monthly = $conn->query("SELECT SUM(ticket_price) as total FROM visits WHERE MONTH(visit_date) = $month AND YEAR(visit_date) = $year")->fetch_assoc();

    $daily_income = $conn->query("SELECT SUM(ticket_price) as total FROM visits WHERE visit_date = '$today'")->fetch_assoc();

    $daily_visits = $conn->query("SELECT COUNT(id) as total FROM visits WHERE visit_date = '$today'")->fetch_assoc();

    $total_visits = $conn->query("SELECT COUNT(id) as total FROM visits")->fetch_assoc();



    $stats = [

        'monthly_income' => number_format($monthly['total'] ?? 0),

        'daily_income' => number_format($daily_income['total'] ?? 0),

        'daily_visits' => $daily_visits['total'] ?? 0,

        'total_visits' => $total_visits['total'] ?? 0,

    ];



    echo json_encode($stats);

}



// وظائف المخزن الجديدة

function add_inventory($conn) {

    $name = $_POST['name'];

    $quantity = $_POST['quantity'];

    $price = $_POST['price'];

    $description = $_POST['description'];

    $today = date("Y-m-d");



    $stmt = $conn->prepare("INSERT INTO inventory (name, quantity, price, description, added_date) VALUES (?, ?, ?, ?, ?)");

    $stmt->bind_param("sidss", $name, $quantity, $price, $description, $today);

    if ($stmt->execute()) {

        echo "Success";

    } else {

        echo "Error";

    }

}



function get_inventory($conn) {

    $result = $conn->query("SELECT * FROM inventory ORDER BY added_date DESC");

    $inventory = [];

    while ($row = $result->fetch_assoc()) {

        $inventory[] = $row;

    }

    echo json_encode($inventory);

}



function update_inventory($conn) {

    $id = $_POST['id'];

    $name = $_POST['name'];

    $quantity = $_POST['quantity'];

    $price = $_POST['price'];

    $description = $_POST['description'];



    $stmt = $conn->prepare("UPDATE inventory SET name = ?, quantity = ?, price = ?, description = ? WHERE id = ?");

    $stmt->bind_param("sidsi", $name, $quantity, $price, $description, $id);

    if ($stmt->execute()) {

        echo "Success";

    } else {

        echo "Error";

    }

}



function delete_inventory($conn) {

    $id = $_POST['id'];

    $stmt = $conn->prepare("DELETE FROM inventory WHERE id = ?");

    $stmt->bind_param("i", $id);

    if ($stmt->execute()) {

        echo "Success";

    } else {

        echo "Error";

    }

}



// جديد: جلب المراجعات القادمة (غداً أو اليوم)

function get_upcoming_reviews($conn) {

    $tomorrow = date("Y-m-d", strtotime("+1 day"));

    $today = date("Y-m-d");

    $stmt = $conn->prepare("SELECT p.patient_name, p.phone, v.next_review_date FROM patients p JOIN visits v ON p.id = v.patient_id WHERE v.next_review_date BETWEEN ? AND ? AND p.phone IS NOT NULL");

    $stmt->bind_param("ss", $today, $tomorrow);

    $stmt->execute();

    $result = $stmt->get_result();

    $reviews = [];

    while ($row = $result->fetch_assoc()) {

        $reviews[] = $row;

    }

    echo json_encode($reviews);

}



$conn->close();

?>                    db.php       <?php

// للرفع المجاني: استبدل بالبيانات من 000webhost (مثال: $servername = "sqlXXX.000webhost.com";)

$servername = "localhost";  // غير إلى host الجديد

$username = "root";         // غير إلى user الجديد

$password = "";             // غير إلى pass الجديد

$dbname = "clinic_db";      // غير إذا لزم



$conn = new mysqli($servername, $username, $password, $dbname);



if ($conn->connect_error) {

    die("Connection failed: " . $conn->connect_error);

}



$conn->set_charset("utf8mb4");  // دعم العربية

?>         doctor.js    $(document).ready(function() {

    const modal = $("#detailsModal");

    const modalPatientName = $("#modalPatientName");

    const visitIdInput = $("#visitId");



    function loadDoctorList() {

        $.get("api.php?action=get_doctor_list", function(data) {

            $("#doctorPatientList").html(data);

        }).fail(function() {

            $("#doctorPatientList").html("<p>خطأ في تحميل البيانات.</p>");

        });

    }



    $(document).on("click", ".add-details-btn", function() {

        const visitId = $(this).data("id");

        const patientName = $(this).data("name");

        

        $("#detailsForm")[0].reset();

        

        visitIdInput.val(visitId);

        modalPatientName.text(patientName);

        modal.show();

    });



    $(".close-button").click(() => modal.hide());

    $(window).click(function(event) {

        if ($(event.target).is(modal)) {

            modal.hide();

        }

    });



    $("#detailsForm").on("submit", function(e) {

        e.preventDefault();

        const formData = new FormData(this);



        $.ajax({

            url: 'api.php?action=update_visit',

            type: 'POST',

            data: formData,

            contentType: false,

            processData: false,

            success: function(response) {

                alert("تم تحديث بيانات الزيارة بنجاح!");

                modal.hide();

                loadDoctorList();

            },

            error: function() {

                alert("حدث خطأ أثناء حفظ البيانات.");

            }

        });

    });



    loadDoctorList();

    setInterval(loadDoctorList, 10000);

});                        footer.php      </div> </body>

               </html>  وهذا كود ملف      header.php     <!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title><?php echo isset($pageTitle) ? $pageTitle : "نظام العيادة"; ?></title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"> <!-- Bootstrap للتصميم الاحترافي -->

    <link rel="stylesheet" href="style.css">

</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">

        <div class="container-fluid">

            <a class="navbar-brand" href="#">نظام العيادة</a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">

                <span class="navbar-toggler-icon"></span>

            </button>

            <div class="collapse navbar-collapse" id="navbarNav">

                <ul class="navbar-nav">

                    <li class="nav-item"><a class="nav-link" href="secretary.php">واجهة السكرتير</a></li>

                    <li class="nav-item"><a class="nav-link" href="doctor.php">واجهة الطبيب</a></li>

                    <li class="nav-item"><a class="nav-link" href="history.php">سجل المرضى</a></li>

                    <li class="nav-item"><a class="nav-link" href="stats.php">الإحصائيات</a></li>

                    <li class="nav-item"><a class="nav-link" href="inventory.php">المخزن</a></li> <!-- جديد -->

                    <li class="nav-item"><a class="nav-link" href="reminders.php">التذكيرات</a></li> <!-- جديد -->

                </ul>

            </div>

        </div>

    </nav>

    <div class="container mt-4">

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>  وهذا كود    history.php     <?php $pageTitle = "سجل المرضى"; include 'header.php'; ?>



<h1>البحث في سجلات المرضى</h1>

<input type="text" id="searchInput" placeholder="اكتب اسم المريض للبحث...">

<div id="searchResults"></div>

<hr>

<div id="history-details">

    <h3>تفاصيل الزيارات</h3>

    <div id="visit-list">

        <p>ابحث عن مريض لعرض سجل زياراته.</p>

    </div>

</div>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

$(document).ready(function() {

    // Search patients as user types (debounced for performance)

    let searchTimeout;

    $("#searchInput").on("keyup", function() {

        clearTimeout(searchTimeout);

        let query = $(this).val();

        

        if (query.length > 1) {

            searchTimeout = setTimeout(function() {

                $.get(`api.php?action=search_patients&query=${query}`, function(data) {

                    $("#searchResults").html(data).show();

                });

            }, 300); // Wait 300ms after user stops typing

        } else {

            $("#searchResults").html("").hide();

        }

    });



    // Get history for a selected patient

    $(document).on("click", ".patient-result", function() {

        let patientId = $(this).data("id");

        let patientName = $(this).text();

        $("#searchInput").val(patientName);

        $("#searchResults").hide();

        

        $("#visit-list").html("<p>جاري تحميل السجل...</p>");

        $.get(`api.php?action=get_patient_history&id=${patientId}`, function(data) {

            $("#visit-list").html(data);

        });

    });

});

</script>



<?php include 'footer.php'; ?>  وهذا   print.html       <!DOCTYPE html>

<html lang="ar" dir="rtl">

<head>

    <meta charset="UTF-8">

    <title>طباعة وصفة طبية</title>

    <style>

        body { font-family: Arial, sans-serif; margin: 25px; }

        .prescription { border: 1px solid #000; padding: 20px; width: 100%; box-sizing: border-box; }

        h1 { text-align: center; color: #333; margin-top: 0; }

        .header, .footer { text-align: center; margin-bottom: 20px; }

        .details { margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px dashed #ccc; }

        .details p { margin: 5px 0; }

        .section { margin-top: 25px; }

        .section h3 { border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 0; }

        p { white-space: pre-wrap; line-height: 1.6; }

    </style>

</head>

<body>

    <div class="prescription">

        <div class="header">

            <h2>عيادة الدكتور/ة [اكتب اسمك هنا]</h2>

            <p>[تخصصك هنا] | [رقم الهاتف]</p>

        </div>

        <h1>وصفة طبية</h1>

        <div class="details">

            <p><strong>اسم المريض:</strong> <span id="pName"></span></p>

            <p><strong>التاريخ:</strong> <span id="pDate"></span></p>

        </div>

        <div class="section">

            <h3>Rx (الوصفة)</h3>

            <p id="pPrescription"></p>

        </div>

        <div class="section">

            <h3>ملاحظات الطبيب</h3>

            <p id="pNotes"></p>

        </div>

         <div class="section" style="text-align: left; margin-top: 60px;">

            <p><strong>توقيع الطبيب</strong></p>

            <br>

            <p>___________________</p>

        </div>

    </div>

    <script>

        window.onload = function() {

            const params = new URLSearchParams(window.location.search);

            document.getElementById('pName').textContent = params.get('patient_name') || 'غير محدد';

            document.getElementById('pDate').textContent = new Date().toLocaleDateString('ar-IQ', {

                year: 'numeric', month: 'long', day: 'numeric'

            });

            document.getElementById('pPrescription').textContent = params.get('prescription') || 'لا يوجد';

            document.getElementById('pNotes').textContent = params.get('notes') || 'لا يوجد';

            

            setTimeout(() => {

                window.print();

                window.onafterprint = () => window.close();

            }, 500);

        };

    </script>

</body>

</html>   وهذا      inventory.php      <?php $pageTitle = "المخزن"; include 'header.php'; ?>



<h1>إدارة المخزن</h1>

<form id="inventoryForm" class="row g-3">

    <input type="hidden" id="itemId">

    <div class="col-md-4">

        <input type="text" class="form-control" id="itemName" placeholder="اسم المادة" required>

    </div>

    <div class="col-md-2">

        <input type="number" class="form-control" id="itemQuantity" placeholder="الكمية" required>

    </div>

    <div class="col-md-2">

        <input type="number" class="form-control" id="itemPrice" placeholder="السعر" step="any" required>

    </div>

    <div class="col-md-4">

        <textarea class="form-control" id="itemDescription" placeholder="الوصف" rows="1"></textarea>

    </div>

    <div class="col-12">

        <button type="submit" class="btn btn-primary">إضافة/تحديث المادة</button>

    </div>

</form>

<hr>

<h2>قائمة المواد</h2>

<table class="table table-striped" id="inventoryTable">

    <thead>

        <tr>

            <th>اسم</th>

            <th>كمية</th>

            <th>سعر</th>

            <th>وصف</th>

            <th>تاريخ</th>

            <th>إجراءات</th>

        </tr>

    </thead>

    <tbody></tbody>

</table>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

$(document).ready(function() {

    loadInventory();



    $("#inventoryForm").on("submit", function(e) {

        e.preventDefault();

        const id = $("#itemId").val();

        const url = id ? 'api.php?action=update_inventory' : 'api.php?action=add_inventory';

        $.ajax({

            url: url,

            type: 'POST',

            data: {

                id: id,

                name: $("#itemName").val(),

                quantity: $("#itemQuantity").val(),

                price: $("#itemPrice").val(),

                description: $("#itemDescription").val()

            },

            success: function() {

                alert("تم العملية بنجاح!");

                $("#inventoryForm")[0].reset();

                $("#itemId").val('');

                loadInventory();

            },

            error: function() {

                alert("خطأ!");

            }

        });

    });



    function loadInventory() {

        $.getJSON("api.php?action=get_inventory", function(data) {

            const tbody = $("#inventoryTable tbody");

            tbody.empty();

            data.forEach(item => {

                tbody.append(`

                    <tr>

                        <td>${item.name}</td>

                        <td>${item.quantity}</td>

                        <td>${item.price}</td>

                        <td>${item.description || ''}</td>

                        <td>${item.added_date}</td>

                        <td>

                            <button class="btn btn-sm btn-warning edit-btn" data-id="${item.id}" data-name="${item.name}" data-quantity="${item.quantity}" data-price="${item.price}" data-description="${item.description}">تعديل</button>

                            <button class="btn btn-sm btn-danger delete-btn" data-id="${item.id}">حذف</button>

                        </td>

                    </tr>

                `);

            });

        });

    }



    $(document).on("click", ".edit-btn", function() {

        $("#itemId").val($(this).data("id"));

        $("#itemName").val($(this).data("name"));

        $("#itemQuantity").val($(this).data("quantity"));

        $("#itemPrice").val($(this).data("price"));

        $("#itemDescription").val($(this).data("description"));

    });



    $(document).on("click", ".delete-btn", function() {

        if (confirm("هل أنت متأكد؟")) {

            $.post("api.php?action=delete_inventory", { id: $(this).data("id") }, function() {

                loadInventory();

            });

        }

    });

});

</script>



<?php include 'footer.php'; ?>        وهذا        secretary.php      <?php $pageTitle = "واجهة السكرتير"; include 'header.php'; ?>



<h1>تسجيل مريض جديد</h1>

<form id="patientForm" class="row g-3">

    <div class="col-md-6">

        <input type="text" class="form-control" id="patientName" placeholder="اسم المريض" required>

    </div>

    <div class="col-md-3">

        <input type="number" class="form-control" id="patientAge" placeholder="العمر" required>

    </div>

    <div class="col-md-3">

        <input type="number" class="form-control" id="ticketPrice" placeholder="سعر الكشفية" step="any" required>

    </div>

    <div class="col-md-12">

        <div class="input-group">

            <span class="input-group-text">+964</span>

            <input type="text" class="form-control" id="patientPhone" placeholder="رقم الهاتف (بدون +964)" required pattern="\d{10}">

        </div>

    </div>

    <div class="col-12">

        <button type="submit" class="btn btn-primary">إضافة المريض لقائمة الانتظار</button>

    </div>

</form>

<hr>

<h2>المرضى المنتظرون اليوم</h2>

<div id="waitingList" class="list-group"></div>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

$(document).ready(function() {

    $("#patientForm").on("submit", function(e) {

        e.preventDefault();

        $.ajax({

            url: 'api.php?action=add_patient',

            type: 'POST',

            data: {

                name: $("#patientName").val(),

                age: $("#patientAge").val(),

                price: $("#ticketPrice").val(),

                phone: $("#patientPhone").val()  // +964 يضاف في API

            },

            success: function(response) {

                alert("تمت إضافة المريض بنجاح!");

                $("#patientForm")[0].reset();

                loadWaitingList();

            },

            error: function() {

                alert("حدث خطأ، يرجى المحاولة مرة أخرى.");

            }

        });

    });



    function loadWaitingList() {

        $.get("api.php?action=get_waiting", function(data) {

            $("#waitingList").html(data);

        });

    }



    loadWaitingList();

    setInterval(loadWaitingList, 10000);

});

</script>



<?php include 'footer.php'; ?> وهذا            style.css   /* General Body Styles */

body {

    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;

    background-color: #f4f4f9;

    color: #333;

    margin: 0;

    padding: 20px;

}



/* Main Container */

.container {

    max-width: 1200px; /* أوسع للاحترافية */

    margin: auto;

    background: #fff;

    padding: 20px;

    border-radius: 8px;

    box-shadow: 0 2px 10px rgba(0,0,0,0.1);

}



h1, h2, h3 {

    color: #0056b3;

    border-bottom: 2px solid #f0f0f0;

    padding-bottom: 10px;

    margin-top: 0;

}



/* Navigation Bar */

.navbar {

    margin-bottom: 20px;

}



/* Forms: Inputs, Textareas, Buttons */

input[type="text"], input[type="number"], textarea, button {

    width: 100%;

    padding: 12px;

    margin-bottom: 15px;

    border-radius: 5px;

    border: 1px solid #ddd;

    box-sizing: border-box; /* Important for padding */

    font-size: 16px;

}



textarea {

    resize: vertical;

}



button {

    background-color: #007bff;

    color: white;

    border: none;

    cursor: pointer;

    font-weight: bold;

    transition: background-color 0.3s;

}

button:hover {

    background-color: #0056b3;

}



/* Patient Card (Doctor's view) */

.patient-card {

    background-color: #e9ecef;

    padding: 15px;

    margin-bottom: 10px;

    border-radius: 5px;

    display: flex;

    justify-content: space-between;

    align-items: center;

    box-shadow: 0 1px 3px rgba(0,0,0,0.1);

}

.patient-card small {

    color: #6c757d;

}



/* Action Buttons */

.add-details-btn {

    background-color: #17a2b8;

}

.add-details-btn:hover {

    background-color: #138496;

}

.print-btn {

    background-color: #28a745;

}

.print-btn:hover {

    background-color: #218838;

}



/* Modal for Doctor's Details */

.modal {

    display: none; 

    position: fixed;

    z-index: 1000;

    left: 0; top: 0;

    width: 100%; height: 100%;

    overflow: auto;

    background-color: rgba(0,0,0,0.5);

}

.modal-content {

    background-color: #fefefe;

    margin: 10% auto;

    padding: 20px;

    border: 1px solid #888;

    width: 90%;

    max-width: 600px;

    border-radius: 8px;

    position: relative;

    box-shadow: 0 4px 8px rgba(0,0,0,0.2);

}

.close-button {

    color: #aaa;

    position: absolute;

    left: 15px;

    top: 10px;

    font-size: 28px;

    font-weight: bold;

    cursor: pointer;

}



/* History & Search Page */

#searchResults ul {

    list-style: none;

    padding: 0;

    margin: 0;

    border: 1px solid #ddd;

    border-radius: 5px;

}

#searchResults li {

    padding: 10px;

    cursor: pointer;

    border-bottom: 1px solid #ddd;

}

#searchResults li:last-child {

    border-bottom: none;

}

#searchResults li:hover {

    background-color: #f0f0f0;

}

#history-details {

    margin-top: 20px;

    background-color: #f8f9fa;

    padding: 15px;

    border-radius: 5px;

}

.visit-record {

    border-bottom: 1px solid #e9ecef;

    padding-bottom: 15px;

    margin-bottom: 15px;

}

.visit-record:last-child {

    border-bottom: none;

    margin-bottom: 0;

}

.visit-record h4 {

    color: #007bff;

}



/* Statistics Cards */

.stats-grid {

    gap: 20px;

}

.stat-card {

    background-color: #ffffff;

    padding: 25px;

    text-align: center;

    border-radius: 8px;

    border: 1px solid #e9ecef;

    box-shadow: 0 2px 5px rgba(0,0,0,0.1);

}

.stat-card h3 {

    margin: 0 0 10px;

    font-size: 18px;

    color: #0056b3;

    border-bottom: none;

}

.stat-card p {

    font-size: 28px;

    font-weight: bold;

    margin: 0;

    color: #28a745; /* أخضر للأرقام */

}



/* لقوائم مثل waitingList */

.list-group-item {

    border-radius: 5px;

    margin-bottom: 5px;

}



/* Responsiveness */

@media (max-width: 768px) {

    .navbar-nav {

        flex-direction: column;

    }

}        وهذا             stats.php      <?php $pageTitle = "الإحصائيات"; include 'header.php'; ?>



<h1>لوحة الإحصائيات</h1>

<div class="row stats-grid">

    <div class="col-md-3 stat-card">

        <h3>الدخل (هذا الشهر)</h3>

        <p id="monthlyIncome">0</p>

    </div>

    <div class="col-md-3 stat-card">

        <h3>الدخل (اليوم)</h3>

        <p id="dailyIncome">0</p>

    </div>

    <div class="col-md-3 stat-card">

        <h3>عدد المراجعين (اليوم)</h3>

        <p id="dailyVisits">0</p>

    </div>

    <div class="col-md-3 stat-card">

        <h3>إجمالي عدد الزيارات</h3>

        <p id="totalVisits">0</p>

    </div>

</div>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

$(document).ready(function() {

    function loadStats() {

        $.getJSON("api.php?action=get_stats", function(data) {

            $("#monthlyIncome").text(data.monthly_income + " د.ع");

            $("#dailyIncome").text(data.daily_income + " د.ع");

            $("#dailyVisits").text(data.daily_visits);

            $("#totalVisits").text(data.total_visits);

        });

    }

    loadStats(); // Load stats on page load

});

</script>



<?php include 'footer.php'; ?>                وهذا             reminders.php     <?php $pageTitle = "التذكيرات"; include 'header.php'; ?>



<h1>التذكيرات بالمراجعات القادمة</h1>

<p>قائمة المرضى الذين لديهم مراجعة اليوم أو غدًا.</p>

<button id="sendAll" class="btn btn-primary mb-3">إرسال تذكير للجميع مباشرة</button>

<p class="text-warning">ملاحظة: قد يمنع متصفحك فتح نوافذ متعددة بسبب حظر النوافذ المنبثقة. تأكد من السماح بالنوافذ أو جرب إرسالها يدويًا.</p>

<table class="table table-striped" id="remindersTable">

    <thead>

        <tr>

            <th>اسم المريض</th>

            <th>رقم الهاتف</th>

            <th>تاريخ المراجعة</th>

            <th>إجراءات</th>

        </tr>

    </thead>

    <tbody></tbody>

</table>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>

$(document).ready(function() {

    loadReminders();



    function loadReminders() {

        $.getJSON("api.php?action=get_upcoming_reviews", function(data) {

            const tbody = $("#remindersTable tbody");

            tbody.empty();

            if (data.length === 0) {

                tbody.append("<tr><td colspan='4'>لا توجد مراجعات قادمة.</td></tr>");

            } else {

                data.forEach(item => {

                    const message = encodeURIComponent(`مرحبا ${item.patient_name}، تذكير بموعد مراجعتك في العيادة يوم ${item.next_review_date}. شكرا!`);

                    const waLink = `https://wa.me/${item.phone}?text=${message}`;

                    

                    tbody.append(`

                        <tr>

                            <td>${item.patient_name}</td>

                            <td>${item.phone}</td>

                            <td>${item.next_review_date}</td>

                            <td>

                                <a href="${waLink}" target="_blank" class="btn btn-success btn-sm single-send">إرسال تذكير عبر واتساب</a>

                            </td>

                        </tr>

                    `);

                });

            }

        }).fail(function() {

            alert("خطأ في تحميل البيانات.");

        });

    }

    

    // إرسال للجميع مع تأخير لتجنب الحظر جزئيًا

    $("#sendAll").click(function() {

        if (confirm("هل تريد إرسال التذكيرات للجميع؟ سيتم فتح روابط الواتساب في تبويبات جديدة مع تأخير صغير.")) {

            const links = [];

            $(".single-send").each(function() {

                links.push($(this).attr("href"));

            });

            

            links.forEach((link, index) => {

                setTimeout(() => {

                    window.open(link, '_blank');

                }, index * 500); // تأخير 0.5 ثانية بين كل فتح

            });

        }

    });

    

    // تحديث تلقائي كل 5 دقائق (اختياري)

    setInterval(loadReminders, 300000);

});

</script>



<?php include 'footer.php'; ?>                                                                                                                                                                                                                                                                                                                              
