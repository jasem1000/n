Ø³Ø£Ø±Ø³Ù„ Ù„Ùƒ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø­Ø¯Ø« Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª:

```python
import sqlite3
import tkinter as tk
from tkinter import messagebox, ttk, filedialog
from datetime import datetime
import hashlib
from reportlab.lib.pagesizes import letter, A4
from reportlab.lib import colors
from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle
from reportlab.lib.enums import TA_RIGHT, TA_CENTER
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
import csv
import shutil
import os
import logging

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
logging.basicConfig(filename='workshop.log', level=logging.INFO, 
                    format='%(asctime)s - %(levelname)s - %(message)s')

# Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
def create_database():
    with sqlite3.connect('workshop.db') as conn:
        c = conn.cursor()
        c.execute('''CREATE TABLE IF NOT EXISTS repairs
                     (id INTEGER PRIMARY KEY, device_name TEXT NOT NULL, owner_name TEXT NOT NULL, 
                     owner_phone TEXT, status TEXT DEFAULT 'Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­', entry_date DATE, 
                     exit_date DATE, description TEXT, estimated_cost REAL DEFAULT 0, 
                     final_cost REAL DEFAULT 0)''')
        c.execute('''CREATE TABLE IF NOT EXISTS sales
                     (id INTEGER PRIMARY KEY, product_id INTEGER, device_name TEXT NOT NULL, 
                     customer_name TEXT NOT NULL, customer_phone TEXT, sale_type TEXT DEFAULT 'Ù†Ù‚Ø¯ÙŠ', 
                     installments_remaining INTEGER DEFAULT 0, sale_date DATE, 
                     amount REAL NOT NULL, paid_amount REAL DEFAULT 0, notes TEXT)''')
        c.execute('''CREATE TABLE IF NOT EXISTS products
                     (id INTEGER PRIMARY KEY, product_name TEXT NOT NULL UNIQUE, category TEXT, 
                     price REAL DEFAULT 0, quantity INTEGER DEFAULT 0, description TEXT, 
                     created_date DATE, last_updated DATE)''')
        conn.commit()

create_database()

def print_pdf(title, details, filename=None):
    """Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„Ù PDF Ù…Ø¹ Ø¯Ø¹Ù… Ù…Ø­Ø³Ù† Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"""
    if not filename:
        filename = f"{title.lower().replace(' ', '_')}_{datetime.now().strftime('%Y%m%d_%H%M%S')}.pdf"
    
    try:
        doc = SimpleDocTemplate(filename, pagesize=A4, rightMargin=50, leftMargin=50, 
                                topMargin=50, bottomMargin=50)
        
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· ÙŠØ¯Ø¹Ù… Unicode
        arabic_font = 'Helvetica'
        
        styles = getSampleStyleSheet()
        
        title_style = ParagraphStyle(
            'ArabicTitle',
            parent=styles['Heading1'],
            fontName=arabic_font,
            fontSize=18,
            textColor=colors.HexColor('#2c3e50'),
            alignment=TA_CENTER,
            spaceAfter=20,
            leading=24
        )
        
        normal_style = ParagraphStyle(
            'ArabicNormal',
            parent=styles['Normal'],
            fontName=arabic_font,
            fontSize=11,
            textColor=colors.black,
            alignment=TA_RIGHT,
            spaceAfter=10,
            leading=16
        )
        
        content = []
        
        # Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
        header = Paragraph(f"<b>{title}</b>", title_style)
        content.append(header)
        content.append(Spacer(1, 20))
        
        # Ø®Ø· ÙØ§ØµÙ„
        separator_data = [['', '']]
        separator_table = Table(separator_data, colWidths=[500])
        separator_table.setStyle(TableStyle([
            ('LINEBELOW', (0, 0), (-1, 0), 2, colors.HexColor('#3498db')),
        ]))
        content.append(separator_table)
        content.append(Spacer(1, 15))
        
        # Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ø¹ÙƒØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©
        data = [['Value / Ø§Ù„Ù‚ÙŠÙ…Ø©', 'Field / Ø§Ù„Ø¨ÙŠØ§Ù†']]
        for key, value in details.items():
            data.append([str(value), str(key)])
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        table = Table(data, colWidths=[250, 250])
        table.setStyle(TableStyle([
            ('BACKGROUND', (0, 0), (-1, 0), colors.HexColor('#3498db')),
            ('TEXTCOLOR', (0, 0), (-1, 0), colors.whitesmoke),
            ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
            ('FONTNAME', (0, 0), (-1, 0), arabic_font),
            ('FONTSIZE', (0, 0), (-1, 0), 12),
            ('BOTTOMPADDING', (0, 0), (-1, 0), 12),
            ('TOPPADDING', (0, 0), (-1, 0), 12),
            ('BACKGROUND', (0, 1), (-1, -1), colors.beige),
            ('FONTNAME', (0, 1), (-1, -1), arabic_font),
            ('FONTSIZE', (0, 1), (-1, -1), 10),
            ('GRID', (0, 0), (-1, -1), 1, colors.grey),
            ('ROWBACKGROUNDS', (0, 1), (-1, -1), [colors.white, colors.lightgrey]),
            ('VALIGN', (0, 0), (-1, -1), 'MIDDLE'),
            ('TOPPADDING', (0, 1), (-1, -1), 8),
            ('BOTTOMPADDING', (0, 1), (-1, -1), 8),
        ]))
        content.append(table)
        
        content.append(Spacer(1, 30))
        
        # Ø§Ù„ØªØ°ÙŠÙŠÙ„
        date_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        footer_text = f"Print Date / ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: {date_time}"
        footer = Paragraph(f"<i>{footer_text}</i>", normal_style)
        content.append(footer)
        
        # Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ†Ø¯
        doc.build(content)
        messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­:\n{filename}")
        logging.info(f"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ PDF: {filename}")
        
        # ÙØªØ­ Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        try:
            os.startfile(filename)
        except:
            pass
            
    except Exception as e:
        messagebox.showerror("Ø®Ø·Ø£", f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: {str(e)}")
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: {str(e)}")

def hash_password(password):
    return hashlib.sha256(password.encode()).hexdigest()

class ModernWorkshopApp:
    def __init__(self, root):
        self.root = root
        self.root.title("Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ")
        self.root.geometry("1200x800")
        self.root.configure(bg='#2c3e50')
        
        self.center_window(self.root)
        
        self.colors = {
            'primary': '#3498db',
            'secondary': '#2ecc71',
            'danger': '#e74c3c',
            'warning': '#f39c12',
            'dark': '#2c3e50',
            'light': '#ecf0f1',
            'success': '#27ae60',
            'info': '#17a2b8',
            'purple': '#6f42c1'
        }
        
        self.setup_styles()
        self.password_hash = hash_password("workshop123")
        
        self.create_login_window()

    def center_window(self, window):
        window.update_idletasks()
        width = window.winfo_width()
        height = window.winfo_height()
        x = (window.winfo_screenwidth() // 2) - (width // 2)
        y = (window.winfo_screenheight() // 2) - (height // 2)
        window.geometry('{}x{}+{}+{}'.format(width, height, x, y))

    def setup_styles(self):
        style = ttk.Style()
        style.theme_use('clam')
        
        style.configure('Primary.TButton', 
                        background=self.colors['primary'],
                        foreground='white',
                        font=('Arial', 10, 'bold'),
                        padding=10)
        
        style.configure('Success.TButton',
                        background=self.colors['success'],
                        foreground='white',
                        font=('Arial', 10, 'bold'),
                        padding=10)
        
        style.configure('Danger.TButton',
                        background=self.colors['danger'],
                        foreground='white',
                        font=('Arial', 10, 'bold'),
                        padding=10)

    def create_login_window(self):
        self.login_window = tk.Toplevel(self.root)
        self.login_window.title("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ")
        self.login_window.geometry("400x300")
        self.login_window.configure(bg=self.colors['dark'])
        self.login_window.resizable(False, False)
        self.center_window(self.login_window)
        
        self.login_window.transient(self.root)
        self.login_window.grab_set()
        
        title_frame = tk.Frame(self.login_window, bg=self.colors['dark'])
        title_frame.pack(pady=30)
        
        tk.Label(title_frame, text="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´Ø©", 
                 font=('Arial', 18, 'bold'), 
                 bg=self.colors['dark'], 
                 fg='white').pack()
        
        tk.Label(title_frame, text="Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ v2.1", 
                 font=('Arial', 12), 
                 bg=self.colors['dark'], 
                 fg=self.colors['primary']).pack()
        
        input_frame = tk.Frame(self.login_window, bg=self.colors['dark'])
        input_frame.pack(pady=40)
        
        tk.Label(input_frame, text="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:", 
                 font=('Arial', 12, 'bold'), 
                 bg=self.colors['dark'], 
                 fg='white').grid(row=0, column=0, padx=10, pady=10, sticky='e')
        
        self.password_entry = tk.Entry(input_frame, show="*", 
                                       font=('Arial', 12), 
                                       width=20,
                                       bg=self.colors['light'])
        self.password_entry.grid(row=0, column=1, padx=10, pady=10)
        self.password_entry.bind('<Return>', lambda e: self.check_password())
        self.password_entry.focus()
        
        btn_frame = tk.Frame(self.login_window, bg=self.colors['dark'])
        btn_frame.pack(pady=20)
        
        ttk.Button(btn_frame, text="Ø¯Ø®ÙˆÙ„", 
                   style='Primary.TButton',
                   command=self.check_password).pack(side=tk.LEFT, padx=10)
        
        ttk.Button(btn_frame, text="Ø®Ø±ÙˆØ¬", 
                   style='Danger.TButton',
                   command=self.root.quit).pack(side=tk.LEFT, padx=10)
        
        self.root.withdraw()

    def check_password(self):
        if hash_password(self.password_entry.get()) == self.password_hash:
            logging.info("ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù†Ø§Ø¬Ø­")
            self.login_window.destroy()
            self.root.deiconify()
            self.build_main_window()
        else:
            messagebox.showerror("Ø®Ø·Ø£", "ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!")
            self.password_entry.delete(0, tk.END)
            logging.warning("Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø©")

    def build_main_window(self):
        self.create_menubar()
        
        title_frame = tk.Frame(self.root, bg=self.colors['dark'], height=100)
        title_frame.pack(fill=tk.X, padx=10, pady=10)
        title_frame.pack_propagate(False)
        
        tk.Label(title_frame, text="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø´Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ", 
                 font=('Arial', 20, 'bold'), 
                 bg=self.colors['dark'], 
                 fg='white').pack(expand=True)
        
        tk.Label(title_frame, text=f"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ - {datetime.now().strftime('%Y-%m-%d %H:%M')}", 
                 font=('Arial', 12), 
                 bg=self.colors['dark'], 
                 fg=self.colors['primary']).pack()
        
        # Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© - Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
        self.create_quick_actions()

    def create_menubar(self):
        menubar = tk.Menu(self.root, bg=self.colors['light'], fg=self.colors['dark'])
        
        file_menu = tk.Menu(menubar, tearoff=0, bg='white', fg='black')
        file_menu.add_command(label="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", command=self.export_data)
        file_menu.add_command(label="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", command=self.import_data)
        file_menu.add_separator()
        file_menu.add_command(label="Ø®Ø±ÙˆØ¬", command=self.root.quit)
        menubar.add_cascade(label="Ù…Ù„Ù", menu=file_menu)
        
        view_menu = tk.Menu(menubar, tearoff=0, bg='white', fg='black')
        view_menu.add_command(label="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…", command=self.show_dashboard)
        view_menu.add_command(label="Ø¹Ø±Ø¶ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", command=self.show_repairs)
        view_menu.add_command(label="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", command=self.show_sales)
        view_menu.add_command(label="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", command=self.show_products)
        view_menu.add_command(label="Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±", command=self.show_reports)
        menubar.add_cascade(label="Ø¹Ø±Ø¶", menu=view_menu)
        
        add_menu = tk.Menu(menubar, tearoff=0, bg='white', fg='black')
        add_menu.add_command(label="Ø¥Ø¶Ø§ÙØ© ØµÙŠØ§Ù†Ø©", command=self.add_repair)
        add_menu.add_command(label="Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹", command=self.add_sale)
        add_menu.add_command(label="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬", command=self.add_product)
        add_menu.add_command(label="Ø¯ÙØ¹ Ù‚Ø³Ø·", command=self.pay_installment)
        menubar.add_cascade(label="Ø¥Ø¶Ø§ÙØ©", menu=add_menu)
        
        settings_menu = tk.Menu(menubar, tearoff=0, bg='white', fg='black')
        settings_menu.add_command(label="ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", command=self.change_password)
        settings_menu.add_command(label="Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ", command=self.backup_data)
        menubar.add_cascade(label="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", menu=settings_menu)
        
        self.root.config(menu=menubar)

    def create_quick_actions(self):
        actions_frame = tk.Frame(self.root, bg='white', relief='raised', bd=2)
        actions_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=10)
        
        tk.Label(actions_frame, text="Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø©", 
                 font=('Arial', 14, 'bold'), 
                 bg='white').pack(pady=10)
        
        buttons = [
            ("Ø¥Ø¶Ø§ÙØ© ØµÙŠØ§Ù†Ø©", self.colors['primary'], self.add_repair),
            ("Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹", self.colors['success'], self.add_sale),
            ("Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬", self.colors['secondary'], self.add_product),
            ("Ø¹Ø±Ø¶ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", self.colors['warning'], self.show_repairs),
            ("Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", self.colors['info'], self.show_sales),
            ("Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", self.colors['dark'], self.show_products),
            ("Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±", self.colors['purple'], self.show_reports),
            ("Ø¯ÙØ¹ Ø£Ù‚Ø³Ø§Ø·", self.colors['danger'], self.pay_installment)
        ]
        
        btn_frame = tk.Frame(actions_frame, bg='white')
        btn_frame.pack(expand=True)
        
        for i, (text, color, command) in enumerate(buttons):
            btn = tk.Button(btn_frame, text=text, font=('Arial', 11, 'bold'),
                            bg=color, fg='white', relief='raised', bd=2,
                            command=command, width=15, height=2)
            btn.grid(row=i//4, column=i%4, padx=8, pady=8, sticky='nsew')
            btn_frame.columnconfigure(i%4, weight=1)
            btn_frame.rowconfigure(i//4, weight=1)

    def add_product(self):
        window = tk.Toplevel(self.root)
        window.title("Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯")
        window.geometry("500x500")
        window.configure(bg='white')
        self.center_window(window)
        
        title_label = tk.Label(window, text="Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯", 
                               font=('Arial', 16, 'bold'), bg='white')
        title_label.pack(pady=20)
        
        form_frame = tk.Frame(window, bg='white')
        form_frame.pack(fill=tk.BOTH, expand=True, padx=30)
        
        fields = [
            ("Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:", "entry"),
            ("Ø§Ù„ÙØ¦Ø©:", "entry"),
            ("Ø§Ù„Ø³Ø¹Ø±:", "entry"),
            ("Ø§Ù„ÙƒÙ…ÙŠØ©:", "entry"),
            ("Ø§Ù„ÙˆØµÙ:", "text")
        ]
        
        entries = {}
        for i, (label, field_type) in enumerate(fields):
            tk.Label(form_frame, text=label, font=('Arial', 11), 
                     bg='white').grid(row=i, column=0, sticky='e', pady=8, padx=10)
            
            if field_type == "entry":
                entry = tk.Entry(form_frame, font=('Arial', 11), bg='#f8f9fa')
                entry.grid(row=i, column=1, sticky='ew', pady=8, padx=10)
            else:
                entry = tk.Text(form_frame, height=3, width=30, font=('Arial', 11), bg='#f8f9fa')
                entry.grid(row=i, column=1, sticky='ew', pady=8, padx=10)
            
            entries[label] = entry
        
        form_frame.columnconfigure(1, weight=1)
        
        def save():
            try:
                product_name = entries["Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬:"].get().strip()
                if not product_name:
                    raise ValueError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬")
                
                price = float(entries["Ø§Ù„Ø³Ø¹Ø±:"].get() or 0)
                quantity = int(entries["Ø§Ù„ÙƒÙ…ÙŠØ©:"].get() or 0)
                
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    c.execute('''INSERT INTO products 
                              (product_name, category, price, quantity, description, created_date, last_updated) 
                              VALUES (?, ?, ?, ?, ?, ?, ?)''',
                             (product_name,
                              entries["Ø§Ù„ÙØ¦Ø©:"].get().strip(),
                              price,
                              quantity,
                              entries["Ø§Ù„ÙˆØµÙ:"].get("1.0", tk.END).strip(),
                              datetime.now().date(),
                              datetime.now().date()))
                    conn.commit()
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!")
                logging.info(f"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬: {product_name}")
                window.destroy()
                self.show_dashboard()
            except sqlite3.IntegrityError:
                messagebox.showerror("Ø®Ø·Ø£", "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!")
            except ValueError as ve:
                messagebox.showerror("Ø®Ø·Ø£", str(ve))
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: {str(e)}")
                logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬: {str(e)}")
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=20)
        
        tk.Button(btn_frame, text="Ø­ÙØ¸", bg=self.colors['success'], fg='white',
                  font=('Arial', 11, 'bold'), command=save, width=10).pack(side=tk.LEFT, padx=10)
        
        tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡", bg=self.colors['danger'], fg='white',
                  font=('Arial', 11, 'bold'), command=window.destroy, width=10).pack(side=tk.LEFT, padx=10)

    def show_products(self):
        window = tk.Toplevel(self.root)
        window.title("Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª")
        window.geometry("900x600")
        window.configure(bg='white')
        self.center_window(window)
        
        title_frame = tk.Frame(window, bg='white')
        title_frame.pack(fill=tk.X, padx=20, pady=10)
        
        tk.Label(title_frame, text="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", 
                 font=('Arial', 16, 'bold'), bg='white').pack()
        
        search_frame = tk.Frame(window, bg='white')
        search_frame.pack(fill=tk.X, padx=20, pady=10)
        
        tk.Label(search_frame, text="Ø¨Ø­Ø«:", font=('Arial', 11), bg='white').pack(side=tk.LEFT)
        search_entry = tk.Entry(search_frame, font=('Arial', 11), width=30, bg='#f8f9fa')
        search_entry.pack(side=tk.LEFT, padx=10)
        
        def search():
            load_data(search_entry.get())
        
        tk.Button(search_frame, text="Ø¨Ø­Ø«", bg=self.colors['primary'], fg='white',
                  command=search).pack(side=tk.LEFT, padx=5)
        tk.Button(search_frame, text="Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„", bg=self.colors['secondary'], fg='white',
                  command=lambda: load_data()).pack(side=tk.LEFT, padx=5)
        
        tree_frame = tk.Frame(window)
        tree_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=10)
        
        tree = ttk.Treeview(tree_frame, columns=("ID", "Ø§Ù„Ù…Ù†ØªØ¬", "Ø§Ù„ÙØ¦Ø©", "Ø§Ù„Ø³Ø¹Ø±", "Ø§Ù„ÙƒÙ…ÙŠØ©", "Ø§Ù„ÙˆØµÙ"), show="headings")
        
        columns = [
            ("ID", 50),
            ("Ø§Ù„Ù…Ù†ØªØ¬", 150),
            ("Ø§Ù„ÙØ¦Ø©", 100),
            ("Ø§Ù„Ø³Ø¹Ø±", 100),
            ("Ø§Ù„ÙƒÙ…ÙŠØ©", 80),
            ("Ø§Ù„ÙˆØµÙ", 200)
        ]
        
        for col, width in columns:
            tree.heading(col, text=col)
            tree.column(col, width=width)
        
        scrollbar = ttk.Scrollbar(tree_frame, orient=tk.VERTICAL, command=tree.yview)
        tree.configure(yscrollcommand=scrollbar.set)
        tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
        def load_data(search_text=""):
            for item in tree.get_children():
                tree.delete(item)
            
            with sqlite3.connect('workshop.db') as conn:
                c = conn.cursor()
                
                if search_text:
                    c.execute('''SELECT id, product_name, category, price, quantity, description FROM products 
                              WHERE product_name LIKE ? OR category LIKE ? OR description LIKE ?''',
                             (f"%{search_text}%", f"%{search_text}%", f"%{search_text}%"))
                else:
                    c.execute("SELECT id, product_name, category, price, quantity, description FROM products ORDER BY id DESC")
                
                rows = c.fetchall()
                for row in rows:
                    tree.insert("", "end", values=row)
        
        load_data()
        
        def edit_product():
            selected = tree.selection()
            if not selected:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„")
                return
            
            item = tree.item(selected[0])
            values = item['values']
            
            edit_window = tk.Toplevel(window)
            edit_window.title("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬")
            edit_window.geometry("400x400")
            self.center_window(edit_window)
            
            tk.Label(edit_window, text="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬", font=('Arial', 14, 'bold')).pack(pady=10)
            
            form_frame = tk.Frame(edit_window)
            form_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=10)
            
            fields = ["Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬", "Ø§Ù„ÙØ¦Ø©", "Ø§Ù„Ø³Ø¹Ø±", "Ø§Ù„ÙƒÙ…ÙŠØ©", "Ø§Ù„ÙˆØµÙ"]
            entries = {}
            
            for i, field in enumerate(fields):
                tk.Label(form_frame, text=f"{field}:").grid(row=i, column=0, sticky='e', pady=5, padx=5)
                entry = tk.Entry(form_frame, font=('Arial', 11), bg='#f8f9fa')
                entry.grid(row=i, column=1, sticky='ew', pady=5, padx=5)
                entry.insert(0, str(values[i+1]))
                entries[field] = entry
            
            form_frame.columnconfigure(1, weight=1)
            
            def update_product():
                try:
                    product_name = entries["Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"].get().strip()
                    if not product_name:
                        raise ValueError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬")
                    
                    with sqlite3.connect('workshop.db') as conn:
                        c = conn.cursor()
                        c.execute('''UPDATE products SET 
                                  product_name=?, category=?, price=?, quantity=?, description=?, last_updated=? 
                                  WHERE id=?''',
                                 (product_name,
                                  entries["Ø§Ù„ÙØ¦Ø©"].get(),
                                  float(entries["Ø§Ù„Ø³Ø¹Ø±"].get()),
                                  int(entries["Ø§Ù„ÙƒÙ…ÙŠØ©"].get()),
                                  entries["Ø§Ù„ÙˆØµÙ"].get(),
                                  datetime.now().date(),
                                  values[0]))
                        conn.commit()
                    
                    messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!")
                    logging.info(f"ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù†ØªØ¬ ID: {values[0]}")
                    edit_window.destroy()
                    load_data()
                except sqlite3.IntegrityError:
                    messagebox.showerror("Ø®Ø·Ø£", "Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!")
                except ValueError as ve:
                    messagebox.showerror("Ø®Ø·Ø£", str(ve))
                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ«: {str(e)}")
                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬: {str(e)}")
            
            tk.Button(edit_window, text="ØªØ­Ø¯ÙŠØ«", bg=self.colors['success'], fg='white',
                      command=update_product).pack(pady=10)
        
        def delete_product():
            selected = tree.selection()
            if not selected:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬ Ù„Ù„Ø­Ø°Ù")
                return
            
            if messagebox.askyesno("ØªØ£ÙƒÙŠØ¯", "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ"):
                item = tree.item(selected[0])
                product_id = item['values'][0]
                
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    c.execute("DELETE FROM products WHERE id=?", (product_id,))
                    conn.commit()
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!")
                logging.info(f"ØªÙ… Ø­Ø°Ù Ù…Ù†ØªØ¬ ID: {product_id}")
                load_data()
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=10)
        
        tk.Button(btn_frame, text="ØªØ¹Ø¯ÙŠÙ„", bg=self.colors['warning'], fg='white',
                  command=edit_product).pack(side=tk.LEFT, padx=5)
        tk.Button(btn_frame, text="Ø­Ø°Ù", bg=self.colors['danger'], fg='white',
                  command=delete_product).pack(side=tk.LEFT, padx=5)
        tk.Button(btn_frame, text="Ø¥ØºÙ„Ø§Ù‚", bg=self.colors['primary'], fg='white',
                  command=window.destroy).pack(side=tk.LEFT, padx=5)

    def add_sale(self):
        window = tk.Toplevel(self.root)
        window.title("Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯")
        ```python
        window.geometry("600x650")
        window.configure(bg='white')
        self.center_window(window)
        
        title_label = tk.Label(window, text="Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯", 
                               font=('Arial', 16, 'bold'), bg='white')
        title_label.pack(pady=20)
        
        form_frame = tk.Frame(window, bg='white')
        form_frame.pack(fill=tk.BOTH, expand=True, padx=30)
        
        # Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬
        search_frame = tk.Frame(form_frame, bg='#e8f4f8', relief='ridge', bd=2)
        search_frame.grid(row=0, column=0, columnspan=2, sticky='ew', pady=10, padx=5)
        
        tk.Label(search_frame, text="ğŸ” Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬:", font=('Arial', 11, 'bold'), 
                 bg='#e8f4f8').pack(anchor='w', padx=10, pady=5)
        
        search_input_frame = tk.Frame(search_frame, bg='#e8f4f8')
        search_input_frame.pack(fill=tk.X, padx=10, pady=5)
        
        product_search_entry = tk.Entry(search_input_frame, font=('Arial', 11), width=30, bg='white')
        product_search_entry.pack(side=tk.LEFT, padx=5)
        
        # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        tk.Label(form_frame, text="Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†ØªØ¬:", font=('Arial', 11), bg='white').grid(row=1, column=0, sticky='e', pady=8)
        
        with sqlite3.connect('workshop.db') as conn:
            c = conn.cursor()
            c.execute("SELECT id, product_name, price, quantity FROM products WHERE quantity > 0")
            products = c.fetchall()
        
        product_var = tk.StringVar()
        product_combo = ttk.Combobox(form_frame, textvariable=product_var, font=('Arial', 11), width=35)
        product_combo['values'] = [f"{p[0]} - {p[1]} (${p[2]:.2f}) - Ù…ØªÙˆÙØ±: {p[3]}" for p in products]
        product_combo.grid(row=1, column=1, sticky='ew', pady=8, padx=10)
        
        def search_product():
            search_text = product_search_entry.get().strip().lower()
            if not search_text:
                product_combo['values'] = [f"{p[0]} - {p[1]} (${p[2]:.2f}) - Ù…ØªÙˆÙØ±: {p[3]}" for p in products]
                return
            
            filtered = [p for p in products if search_text in p[1].lower()]
            product_combo['values'] = [f"{p[0]} - {p[1]} (${p[2]:.2f}) - Ù…ØªÙˆÙØ±: {p[3]}" for p in filtered]
            
            if filtered:
                product_combo.current(0)
        
        tk.Button(search_input_frame, text="Ø¨Ø­Ø«", bg=self.colors['primary'], fg='white',
                  font=('Arial', 9, 'bold'), command=search_product).pack(side=tk.LEFT, padx=5)
        
        product_search_entry.bind('<Return>', lambda e: search_product())
        
        fields = [
            ("Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†:", "entry"),
            ("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:", "entry"),
            ("Ø§Ù„ÙƒÙ…ÙŠØ©:", "entry"),
            ("Ù…Ù„Ø§Ø­Ø¸Ø§Øª:", "text")
        ]
        
        entries = {}
        for i, (label, field_type) in enumerate(fields, 2):
            tk.Label(form_frame, text=label, font=('Arial', 11), 
                     bg='white').grid(row=i, column=0, sticky='e', pady=8, padx=10)
            
            if field_type == "entry":
                entry = tk.Entry(form_frame, font=('Arial', 11), bg='#f8f9fa')
                entry.grid(row=i, column=1, sticky='ew', pady=8, padx=10)
            else:
                entry = tk.Text(form_frame, height=3, width=30, font=('Arial', 11), bg='#f8f9fa')
                entry.grid(row=i, column=1, sticky='ew', pady=8, padx=10)
            
            entries[label] = entry
        
        tk.Label(form_frame, text="Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹:", font=('Arial', 11), bg='white').grid(row=6, column=0, sticky='e', pady=8)
        sale_type_var = tk.StringVar(value="Ù†Ù‚Ø¯ÙŠ")
        sale_type_frame = tk.Frame(form_frame, bg='white')
        sale_type_frame.grid(row=6, column=1, sticky='w', pady=8, padx=10)
        ttk.Radiobutton(sale_type_frame, text="Ù†Ù‚Ø¯ÙŠ", variable=sale_type_var, value="Ù†Ù‚Ø¯ÙŠ").pack(side=tk.LEFT)
        ttk.Radiobutton(sale_type_frame, text="Ø£Ù‚Ø³Ø§Ø·", variable=sale_type_var, value="Ø£Ù‚Ø³Ø§Ø·").pack(side=tk.LEFT)
        
        tk.Label(form_frame, text="Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·:", font=('Arial', 11), bg='white').grid(row=7, column=0, sticky='e', pady=8)
        installments_entry = tk.Entry(form_frame, font=('Arial', 11), bg='#f8f9fa')
        installments_entry.grid(row=7, column=1, sticky='ew', pady=8, padx=10)
        installments_entry.insert(0, "0")
        
        form_frame.columnconfigure(1, weight=1)
        
        def save():
            try:
                if not product_var.get():
                    raise ValueError("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù†ØªØ¬")
                
                product_id = int(product_var.get().split(' - ')[0])
                quantity = int(entries["Ø§Ù„ÙƒÙ…ÙŠØ©:"].get() or 0)
                
                if quantity <= 0:
                    raise ValueError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©")
                
                customer_name = entries["Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†:"].get().strip()
                if not customer_name:
                    raise ValueError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†")
                
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    
                    c.execute("SELECT quantity, price, product_name FROM products WHERE id=?", (product_id,))
                    product = c.fetchone()
                    
                    if not product:
                        raise ValueError("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯")
                    
                    if product[0] < quantity:
                        raise ValueError(f"Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø©. Ø§Ù„Ù…ØªÙˆÙØ±: {product[0]}")
                    
                    c.execute("UPDATE products SET quantity = quantity - ?, last_updated = ? WHERE id=?", 
                              (quantity, datetime.now().date(), product_id))
                    
                    total_amount = product[1] * quantity
                    installments = int(installments_entry.get()) if sale_type_var.get() == "Ø£Ù‚Ø³Ø§Ø·" else 0
                    
                    c.execute('''INSERT INTO sales 
                              (product_id, device_name, customer_name, customer_phone, sale_type, 
                              installments_remaining, sale_date, amount, paid_amount, notes) 
                              VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)''',
                             (product_id,
                              product[2],
                              customer_name,
                              entries["Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:"].get().strip(),
                              sale_type_var.get(),
                              installments,
                              datetime.now().date(),
                              total_amount,
                              0 if sale_type_var.get() == "Ø£Ù‚Ø³Ø§Ø·" else total_amount,
                              entries["Ù…Ù„Ø§Ø­Ø¸Ø§Øª:"].get("1.0", tk.END).strip()))
                    conn.commit()
                
                details = {
                    "Product / Ø§Ù„Ù…Ù†ØªØ¬": product[2],
                    "Customer / Ø§Ù„Ø²Ø¨ÙˆÙ†": customer_name,
                    "Phone / Ø§Ù„Ù‡Ø§ØªÙ": entries["Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:"].get() or "N/A",
                    "Quantity / Ø§Ù„ÙƒÙ…ÙŠØ©": quantity,
                    "Unit Price / Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©": f"${product[1]:.2f}",
                    "Total Amount / Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ": f"${total_amount:.2f}",
                    "Sale Type / Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹": sale_type_var.get(),
                    "Installments / Ø§Ù„Ø£Ù‚Ø³Ø§Ø·": installments if sale_type_var.get() == "Ø£Ù‚Ø³Ø§Ø·" else "Cash Payment"
                }
                print_pdf("Sales Receipt - Ø§ÙŠØµØ§Ù„ Ø¨ÙŠØ¹", details)
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­!")
                logging.info(f"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ù†ØªØ¬ ID: {product_id}")
                window.destroy()
                self.show_dashboard()
                
            except ValueError as ve:
                messagebox.showerror("Ø®Ø·Ø£", str(ve))
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: {str(e)}")
                logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ¹: {str(e)}")
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=20)
        
        tk.Button(btn_frame, text="Ø­ÙØ¸ ÙˆØ·Ø¨Ø§Ø¹Ø©", bg=self.colors['success'], fg='white',
                  font=('Arial', 11, 'bold'), command=save, width=12).pack(side=tk.LEFT, padx=10)
        
        tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡", bg=self.colors['danger'], fg='white',
                  font=('Arial', 11, 'bold'), command=window.destroy, width=10).pack(side=tk.LEFT, padx=10)

    def add_repair(self):
        window = tk.Toplevel(self.root)
        window.title("Ø¥Ø¶Ø§ÙØ© ØµÙŠØ§Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø©")
        window.geometry("500x500")
        window.configure(bg='white')
        self.center_window(window)
        
        title_label = tk.Label(window, text="Ø¥Ø¶Ø§ÙØ© ØµÙŠØ§Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø©", 
                               font=('Arial', 16, 'bold'), bg='white')
        title_label.pack(pady=20)
        
        form_frame = tk.Frame(window, bg='white')
        form_frame.pack(fill=tk.BOTH, expand=True, padx=30)
        
        fields = [
            ("Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:", "entry"),
            ("Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:", "entry"),
            ("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:", "entry"),
            ("ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:", "text"),
            ("Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:", "entry")
        ]
        
        entries = {}
        for i, (label, field_type) in enumerate(fields):
            tk.Label(form_frame, text=label, font=('Arial', 11), 
                     bg='white').grid(row=i, column=0, sticky='e', pady=8, padx=10)
            
            if field_type == "entry":
                entry = tk.Entry(form_frame, font=('Arial', 11), bg='#f8f9fa')
                entry.grid(row=i, column=1, sticky='ew', pady=8, padx=10)
            else:
                entry = tk.Text(form_frame, height=3, width=30, font=('Arial', 11), bg='#f8f9fa')
                entry.grid(row=i, column=1, sticky='ew', pady=8, padx=10)
            
            entries[label] = entry
        
        tk.Label(form_frame, text="Ø­Ø§Ù„Ø© Ø§Ù„ØµÙŠØ§Ù†Ø©:", font=('Arial', 11), 
                 bg='white').grid(row=len(fields), column=0, sticky='e', pady=8, padx=10)
        
        status_var = tk.StringVar(value="Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­")
        status_frame = tk.Frame(form_frame, bg='white')
        status_frame.grid(row=len(fields), column=1, sticky='w', pady=8, padx=10)
        
        statuses = [("Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­", "Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­"), ("Ù…ÙƒØªÙ…Ù„Ø©", "Ù…ÙƒØªÙ…Ù„Ø©"), ("Ù…Ù„ØºØ§Ø©", "Ù…Ù„ØºØ§Ø©")]
        for text, value in statuses:
            ttk.Radiobutton(status_frame, text=text, variable=status_var, 
                            value=value).pack(side=tk.LEFT, padx=5)
        
        form_frame.columnconfigure(1, weight=1)
        
        def save():
            try:
                device_name = entries["Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²:"].get().strip()
                owner_name = entries["Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:"].get().strip()
                if not device_name or not owner_name:
                    raise ValueError("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ")
                
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    c.execute('''INSERT INTO repairs 
                              (device_name, owner_name, owner_phone, status, entry_date, description, estimated_cost) 
                              VALUES (?, ?, ?, ?, ?, ?, ?)''',
                             (device_name,
                              owner_name,
                              entries["Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:"].get().strip(),
                              status_var.get(),
                              datetime.now().date(),
                              entries["ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:"].get("1.0", tk.END).strip(),
                              float(entries["Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©:"].get() or 0)))
                    conn.commit()
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!")
                logging.info(f"ØªÙ… Ø¥Ø¶Ø§ÙØ© ØµÙŠØ§Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø¬Ù‡Ø§Ø²: {device_name}")
                window.destroy()
                self.show_dashboard()
            except ValueError as ve:
                messagebox.showerror("Ø®Ø·Ø£", str(ve))
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: {str(e)}")
                logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙŠØ§Ù†Ø©: {str(e)}")
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=20)
        
        tk.Button(btn_frame, text="Ø­ÙØ¸", bg=self.colors['success'], fg='white',
                  font=('Arial', 11, 'bold'), command=save, width=10).pack(side=tk.LEFT, padx=10)
        
        tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡", bg=self.colors['danger'], fg='white',
                  font=('Arial', 11, 'bold'), command=window.destroy, width=10).pack(side=tk.LEFT, padx=10)

    def show_repairs(self):
        window = tk.Toplevel(self.root)
        window.title("Ø¹Ø±Ø¶ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª")
        window.geometry("1000x600")
        window.configure(bg='white')
        self.center_window(window)
        
        title_frame = tk.Frame(window, bg='white')
        title_frame.pack(fill=tk.X, padx=20, pady=10)
        
        tk.Label(title_frame, text="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", 
                 font=('Arial', 16, 'bold'), bg='white').pack()
        
        search_frame = tk.Frame(window, bg='white')
        search_frame.pack(fill=tk.X, padx=20, pady=10)
        
        tk.Label(search_frame, text="Ø¨Ø­Ø«:", font=('Arial', 11), bg='white').pack(side=tk.LEFT)
        search_entry = tk.Entry(search_frame, font=('Arial', 11), width=30, bg='#f8f9fa')
        search_entry.pack(side=tk.LEFT, padx=10)
        
        def search():
            load_data(search_entry.get())
        
        tk.Button(search_frame, text="Ø¨Ø­Ø«", bg=self.colors['primary'], fg='white',
                  command=search).pack(side=tk.LEFT, padx=5)
        tk.Button(search_frame, text="Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„", bg=self.colors['secondary'], fg='white',
                  command=lambda: load_data()).pack(side=tk.LEFT, padx=5)
        
        tree_frame = tk.Frame(window)
        tree_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=10)
        
        tree = ttk.Treeview(tree_frame, columns=("ID", "Ø§Ù„Ø¬Ù‡Ø§Ø²", "Ø§Ù„Ù…Ø§Ù„Ùƒ", "Ø§Ù„Ù‡Ø§ØªÙ", "Ø§Ù„Ø­Ø§Ù„Ø©", "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©", "Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©", "ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„"), show="headings")
        
        columns = [
            ("ID", 50),
            ("Ø§Ù„Ø¬Ù‡Ø§Ø²", 120),
            ("Ø§Ù„Ù…Ø§Ù„Ùƒ", 120),
            ("Ø§Ù„Ù‡Ø§ØªÙ", 100),
            ("Ø§Ù„Ø­Ø§Ù„Ø©", 100),
            ("Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©", 100),
            ("Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©", 100),
            ("ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„", 100)
        ]
        
        for col, width in columns:
            tree.heading(col, text=col)
            tree.column(col, width=width)
        
        scrollbar = ttk.Scrollbar(tree_frame, orient=tk.VERTICAL, command=tree.yview)
        tree.configure(yscrollcommand=scrollbar.set)
        tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
        def load_data(search_text=""):
            for item in tree.get_children():
                tree.delete(item)
            
            with sqlite3.connect('workshop.db') as conn:
                c = conn.cursor()
                
                if search_text:
                    c.execute('''SELECT id, device_name, owner_name, owner_phone, status, estimated_cost, final_cost, entry_date FROM repairs 
                              WHERE device_name LIKE ? OR owner_name LIKE ? OR owner_phone LIKE ?''',
                             (f"%{search_text}%", f"%{search_text}%", f"%{search_text}%"))
                else:
                    c.execute("SELECT id, device_name, owner_name, owner_phone, status, estimated_cost, final_cost, entry_date FROM repairs ORDER BY id DESC")
                
                rows = c.fetchall()
                for row in rows:
                    tree.insert("", "end", values=row)
        
        load_data()
        
        def complete_repair():
            selected = tree.selection()
            if not selected:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙŠØ§Ù†Ø© Ù„Ø¥ÙƒÙ…Ø§Ù„Ù‡Ø§")
                return
            
            item = tree.item(selected[0])
            values = item['values']
            if values[4] != "Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­":
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "Ø§Ù„ØµÙŠØ§Ù†Ø© Ù„ÙŠØ³Øª Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­")
                return
            
            complete_window = tk.Toplevel(window)
            complete_window.title("Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©")
            complete_window.geometry("400x200")
            complete_window.configure(bg='white')
            self.center_window(complete_window)
            
            tk.Label(complete_window, text="Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©", font=('Arial', 14, 'bold'), bg='white').pack(pady=15)
            
            form_frame = tk.Frame(complete_window, bg='white')
            form_frame.pack(fill=tk.BOTH, expand=True, padx=30)
            
            tk.Label(form_frame, text="Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:", font=('Arial', 11), bg='white').grid(row=0, column=0, sticky='e', pady=10)
            final_cost_entry = tk.Entry(form_frame, font=('Arial', 12), bg='#f8f9fa', width=20)
            final_cost_entry.grid(row=0, column=1, sticky='ew', pady=10, padx=10)
            final_cost_entry.insert(0, str(values[5]))
            final_cost_entry.focus()
            
            form_frame.columnconfigure(1, weight=1)
            
            def update():
                try:
                    final_cost = float(final_cost_entry.get())
                    
                    with sqlite3.connect('workshop.db') as conn:
                        c = conn.cursor()
                        c.execute("UPDATE repairs SET status=?, exit_date=?, final_cost=? WHERE id=?", 
                                  ("Ù…ÙƒØªÙ…Ù„Ø©", datetime.now().date(), final_cost, values[0]))
                        conn.commit()
                    
                    details = {
                        "Repair ID / Ø±Ù‚Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©": values[0],
                        "Device / Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²": values[1],
                        "Owner / Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ": values[2],
                        "Phone / Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ": values[3] or "N/A",
                        "Status / Ø§Ù„Ø­Ø§Ù„Ø©": "Completed / Ù…ÙƒØªÙ…Ù„Ø©",
                        "Final Cost / Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©": f"${final_cost:.2f}",
                        "Entry Date / ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„": values[7],
                        "Exit Date / ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬": datetime.now().date()
                    }
                    print_pdf("Repair Receipt - Ø§ÙŠØµØ§Ù„ Ø®Ø±ÙˆØ¬ ØµÙŠØ§Ù†Ø©", details)
                    
                    messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!")
                    logging.info(f"ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ ØµÙŠØ§Ù†Ø© ID: {values[0]}")
                    complete_window.destroy()
                    load_data()
                except ValueError:
                    messagebox.showerror("Ø®Ø·Ø£", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªÙƒÙ„ÙØ© ØµØ­ÙŠØ­Ø©")
                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£: {str(e)}")
                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©: {str(e)}")
            
            btn_frame = tk.Frame(complete_window, bg='white')
            btn_frame.pack(pady=15)
            
            tk.Button(btn_frame, text="Ø¥ÙƒÙ…Ø§Ù„ ÙˆØ·Ø¨Ø§Ø¹Ø©", bg=self.colors['success'], fg='white',
                      font=('Arial', 11, 'bold'), command=update, width=12).pack(side=tk.LEFT, padx=5)
            tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡", bg=self.colors['danger'], fg='white',
                      font=('Arial', 11, 'bold'), command=complete_window.destroy, width=10).pack(side=tk.LEFT, padx=5)
        
        def delete_repair():
            selected = tree.selection()
            if not selected:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙŠØ§Ù†Ø© Ù„Ù„Ø­Ø°Ù")
                return
            
            if messagebox.askyesno("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù", "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙŠØ§Ù†Ø©ØŸ\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!"):
                item = tree.item(selected[0])
                repair_id = item['values'][0]
                
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    c.execute("DELETE FROM repairs WHERE id=?", (repair_id,))
                    conn.commit()
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙŠØ§Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!")
                logging.info(f"ØªÙ… Ø­Ø°Ù ØµÙŠØ§Ù†Ø© ID: {repair_id}")
                load_data()
        
        def print_repair():
            selected = tree.selection()
            if not selected:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙŠØ§Ù†Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©")
                return
            
            item = tree.item(selected[0])
            values = item['values']
            
            with sqlite3.connect('workshop.db') as conn:
                c = conn.cursor()
                c.execute("SELECT * FROM repairs WHERE id=?", (values[0],))
                full_data = c.fetchone()
            
            details = {
                "Repair ID / Ø±Ù‚Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©": full_data[0],
                "Device / Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø§Ø²": full_data[1],
                "Owner / Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ": full_data[2],
                "Phone / Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ": full_data[3] or "N/A",
                "Status / Ø§Ù„Ø­Ø§Ù„Ø©": full_data[4],
                "Est. Cost / Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©": f"${full_data[8]:.2f}" if full_data[8] else "$0.00",
                "Final Cost / Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©": f"${full_data[9]:.2f}" if full_data[9] else "$0.00",
                "Entry Date / ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„": full_data[5],
                "Exit Date / ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬": full_data[6] or "N/A",
                "Description / ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": full_data[7] or "N/A"
            }
            print_pdf("Repair Receipt - Ø§ÙŠØµØ§Ù„ ØµÙŠØ§Ù†Ø©", details)
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=10)
        
        tk.Button(btn_frame, text="Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø©", bg=self.colors['success'], fg='white',
                  font=('Arial', 10, 'bold'), command=complete_repair, width=12).pack(side=tk.LEFT, padx=5)
        tk.Button(btn_frame, text="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„", bg=self.colors['info'], fg='white',
                  font=('Arial', 10, 'bold'), command=print_repair, width=12).pack(side=tk.LEFT, padx=5)
        tk.Button(btn_frame, text="Ø­Ø°Ù", bg=self.colors['danger'], fg='white',
                  font=('Arial', 10, 'bold'), command=delete_repair, width=10).pack(side=tk.LEFT, padx=5)
        tk.Button(btn_frame, text="Ø¥ØºÙ„Ø§Ù‚", bg=self.colors['primary'], fg='white',
                  font=('Arial', 10, 'bold'), command=window.destroy, width=10).pack(side=tk.LEFT, padx=5)

    def show_sales(self):
        window = tk.Toplevel(self.root)
        window.title("Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª")
        window.geometry("1000x600")
        window.configure(bg='white')
        self.center_window(window)
        
        title_frame = tk.Frame(window, bg='white')
        title_frame.pack(fill=tk.X, padx=20, pady=10)
        
        tk.Label(title_frame, text="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", 
                 font=('Arial', 16, 'bold'), bg='white').pack()
        
        search_frame = tk.Frame(window, bg='white')
        search_frame.pack(fill=tk.X, padx=20, pady=10)
        
        tk.Label(search_frame, text="Ø¨Ø­Ø«:", font=('Arial', 11), bg='white').pack(side=tk.LEFT)
        search_entry = tk.Entry(search_frame, font=('Arial', 11), width=30, bg='#f8f9fa')
        search_entry.pack(side=tk.LEFT, padx=10)
        
        def search():
            load_data(search_entry.get())
        
        tk.Button(search_frame, text="Ø¨Ø­Ø«", bg=self.colors['primary'], fg='white',
                  command=search).pack(side=tk.LEFT, padx=5)
        tk.Button(search_frame, text="Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„", bg=self.colors['secondary'], fg='white',
                  command=lambda: load_data()).pack(side=tk.LEFT, padx=5)
        
        tree_frame = tk.Frame(window)
        tree_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=10)
        
        tree = ttk.Treeview(tree_frame, columns=("ID", "Ø§Ù„Ù…Ù†ØªØ¬", "Ø§Ù„Ø²Ø¨ÙˆÙ†", "Ø§Ù„Ù‡Ø§ØªÙ", "Ø§Ù„Ù†ÙˆØ¹", "Ø§Ù„Ø£Ù‚Ø³Ø§Ø·", "Ø§Ù„Ù…Ø¨Ù„Øº", "Ø§Ù„Ù…Ø¯ÙÙˆØ¹", "Ø§Ù„ØªØ§Ø±ÙŠØ®"), show="headings")
        
        columns = [
            ("ID", 50),
            ("Ø§Ù„Ù…Ù†ØªØ¬", 150),
            ("Ø§Ù„Ø²Ø¨ÙˆÙ†", 120),
            ("Ø§Ù„Ù‡Ø§ØªÙ", 100),
            ("Ø§Ù„Ù†ÙˆØ¹", 80),
            ("Ø§Ù„Ø£Ù‚Ø³Ø§Ø·", 80),
            ("Ø§Ù„Ù…Ø¨Ù„Øº", 100),
            ("Ø§Ù„Ù…Ø¯ÙÙˆØ¹", 100),
            ("Ø§Ù„ØªØ§Ø±ÙŠØ®", 100)
        ]
        
        for col, width in columns:
            tree.heading(col, text=col)
            tree.column(col, width=width)
        
        scrollbar = ttk.Scrollbar(tree_frame, orient=tk.VERTICAL, command=tree.yview)
        tree.configure(yscrollcommand=scrollbar.set)
        tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
        def load_data(search_text=""):
            for item in tree.get_children():
                tree.delete(item)
            
            with sqlite3.connect('workshop.db') as conn:
                c = conn.cursor()
                
                if search_text:```python
                    c.execute('''SELECT id, device_name, customer_name, customer_phone, sale_type, 
                              installments_remaining, amount, paid_amount, sale_date FROM sales 
                              WHERE device_name LIKE ? OR customer_name LIKE ? OR customer_phone LIKE ?''',
                             (f"%{search_text}%", f"%{search_text}%", f"%{search_text}%"))
                else:
                    c.execute('''SELECT id, device_name, customer_name, customer_phone, sale_type, 
                              installments_remaining, amount, paid_amount, sale_date FROM sales ORDER BY id DESC''')
                
                rows = c.fetchall()
                for row in rows:
                    tree.insert("", "end", values=row)
        
        load_data()
        
        def delete_sale():
            selected = tree.selection()
            if not selected:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ù„Ù„Ø­Ø°Ù")
                return
            
            if messagebox.askyesno("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù", "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!"):
                item = tree.item(selected[0])
                sale_id = item['values'][0]
                
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    c.execute("DELETE FROM sales WHERE id=?", (sale_id,))
                    conn.commit()
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­!")
                logging.info(f"ØªÙ… Ø­Ø°Ù Ø¨ÙŠØ¹ ID: {sale_id}")
                load_data()
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=10)
        
        tk.Button(btn_frame, text="Ø­Ø°Ù", bg=self.colors['danger'], fg='white',
                  font=('Arial', 10, 'bold'), command=delete_sale, width=10).pack(side=tk.LEFT, padx=5)
        tk.Button(btn_frame, text="Ø¥ØºÙ„Ø§Ù‚", bg=self.colors['primary'], fg='white',
                  font=('Arial', 10, 'bold'), command=window.destroy, width=10).pack(side=tk.LEFT, padx=5)

    def pay_installment(self):
        window = tk.Toplevel(self.root)
        window.title("Ø¯ÙØ¹ Ù‚Ø³Ø·")
        window.geometry("700x550")
        window.configure(bg='white')
        self.center_window(window)
        
        header_frame = tk.Frame(window, bg=self.colors['primary'], height=80)
        header_frame.pack(fill=tk.X)
        header_frame.pack_propagate(False)
        
        tk.Label(header_frame, text="ğŸ’° Ø¯ÙØ¹ Ù‚Ø³Ø·", 
                 font=('Arial', 20, 'bold'), 
                 bg=self.colors['primary'], 
                 fg='white').pack(expand=True)
        
        search_frame = tk.Frame(window, bg='white')
        search_frame.pack(fill=tk.X, padx=30, pady=20)
        
        tk.Label(search_frame, text="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹:", 
                 font=('Arial', 12, 'bold'), 
                 bg='white').pack(anchor='w', pady=(0, 10))
        
        search_input_frame = tk.Frame(search_frame, bg='white')
        search_input_frame.pack(fill=tk.X)
        
        tk.Label(search_input_frame, text="Ø±Ù‚Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†:", 
                 font=('Arial', 11), 
                 bg='white').pack(side=tk.LEFT, padx=(0, 10))
        
        search_entry = tk.Entry(search_input_frame, font=('Arial', 12), bg='#f8f9fa', width=25)
        search_entry.pack(side=tk.LEFT, padx=5)
        
        info_frame = tk.Frame(window, bg='#f8f9fa', relief='raised', bd=2)
        info_frame.pack(fill=tk.BOTH, expand=True, padx=30, pady=10)
        
        tk.Label(info_frame, text="Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨ÙŠØ¹", 
                 font=('Arial', 13, 'bold'), 
                 bg='#f8f9fa').pack(pady=10)
        
        data_frame = tk.Frame(info_frame, bg='white', relief='solid', bd=1)
        data_frame.pack(fill=tk.BOTH, expand=True, padx=15, pady=10)
        
        info_labels = {}
        info_fields = [
            ("Ø±Ù‚Ù… Ø§Ù„Ø¨ÙŠØ¹:", "sale_id"),
            ("Ø§Ù„Ù…Ù†ØªØ¬:", "product"),
            ("Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†:", "customer"),
            ("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:", "phone"),
            ("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ:", "total"),
            ("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:", "paid"),
            ("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:", "remaining"),
            ("Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©:", "installments")
        ]
        
        for i, (label, key) in enumerate(info_fields):
            row_frame = tk.Frame(data_frame, bg='white')
            row_frame.pack(fill=tk.X, padx=10, pady=5)
            
            tk.Label(row_frame, text=label, 
                     font=('Arial', 11, 'bold'), 
                     bg='white', 
                     width=18, 
                     anchor='e').pack(side=tk.LEFT, padx=5)
            
            value_label = tk.Label(row_frame, text="---", 
                                   font=('Arial', 11), 
                                   bg='white', 
                                   fg=self.colors['dark'],
                                   anchor='w')
            value_label.pack(side=tk.LEFT, padx=10)
            info_labels[key] = value_label
        
        payment_frame = tk.Frame(window, bg='white')
        payment_frame.pack(fill=tk.X, padx=30, pady=15)
        
        tk.Label(payment_frame, text="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¯ÙØ¹Ù‡:", 
                 font=('Arial', 12, 'bold'), 
                 bg='white').grid(row=0, column=0, sticky='e', padx=10, pady=10)
        
        amount_entry = tk.Entry(payment_frame, font=('Arial', 14, 'bold'), 
                               bg='#fff3cd', width=20, justify='center')
        amount_entry.grid(row=0, column=1, padx=10, pady=10)
        
        payment_frame.columnconfigure(1, weight=1)
        
        current_sale_id = [None]
        
        def search_sale():
            search_text = search_entry.get().strip()
            if not search_text:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¨ÙŠØ¹ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†")
                return
            
            try:
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    
                    if search_text.isdigit():
                        c.execute('''SELECT id, device_name, customer_name, customer_phone, 
                                  amount, paid_amount, installments_remaining 
                                  FROM sales WHERE id=? AND sale_type='Ø£Ù‚Ø³Ø§Ø·' ''', (int(search_text),))
                    else:
                        c.execute('''SELECT id, device_name, customer_name, customer_phone, 
                                  amount, paid_amount, installments_remaining 
                                  FROM sales WHERE customer_name LIKE ? AND sale_type='Ø£Ù‚Ø³Ø§Ø·' 
                                  ORDER BY id DESC LIMIT 1''', (f"%{search_text}%",))
                    
                    sale = c.fetchone()
                    
                    if not sale:
                        messagebox.showwarning("ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
                        return
                    
                    if sale[6] <= 0:
                        messagebox.showinfo("Ù…ÙƒØªÙ…Ù„", "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ù…Ø¯ÙÙˆØ¹Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨ÙŠØ¹!")
                        return
                    
                    current_sale_id[0] = sale[0]
                    info_labels['sale_id'].config(text=str(sale[0]), fg=self.colors['primary'])
                    info_labels['product'].config(text=sale[1])
                    info_labels['customer'].config(text=sale[2])
                    info_labels['phone'].config(text=sale[3] or "ØºÙŠØ± Ù…Ø­Ø¯Ø¯")
                    info_labels['total'].config(text=f"${sale[4]:.2f}", fg=self.colors['dark'])
                    info_labels['paid'].config(text=f"${sale[5]:.2f}", fg=self.colors['success'])
                    
                    remaining_amount = sale[4] - sale[5]
                    info_labels['remaining'].config(text=f"${remaining_amount:.2f}", 
                                                   fg=self.colors['danger'], 
                                                   font=('Arial', 11, 'bold'))
                    info_labels['installments'].config(text=str(sale[6]), 
                                                       fg=self.colors['warning'],
                                                       font=('Arial', 11, 'bold'))
                    
                    suggested_amount = remaining_amount / sale[6]
                    amount_entry.delete(0, tk.END)
                    amount_entry.insert(0, f"{suggested_amount:.2f}")
                    amount_entry.focus()
                    
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«: {str(e)}")
                logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨ÙŠØ¹: {str(e)}")
        
        def process_payment():
            if current_sale_id[0] is None:
                messagebox.showwarning("ØªØ­Ø°ÙŠØ±", "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø£ÙˆÙ„Ø§Ù‹")
                return
            
            try:
                amount = float(amount_entry.get())
                if amount <= 0:
                    raise ValueError("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±")
                
                with sqlite3.connect('workshop.db') as conn:
                    c = conn.cursor()
                    
                    c.execute('''SELECT installments_remaining, amount, paid_amount, 
                              device_name, customer_name, customer_phone 
                              FROM sales WHERE id=?''', (current_sale_id[0],))
                    sale = c.fetchone()
                    
                    if not sale:
                        raise ValueError("Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©")
                    
                    if sale[0] <= 0:
                        raise ValueError("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ø· Ù…ØªØ¨Ù‚ÙŠØ©")
                    
                    remaining_amount = sale[1] - sale[2]
                    if amount > remaining_amount:
                        if not messagebox.askyesno("ØªØ£ÙƒÙŠØ¯", 
                                                   f"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯Ø®Ù„ (${amount:.2f}) Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (${remaining_amount:.2f})\n"
                                                   "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ"):
                            return
                    
                    new_installments = max(0, sale[0] - 1)
                    new_paid_amount = sale[2] + amount
                    
                    c.execute('''UPDATE sales SET installments_remaining=?, paid_amount=? 
                              WHERE id=?''', (new_installments, new_paid_amount, current_sale_id[0]))
                    conn.commit()
                
                details = {
                    "Sale ID / Ø±Ù‚Ù… Ø§Ù„Ø¨ÙŠØ¹": current_sale_id[0],
                    "Product / Ø§Ù„Ù…Ù†ØªØ¬": sale[3],
                    "Customer / Ø§Ù„Ø²Ø¨ÙˆÙ†": sale[4],
                    "Phone / Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ": sale[5] or "N/A",
                    "Payment / Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹": f"${amount:.2f}",
                    "Remaining Inst. / Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©": new_installments,
                    "Total Paid / Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹": f"${new_paid_amount:.2f}",
                    "Total Amount / Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒÙ„ÙŠ": f"${sale[1]:.2f}",
                    "Balance / Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ": f"${sale[1] - new_paid_amount:.2f}"
                }
                print_pdf("Installment Receipt - Ø§ÙŠØµØ§Ù„ Ø¯ÙØ¹ Ù‚Ø³Ø·", details)
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­ âœ“", 
                                   f"ØªÙ… Ø¯ÙØ¹ Ø§Ù„Ù‚Ø³Ø· Ø¨Ù†Ø¬Ø§Ø­!\n\n"
                                   f"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${amount:.2f}\n"
                                   f"Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: {new_installments}\n"
                                   f"Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${sale[1] - new_paid_amount:.2f}")
                logging.info(f"ØªÙ… Ø¯ÙØ¹ Ù‚Ø³Ø· Ù„Ù„Ø¨ÙŠØ¹ ID: {current_sale_id[0]}, Ø§Ù„Ù…Ø¨Ù„Øº: ${amount:.2f}")
                
                window.destroy()
                self.show_dashboard()
                
            except ValueError as ve:
                messagebox.showerror("Ø®Ø·Ø£", str(ve))
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¯ÙØ¹: {str(e)}")
                logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¯ÙØ¹ Ø§Ù„Ù‚Ø³Ø·: {str(e)}")
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=15)
        
        tk.Button(btn_frame, text="ğŸ” Ø¨Ø­Ø«", bg=self.colors['info'], fg='white',
                  font=('Arial', 11, 'bold'), command=search_sale, 
                  width=12, height=2).pack(side=tk.LEFT, padx=5)
        
        tk.Button(btn_frame, text="ğŸ’³ Ø¯ÙØ¹ ÙˆØ·Ø¨Ø§Ø¹Ø©", bg=self.colors['success'], fg='white',
                  font=('Arial', 11, 'bold'), command=process_payment, 
                  width=15, height=2).pack(side=tk.LEFT, padx=5)
        
        tk.Button(btn_frame, text="âœ– Ø¥Ù„ØºØ§Ø¡", bg=self.colors['danger'], fg='white',
                  font=('Arial', 11, 'bold'), command=window.destroy, 
                  width=10, height=2).pack(side=tk.LEFT, padx=5)
        
        search_entry.bind('<Return>', lambda e: search_sale())
        search_entry.focus()

    def show_reports(self):
        window = tk.Toplevel(self.root)
        window.title("Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª")
        window.geometry("700x700")
        window.configure(bg='white')
        self.center_window(window)
        
        header_frame = tk.Frame(window, bg=self.colors['purple'], height=80)
        header_frame.pack(fill=tk.X)
        header_frame.pack_propagate(False)
        
        tk.Label(header_frame, text="ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª", 
                 font=('Arial', 18, 'bold'), 
                 bg=self.colors['purple'], 
                 fg='white').pack(expand=True)
        
        report_frame = tk.Frame(window, bg='white')
        report_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)
        
        with sqlite3.connect('workshop.db') as conn:
            c = conn.cursor()
            
            c.execute("SELECT COUNT(*) FROM repairs")
            total_repairs = c.fetchone()[0]
            
            c.execute("SELECT COUNT(*) FROM repairs WHERE status='Ù…ÙƒØªÙ…Ù„Ø©'")
            completed_repairs = c.fetchone()[0]
            
            c.execute("SELECT COUNT(*) FROM repairs WHERE status='Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­'")
            pending_repairs = c.fetchone()[0]
            
            c.execute("SELECT SUM(final_cost) FROM repairs WHERE status='Ù…ÙƒØªÙ…Ù„Ø©'")
            total_repairs_revenue = c.fetchone()[0] or 0
            
            c.execute("SELECT COUNT(*) FROM sales")
            total_sales = c.fetchone()[0]
            
            c.execute("SELECT SUM(amount) FROM sales")
            total_revenue = c.fetchone()[0] or 0
            
            c.execute("SELECT SUM(amount) FROM sales WHERE strftime('%Y-%m', sale_date)=strftime('%Y-%m', 'now')")
            monthly_revenue = c.fetchone()[0] or 0
            
            c.execute("SELECT SUM(paid_amount) FROM sales")
            total_paid = c.fetchone()[0] or 0
            
            c.execute("SELECT COUNT(*) FROM products")
            total_products = c.fetchone()[0]
            
            c.execute("SELECT SUM(quantity) FROM products")
            total_quantity = c.fetchone()[0] or 0
            
            c.execute("SELECT COUNT(*) FROM products WHERE quantity < 5")
            low_stock = c.fetchone()[0]
        
        categories = [
            ("ğŸ“‹ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", [
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", total_repairs, 'primary'),
                ("Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©", completed_repairs, 'success'),
                ("Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­", pending_repairs, 'warning'),
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", f"${total_repairs_revenue:.2f}", 'info')
            ]),
            ("ğŸ’° Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", [
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", total_sales, 'primary'),
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª", f"${total_revenue:.2f}", 'success'),
                ("Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ", f"${monthly_revenue:.2f}", 'info'),
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©", f"${total_paid:.2f}", 'secondary'),
                ("Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©", f"${total_revenue - total_paid:.2f}", 'danger')
            ]),
            ("ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", [
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", total_products, 'primary'),
                ("Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©", total_quantity, 'success'),
                ("Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†", low_stock, 'warning')
            ])
        ]
        
        for category_name, items in categories:
            cat_frame = tk.LabelFrame(report_frame, text=category_name, 
                                     font=('Arial', 12, 'bold'),
                                     bg='white', fg=self.colors['dark'],
                                     relief='raised', bd=2)
            cat_frame.pack(fill=tk.X, pady=10)
            
            for title, value, color in items:
                item_frame = tk.Frame(cat_frame, bg='white')
                item_frame.pack(fill=tk.X, padx=15, pady=5)
                
                tk.Label(item_frame, text=title, 
                        font=('Arial', 11), 
                        bg='white',
                        anchor='w').pack(side=tk.LEFT)
                
                tk.Label(item_frame, text=str(value), 
                        font=('Arial', 11, 'bold'), 
                        bg='white',
                        fg=self.colors[color],
                        anchor='e').pack(side=tk.RIGHT)
        
        def export_report():
            reports = [
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", total_repairs),
                ("Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©", completed_repairs),
                ("Ø§Ù„ØµÙŠØ§Ù†Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­", pending_repairs),
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", f"${total_repairs_revenue:.2f}"),
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", total_sales),
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª", f"${total_revenue:.2f}"),
                ("Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±", f"${monthly_revenue:.2f}"),
                ("Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", total_products),
                ("Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©", total_quantity),
                ("Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†", low_stock)
            ]
            
            filename = f"report_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv"
            with open(filename, 'w', newline='', encoding='utf-8-sig') as file:
                writer = csv.writer(file)
                writer.writerow(['Ø§Ù„ØªÙ‚Ø±ÙŠØ±', 'Ø§Ù„Ù‚ÙŠÙ…Ø©'])
                for title, value in reports:
                    writer.writerow([title, value])
            
            messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰:\n{filename}")
            logging.info(f"ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±: {filename}")
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=15)
        
        tk.Button(btn_frame, text="ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±", bg=self.colors['primary'], fg='white',
                  font=('Arial', 11, 'bold'), command=export_report, width=15).pack(side=tk.LEFT, padx=5)
        tk.Button(btn_frame, text="Ø¥ØºÙ„Ø§Ù‚", bg=self.colors['danger'], fg='white',
                  font=('Arial', 11, 'bold'), command=window.destroy, width=10).pack(side=tk.LEFT, padx=5)

    def change_password(self):
        window = tk.Toplevel(self.root)
        window.title("ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±")
        window.geometry("400x300")
        window.configure(bg='white')
        self.center_window(window)
        
        title_label = tk.Label(window, text="ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±", 
                               font=('Arial', 16, 'bold'), bg='white')
        title_label.pack(pady=20)
        
        form_frame = tk.Frame(window, bg='white')
        form_frame.pack(fill=tk.BOTH, expand=True, padx=30)
        
        tk.Label(form_frame, text="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:", font=('Arial', 11), bg='white').grid(row=0, column=0, sticky='e', pady=10)
        new_password_entry = tk.Entry(form_frame, show="*", font=('Arial', 11), bg='#f8f9fa')
        new_password_entry.grid(row=0, column=1, sticky='ew', pady=10, padx=10)
        
        tk.Label(form_frame, text="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:", font=('Arial', 11), bg='white').grid(row=1, column=0, sticky='e', pady=10)
        confirm_password_entry = tk.Entry(form_frame, show="*", font=('Arial', 11), bg='#f8f9fa')
        confirm_password_entry.grid(row=1, column=1, sticky='ew', pady=10, padx=10)
        
        form_frame.columnconfigure(1, weight=1)
        
        def save():
            new_password = new_password_entry.get()
            confirm_password = confirm_password_entry.get()
            
            if len(new_password) < 6:
                messagebox.showerror("Ø®Ø·Ø£", "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„")
                return
            
            if new_password != confirm_password:
                messagebox.showerror("Ø®Ø·Ø£", "ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©")
                return
            
            self.password_hash = hash_password(new_password)
            messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!")
            logging.info("ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±")
            window.destroy()
        
        btn_frame = tk.Frame(window, bg='white')
        btn_frame.pack(pady=20)
        
        tk.Button(btn_frame, text="Ø­ÙØ¸", bg=self.colors['success'], fg='white',
                  font=('Arial', 11, 'bold'), command=save, width=10).pack(side=tk.LEFT, padx=10)
        
        tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡", bg=self.colors['danger'], fg='white',
                  font=('Arial', 11, 'bold'), command=window.destroy, width=10).pack(side=tk.LEFT, padx=10)

    def backup_data(self):
        filename = filedialog.asksaveasfilename(
            defaultextension=".db",
            filetypes=[("Database files", "*.db"), ("All files", "*.*")],
            title="Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©"
        )
        if filename:
            try:
                shutil.copy2('workshop.db', filename)
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙÙŠ:\n{filename}")
                logging.info(f"ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: {filename}")
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ: {str(e)}")
                logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ: {str(e)}")

    def export_data(self):
        filename = filedialog.asksaveasfilename(
            defaultextension=".csv",
            filetypes=[("CSV files", "*.csv"), ("All files", "*.*")],
            title="ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
        )
        if filename:
            try:
                with sqlite3.connect('workshop.db') as conn:
                    repairs_file = filename.replace('.csv', '_repairs.csv')
                    c = conn.cursor()
                    c.execute("SELECT * FROM repairs")
                    repairs_data = c.fetchall()
                    with open(repairs_file, 'w', newline='', encoding='utf-8-sig') as f:
                        writer = csv.writer(f)
                        writer.writerow(['ID', 'Ø§Ù„Ø¬Ù‡Ø§Ø²', 'Ø§Ù„Ù…Ø§Ù„Ùƒ', 'Ø§Ù„Ù‡Ø§ØªÙ', 'Ø§Ù„Ø­Ø§Ù„Ø©', 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„', 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬', 'Ø§Ù„ÙˆØµÙ', 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©', 'Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©'])
                        writer.writerows(repairs_data)
                    
                    sales_file = filename.replace('.csv', '_sales.csv')
                    c.execute("SELECT * FROM sales")
                    sales_data = c.fetchall()
                    with open(sales_file, 'w', newline='', encoding='utf-8-sig') as f:
                        writer = csv.writer(f)
                        writer.writerow(['ID', 'Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬', 'Ø§Ù„Ù…Ù†ØªØ¬', 'Ø§Ù„Ø²Ø¨ÙˆÙ†', 'Ø§Ù„Ù‡Ø§ØªÙ', 'Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹', 'Ø§Ù„Ø£Ù‚Ø³Ø§Ø· Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„Ù…Ø¨Ù„Øº', 'Ø§Ù„Ù…Ø¯ÙÙˆØ¹', 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª'])
                        writer.writerows(sales_data)
                    
                    products_file = filename.replace('.csv', '_products.csv')
                    c.execute("SELECT * FROM products")
                    products_data = c.fetchall()
                    with open(products_file, 'w', newline='', encoding='utf-8-sig') as f:
                        writer = csv.writer(f)
                        writer.writerow(['ID', 'Ø§Ù„Ù…Ù†ØªØ¬', 'Ø§Ù„ÙØ¦Ø©', 'Ø§Ù„Ø³Ø¹Ø±', 'Ø§Ù„ÙƒÙ…ÙŠØ©', 'Ø§Ù„ÙˆØµÙ', 'Ø§Ù„ØªØ§Ø±ÙŠØ®', 'Ø§Ù„ØªØ­Ø¯ÙŠØ«'])
                        writer.writerows(products_data)
                
                messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰:\nâ€¢ {repairs_file}\nâ€¢ {sales_file}\nâ€¢ {products_file}")
                logging.info(f"ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
            except Exception as e:
                messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±: {str(e)}")
                logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±: {str(e)}")

    def import_data(self):
        """Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„ÙØ§Øª CSV"""
        import_window = tk.Toplevel(self.root)
        import_window.title("Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
        import_window.geometry("500x400")
        import_window.configure(bg='white')
        self.center_window(import_window)
        
        tk.Label(import_window, text="Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„ÙØ§Øª CSV", 
                 font=('Arial', 16, 'bold'), bg='white').pack(pady=20)
        
        info_frame = tk.Frame(import_window, bg='#e8f4f8', relief='ridge', bd=2)
        info_frame.pack(fill=tk.X, padx=20, pady=10)
        
        tk.Label(info_frame, text="Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ù„ÙØ§Øª CSV Ø¨Ù†ÙØ³ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØµØ¯ÙŠØ±", 
                 font=('Arial', 10), bg='#e8f4f8', fg='#0066cc').pack(pady=10)
        
        btn_frame = tk.Frame(import_window, bg='white')
        btn_frame.pack(expand=True, pady=20)
        
        def import_repairs():
            filename = filedialog.askopenfilename(
                title="Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„ØµÙŠØ§Ù†Ø§Øª",
                filetypes=[("CSV files", "*.csv"), ("All files", "*.*")]
            )
            if filename:
                try:```python
                    with open(filename, 'r', encoding='utf-8-sig') as f:
                        reader = csv.reader(f)
                        next(reader)  # ØªØ®Ø·ÙŠ Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                        
                        with sqlite3.connect('workshop.db') as conn:
                            c = conn.cursor()
                            count = 0
                            for row in reader:
                                try:
                                    c.execute('''INSERT INTO repairs 
                                              (device_name, owner_name, owner_phone, status, entry_date, 
                                              exit_date, description, estimated_cost, final_cost) 
                                              VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)''',
                                             (row[1], row[2], row[3], row[4], row[5], 
                                              row[6] if row[6] else None, row[7], 
                                              float(row[8]) if row[8] else 0, 
                                              float(row[9]) if row[9] else 0))
                                    count += 1
                                except Exception as e:
                                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø³Ø·Ø±: {e}")
                                    continue
                            conn.commit()
                    
                    messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ {count} ØµÙŠØ§Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­!")
                    logging.info(f"ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ {count} ØµÙŠØ§Ù†Ø©")
                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: {str(e)}")
                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª: {str(e)}")
        
        def import_sales():
            filename = filedialog.askopenfilename(
                title="Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",
                filetypes=[("CSV files", "*.csv"), ("All files", "*.*")]
            )
            if filename:
                try:
                    with open(filename, 'r', encoding='utf-8-sig') as f:
                        reader = csv.reader(f)
                        next(reader)  # ØªØ®Ø·ÙŠ Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                        
                        with sqlite3.connect('workshop.db') as conn:
                            c = conn.cursor()
                            count = 0
                            for row in reader:
                                try:
                                    c.execute('''INSERT INTO sales 
                                              (product_id, device_name, customer_name, customer_phone, 
                                              sale_type, installments_remaining, sale_date, amount, 
                                              paid_amount, notes) 
                                              VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)''',
                                             (int(row[1]) if row[1] else None, row[2], row[3], row[4], 
                                              row[5], int(row[6]) if row[6] else 0, row[7], 
                                              float(row[8]) if row[8] else 0, 
                                              float(row[9]) if row[9] else 0, row[10]))
                                    count += 1
                                except Exception as e:
                                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø³Ø·Ø±: {e}")
                                    continue
                            conn.commit()
                    
                    messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ {count} Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­!")
                    logging.info(f"ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ {count} Ø¹Ù…Ù„ÙŠØ© Ø¨ÙŠØ¹")
                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: {str(e)}")
                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: {str(e)}")
        
        def import_products():
            filename = filedialog.askopenfilename(
                title="Ø§Ø®ØªØ± Ù…Ù„Ù Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
                filetypes=[("CSV files", "*.csv"), ("All files", "*.*")]
            )
            if filename:
                try:
                    with open(filename, 'r', encoding='utf-8-sig') as f:
                        reader = csv.reader(f)
                        next(reader)  # ØªØ®Ø·ÙŠ Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                        
                        with sqlite3.connect('workshop.db') as conn:
                            c = conn.cursor()
                            count = 0
                            for row in reader:
                                try:
                                    c.execute('''INSERT INTO products 
                                              (product_name, category, price, quantity, description, 
                                              created_date, last_updated) 
                                              VALUES (?, ?, ?, ?, ?, ?, ?)''',
                                             (row[1], row[2], 
                                              float(row[3]) if row[3] else 0, 
                                              int(row[4]) if row[4] else 0, 
                                              row[5], row[6], row[7]))
                                    count += 1
                                except sqlite3.IntegrityError:
                                    logging.warning(f"Ø§Ù„Ù…Ù†ØªØ¬ {row[1]} Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹")
                                    continue
                                except Exception as e:
                                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø³Ø·Ø±: {e}")
                                    continue
                            conn.commit()
                    
                    messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ {count} Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!")
                    logging.info(f"ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ {count} Ù…Ù†ØªØ¬")
                except Exception as e:
                    messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: {str(e)}")
                    logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: {str(e)}")
        
        tk.Button(btn_frame, text="ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„ØµÙŠØ§Ù†Ø§Øª", bg=self.colors['primary'], fg='white',
                  font=('Arial', 11, 'bold'), command=import_repairs, 
                  width=20, height=2).pack(pady=10)
        
        tk.Button(btn_frame, text="ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª", bg=self.colors['success'], fg='white',
                  font=('Arial', 11, 'bold'), command=import_sales, 
                  width=20, height=2).pack(pady=10)
        
        tk.Button(btn_frame, text="ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª", bg=self.colors['info'], fg='white',
                  font=('Arial', 11, 'bold'), command=import_products, 
                  width=20, height=2).pack(pady=10)
        
        tk.Button(btn_frame, text="Ø¥ØºÙ„Ø§Ù‚", bg=self.colors['danger'], fg='white',
                  font=('Arial', 11, 'bold'), command=import_window.destroy, 
                  width=20, height=2).pack(pady=10)

    def show_dashboard(self):
        for widget in self.root.winfo_children():
            if not isinstance(widget, tk.Menu):
                widget.destroy()
        self.build_main_window()

if __name__ == "__main__":
    root = tk.Tk()
    app = ModernWorkshopApp(root)
    root.mainloop()
 
