import tkinter as tk
from tkinter import ttk, messagebox, filedialog, simpledialog
import sqlite3
import datetime
import io
import os
import json
import time

# --- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØµÙˆØ± ---
from PIL import Image, ImageTk, ImageDraw, ImageFont, ImageWin
import win32print
import win32ui
import win32con

# --- Ù…ÙƒØªØ¨Ø§Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ---
try:
Â  Â  import arabic_reshaper
Â  Â  from bidi.algorithm import get_display
except ImportError:
Â  Â  print("ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: pip install arabic-reshaper python-bidi")
Â  Â  def get_display(text): return text
Â  Â  class arabic_reshaper:
Â  Â  Â  Â  @staticmethod
Â  Â  Â  Â  def reshape(text): return text

# --- Ù…ÙƒØªØ¨Ø§Øª PDF (ReportLab) ---
try:
Â  Â  from reportlab.lib.pagesizes import A4
Â  Â  from reportlab.pdfgen import canvas
Â  Â  from reportlab.pdfbase.ttfonts import TTFont
Â  Â  from reportlab.pdfbase import pdfmetrics
Â  Â  from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
Â  Â  from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle
Â  Â  from reportlab.lib import colors
Â  Â  from reportlab.lib.units import mm
Â  Â  from reportlab.lib.enums import TA_CENTER, TA_RIGHT, TA_LEFT
except ImportError:
Â  Â  print("ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø© reportlab: pip install reportlab")
Â  Â  def save_daily_report_pdf(*args):
Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "Ù…ÙƒØªØ¨Ø© reportlab ØºÙŠØ± Ù…Ø«Ø¨ØªØ©.")

# --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… ---
BG_MAIN_COLOR = "#F4F7F6"
PANEL_COLOR = "#3F6287"
PRIMARY_COLOR = "#007AFF"
SECONDARY_COLOR = "#00AEFF"
ACCENT_COLOR = "#0DAAFF"
SUCCESS_COLOR = "#28a745"
DANGER_COLOR = "#dc3545"
TEXT_COLOR = "#0099FF"
TEXT_SECONDARY = "#6c757d"
CARD_COLORS = {
Â  Â  "Ø£Ø¨ÙŠØ¶ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)": "#FFFFFF", "Ø£Ø­Ù…Ø± ÙØ§ØªØ­": "#FFEBEE", "Ø£Ø®Ø¶Ø± ÙØ§ØªØ­": "#E8F5E9",
Â  Â  "Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­": "#E3F2FD", "Ø£ØµÙØ± ÙØ§ØªØ­": "#FFFDE7", "Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙØ§ØªØ­": "#FFF3E0", "Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­": "#F5F5F5"
}
FONT_MAIN = ("Segoe UI", 12)
FONT_BOLD = ("Segoe UI", 12, "bold")
FONT_HEADER = ("Segoe UI", 20, "bold")
FONT_TITLE = ("Segoe UI", 14, "bold")

# ================= ÙØ¦Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© =================

class CustomInputDialog:
Â  Â  def __init__(self, parent, title, prompt, initial_value="", input_type="text"):
Â  Â  Â  Â  self.result = None
Â  Â  Â  Â  self.window = tk.Toplevel(parent)
Â  Â  Â  Â  self.window.title(title)
Â  Â  Â  Â  self.window.geometry("500x400")
Â  Â  Â  Â  self.window.configure(bg="#FFFFFF")
Â  Â  Â  Â  self.window.resizable(False, False)
Â  Â  Â  Â  self.window.transient(parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â  x = parent.winfo_rootx() + (parent.winfo_width() // 2) - 250
Â  Â  Â  Â  y = parent.winfo_rooty() + (parent.winfo_height() // 2) - 200
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg=PANEL_COLOR, padx=20, pady=20, relief='raised', bd=1)
Â  Â  Â  Â  main_frame.pack(expand=True, fill='both', padx=10, pady=10)
Â  Â  Â  Â  tk.Label(main_frame, text=prompt, font=FONT_BOLD, bg=PANEL_COLOR, fg="white").pack(pady=(0, 10))
Â  Â  Â  Â  self.input_var = tk.StringVar(value=initial_value)
Â  Â  Â  Â  self.entry = tk.Entry(main_frame, textvariable=self.input_var, font=("Segoe UI", 14), bg="#F9F9F9", justify='center')
Â  Â  Â  Â  self.entry.pack(fill='x', pady=5, ipady=5)
Â  Â  Â  Â  self.entry.focus_set()
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  keypad_frame.pack(fill='both', expand=True, pady=2)
Â  Â  Â  Â  if input_type == "arabic": self.build_arabic_keypad(keypad_frame)
Â  Â  Â  Â  elif input_type == "numeric": self.build_numeric_keypad(keypad_frame)
Â  Â  Â  Â  elif input_type == "time": self.build_time_keypad(keypad_frame)
Â  Â  Â  Â  btn_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  btn_frame.pack(fill='x', pady=0)
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡ âŒ", command=self.window.destroy, bg=DANGER_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=10).pack(side='left', padx=3)
Â  Â  Â  Â  tk.Button(btn_frame, text="ØªØ£ÙƒÙŠØ¯ âœ…", command=self.confirm, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=15).pack(side='right', padx=3)
Â  Â  Â  Â  self.window.wait_window()
Â  Â  Â  Â Â 
Â  Â  def build_arabic_keypad(self, parent):
Â  Â  Â  Â  keys = [('Ø¬', 'Ø­', 'Ø®', 'Ù‡', 'Ø¹', 'Øº', 'Ù', 'Ù‚', 'Ø«', 'Øµ', 'Ø¶', 'Ø·'), ('Ùƒ', 'Ù…', 'Ù†', 'Øª', 'Ø§', 'Ù„', 'Ø¨', 'ÙŠ', 'Ø³', 'Ø´', 'Ø©'), ('Ùˆ', 'Ø±', 'Ø²', 'Ø¯', 'Ø°', 'Ø¸', 'Ø¤', 'Ù‰', 'Ø¡', 'Ø¦'), (',', ' ', 'Back', 'Clear')]
Â  Â  Â  Â  for r, row_keys in enumerate(keys):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x', expand=True)
Â  Â  Â  Â  Â  Â  for key in row_keys:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=key: self.key_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = "#E3F2FD" if len(key) == 1 or key == 'Ù„Ø§' or key == 'ØŒ' else PRIMARY_COLOR if key != 'Clear' else DANGER_COLOR
Â  Â  Â  Â  Â  Â  Â  Â  fg_color = "#1565C0" if len(key) == 1 or key == 'Ù„Ø§' or key == 'ØŒ' else "white"
Â  Â  Â  Â  Â  Â  Â  Â  font = ("Segoe UI", 12) if len(key) == 1 or key == 'Ù„Ø§' or key == 'ØŒ' else FONT_BOLD
Â  Â  Â  Â  Â  Â  Â  Â  tk.Button(row_frame, text=get_display(arabic_reshaper.reshape(key)), command=cmd, font=font, bg=btn_color, fg=fg_color, relief='flat', padx=2, pady=2).pack(side='right', padx=2, pady=2, fill='x', expand=True)

Â  Â  def build_numeric_keypad(self, parent):
Â  Â  Â  Â  keys = [('1', '2', '3'), ('4', '5', '6'), ('7', '8', '9'), ('Clear', '0', 'Back')]
Â  Â  Â  Â  for r, row_keys in enumerate(keys):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x', expand=True)
Â  Â  Â  Â  Â  Â  for key in row_keys:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=key: self.key_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = DANGER_COLOR if key == 'Clear' else PRIMARY_COLOR if key != 'Back' else "#E67E22"
Â  Â  Â  Â  Â  Â  Â  Â  tk.Button(row_frame, text=key, command=cmd, font=("Segoe UI", 14, "bold"), bg=btn_color, fg="white", relief='flat', padx=5, pady=5).pack(side='right', padx=2, pady=2, fill='x', expand=True)

Â  Â  def build_time_keypad(self, parent):
Â  Â  Â  Â  keys_digits = [('1', '2', '3'), ('4', '5', '6'), ('7', '8', '9'), ('AM', '0', 'PM')]
Â  Â  Â  Â  digits_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  digits_frame.pack(side='right', fill='both', expand=True, padx=10)
Â  Â  Â  Â  for r, row_keys in enumerate(keys_digits):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(digits_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x', expand=True)
Â  Â  Â  Â  Â  Â  for key in row_keys:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=key: self.time_key_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = PRIMARY_COLOR if key.isdigit() else SECONDARY_COLOR
Â  Â  Â  Â  Â  Â  Â  Â  tk.Button(row_frame, text=key, command=cmd, font=("Segoe UI", 12, "bold"), bg=btn_color, fg="white", relief='flat').pack(side='right', padx=2, pady=2, fill='x', expand=True)
Â  Â  Â  Â  control_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  control_frame.pack(side='left', fill='y', padx=10)
Â  Â  Â  Â  tk.Button(control_frame, text="Ø­Ø°Ù", command=lambda: self.time_key_press('Back'), font=("Segoe UI", 12, "bold"), bg="#E67E22", fg="white", relief='flat', width=6).pack(pady=0, fill='x')
Â  Â  Â  Â  tk.Button(control_frame, text="Ù…Ø³Ø­", command=lambda: self.time_key_press('Clear'), font=("Segoe UI", 12, "bold"), bg=DANGER_COLOR, fg="white", relief='flat', width=6).pack(pady=0, fill='x')
Â  Â  Â  Â  tk.Button(control_frame, text=": ÙØ§ØµÙ„", command=lambda: self.time_key_press(':'), font=("Segoe UI", 12, "bold"), bg="#5D6D7E", fg="white", relief='flat', width=6).pack(pady=0, fill='x')

Â  Â  def key_press(self, key):
Â  Â  Â  Â  current = self.input_var.get()
Â  Â  Â  Â  if key == 'Clear': self.input_var.set("")
Â  Â  Â  Â  elif key == 'Back': self.input_var.set(current[:-1])
Â  Â  Â  Â  else: self.input_var.set(current + key)
Â  Â  Â  Â  self.entry.icursor(tk.END)

Â  Â  def time_key_press(self, key):
Â  Â  Â  Â  current = self.input_var.get()
Â  Â  Â  Â  if key == 'Clear': self.input_var.set("")
Â  Â  Â  Â  elif key == 'Back':
Â  Â  Â  Â  Â  Â  if current.endswith(" AM") or current.endswith(" PM"): self.input_var.set(current[:-3])
Â  Â  Â  Â  Â  Â  elif current: self.input_var.set(current[:-1])
Â  Â  Â  Â  elif key.isdigit(): self.input_var.set(current + key)
Â  Â  Â  Â  elif key == ':':
Â  Â  Â  Â  Â  Â  if not current.endswith(':') and current.strip(): self.input_var.set(current + key)
Â  Â  Â  Â  elif key in ['AM', 'PM']:
Â  Â  Â  Â  Â  Â  if " AM" in current: self.input_var.set(current.replace(" AM", f" {key}"))
Â  Â  Â  Â  Â  Â  elif " PM" in current: self.input_var.set(current.replace(" PM", f" {key}"))
Â  Â  Â  Â  Â  Â  else: self.input_var.set(current + f" {key}")
Â  Â  Â  Â  self.entry.icursor(tk.END)
Â  Â  Â  Â Â 
Â  Â  def confirm(self):
Â  Â  Â  Â  self.result = self.input_var.get()
Â  Â  Â  Â  self.window.destroy()

class NoteDialog:
Â  Â  def __init__(self, parent, title, prompt, initial_value="", suggestions_str=""):
Â  Â  Â  Â  self.result = None
Â  Â  Â  Â  self.window = tk.Toplevel(parent)
Â  Â  Â  Â  self.window.title(title)
Â  Â  Â  Â  self.window.geometry("500x350")
Â  Â  Â  Â  self.window.configure(bg="#FFFFFF")
Â  Â  Â  Â  self.window.resizable(False, False)
Â  Â  Â  Â  self.window.transient(parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â  x = parent.winfo_rootx() + (parent.winfo_width() // 2) - 250
Â  Â  Â  Â  y = parent.winfo_rooty() + (parent.winfo_height() // 2) - 175
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg=PANEL_COLOR, padx=20, pady=20, relief='raised', bd=1)
Â  Â  Â  Â  main_frame.pack(expand=True, fill='both', padx=10, pady=10)
Â  Â  Â  Â  tk.Label(main_frame, text=prompt, font=FONT_BOLD, bg=PANEL_COLOR, fg="white").pack(pady=(0, 10))
Â  Â  Â  Â  self.note_var = tk.StringVar(value=initial_value)
Â  Â  Â  Â  self.entry = tk.Entry(main_frame, textvariable=self.note_var, font=("Segoe UI", 14), bg="#F9F9F9", justify='center')
Â  Â  Â  Â  self.entry.pack(fill='x', pady=5, ipady=5)
Â  Â  Â  Â  self.entry.focus_set()
Â  Â  Â  Â  self.entry.bind('<Return>', lambda e: self.confirm())
Â  Â  Â  Â  if suggestions_str:
Â  Â  Â  Â  Â  Â  suggestions_frame = tk.LabelFrame(main_frame, text="Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø³Ø±ÙŠØ¹Ø©", bg=PANEL_COLOR, fg="white", font=("Segoe UI", 10))
Â  Â  Â  Â  Â  Â  suggestions_frame.pack(fill='x', pady=10)
Â  Â  Â  Â  Â  Â  sug_list = [s.strip() for s in suggestions_str.split(',') if s.strip()]
Â  Â  Â  Â  Â  Â  grid_frame = tk.Frame(suggestions_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  grid_frame.pack(fill='both', padx=5, pady=5)
Â  Â  Â  Â  Â  Â  r, c = 0, 0
Â  Â  Â  Â  Â  Â  for sug in sug_list:
Â  Â  Â  Â  Â  Â  Â  Â  tk.Button(grid_frame, text=sug, font=("Segoe UI", 9), bg="#E3F2FD", fg="#1565C0", relief='flat', command=lambda s=sug: self.add_suggestion(s)).grid(row=r, column=c, padx=2, pady=2, sticky='ew')
Â  Â  Â  Â  Â  Â  Â  Â  c += 1
Â  Â  Â  Â  Â  Â  Â  Â  if c > 2: c = 0; r += 1
Â  Â  Â  Â  Â  Â  for i in range(3): grid_frame.columnconfigure(i, weight=1)
Â  Â  Â  Â  btn_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  btn_frame.pack(fill='x', pady=20)
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡ âŒ", command=self.window.destroy, bg=DANGER_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=10).pack(side='left', padx=5)
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© âœ…", command=self.confirm, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=15).pack(side='right', padx=5)
Â  Â  Â  Â  self.window.wait_window()
Â  Â  Â  Â Â 
Â  Â  def add_suggestion(self, text):
Â  Â  Â  Â  current = self.note_var.get()
Â  Â  Â  Â  if current: self.note_var.set(current + "ØŒ " + text)
Â  Â  Â  Â  else: self.note_var.set(text)
Â  Â  Â  Â  self.entry.focus_set()
Â  Â  Â  Â  self.entry.icursor(tk.END)
Â  Â  Â  Â Â 
Â  Â  def confirm(self):
Â  Â  Â  Â  self.result = self.note_var.get()
Â  Â  Â  Â  self.window.destroy()

class PhoneKeypad:
Â  Â  def __init__(self, parent, callback, initial_value=""):
Â  Â  Â  Â  self.parent = parent
Â  Â  Â  Â  self.callback = callback
Â  Â  Â  Â  self.value = tk.StringVar(value=initial_value)
Â  Â  Â  Â  self.setup_ui()
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.window = tk.Toplevel(self.parent)
Â  Â  Â  Â  self.window.title("Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ")
Â  Â  Â  Â  self.window.geometry("350x500")
Â  Â  Â  Â  self.window.configure(bg="#2C3E50")
Â  Â  Â  Â  self.window.transient(self.parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â  x = self.parent.winfo_rootx() + (self.parent.winfo_width() // 2) - 175
Â  Â  Â  Â  y = self.parent.winfo_rooty() + (self.parent.winfo_height() // 2) - 250
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg="#2C3E50", padx=10, pady=10)
Â  Â  Â  Â  main_frame.pack(fill='both', expand=True)
Â  Â  Â  Â  display_frame = tk.Frame(main_frame, bg="#ECF0F1", pady=10, padx=10, relief='sunken', bd=2)
Â  Â  Â  Â  display_frame.pack(fill='x', pady=(0, 15))
Â  Â  Â  Â  self.display = tk.Label(display_frame, textvariable=self.value, font=("Consolas", 28, "bold"), bg="#ECF0F1", fg="#2C3E50", height=1, anchor='center')
Â  Â  Â  Â  self.display.pack(fill='x')
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg="#2C3E50")
Â  Â  Â  Â  keypad_frame.pack(fill='both', expand=True)
Â  Â  Â  Â  buttons = [('1', '2', '3'), ('4', '5', '6'), ('7', '8', '9'), ('C', '0', 'âŒ«')]
Â  Â  Â  Â  for r, row_vals in enumerate(buttons):
Â  Â  Â  Â  Â  Â  for c, char in enumerate(row_vals):
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = "#E74C3C" if char == 'C' else "#E67E22" if char == 'âŒ«' else "#34495E"
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=char: self.button_click(k)
Â  Â  Â  Â  Â  Â  Â  Â  tk.Button(keypad_frame, text=char, command=cmd, font=("Segoe UI", 18, "bold"), bg=btn_color, fg="white", relief='flat').grid(row=r, column=c, padx=3, pady=3, sticky="nsew")
Â  Â  Â  Â  tk.Button(main_frame, text="ØªØ£ÙƒÙŠÙ€Ù€Ø¯ âœ…", command=self.confirm, bg="#27AE60", fg="white", font=("Segoe UI", 16, "bold"), height=1, relief='flat').pack(fill='x', pady=(10, 0))
Â  Â  Â  Â  for i in range(3): keypad_frame.columnconfigure(i, weight=1)
Â  Â  Â  Â  for i in range(4): keypad_frame.rowconfigure(i, weight=1)
Â  Â  def button_click(self, key):
Â  Â  Â  Â  current = self.value.get()
Â  Â  Â  Â  if key == 'C': self.value.set("")
Â  Â  Â  Â  elif key == 'âŒ«': self.value.set(current[:-1])
Â  Â  Â  Â  elif len(current) < 11: self.value.set(current + key)
Â  Â  def confirm(self):
Â  Â  Â  Â  self.callback(self.value.get())
Â  Â  Â  Â  self.window.destroy()

class LoginWindow:
Â  Â  def __init__(self, root, callback):
Â  Â  Â  Â  self.root = root
Â  Â  Â  Â  self.callback = callback
Â  Â  Â  Â  self.password_var = tk.StringVar()
Â  Â  Â  Â  self.setup_ui()
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.root.title("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†")
Â  Â  Â  Â  self.root.geometry("450x600")
Â  Â  Â  Â  self.root.configure(bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.root.resizable(False, False)
Â  Â  Â  Â  screen_width = self.root.winfo_screenwidth()
Â  Â  Â  Â  screen_height = self.root.winfo_screenheight()
Â  Â  Â  Â  x = (screen_width/2) - (450/2)
Â  Â  Â  Â  y = (screen_height/2) - (600/2)
Â  Â  Â  Â  self.root.geometry('%dx%d+%d+%d' % (450, 600, x, y))
Â  Â  Â  Â  main_frame = tk.Frame(self.root, bg=PANEL_COLOR, padx=30, pady=20, relief='raised', bd=1)
Â  Â  Â  Â  main_frame.place(relx=0.5, rely=0.5, anchor='center')
Â  Â  Â  Â  tk.Label(main_frame, text="ğŸ–", font=("Segoe UI", 40), bg=PANEL_COLOR).pack()
Â  Â  Â  Â  tk.Label(main_frame, text="Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†", font=("Segoe UI", 18, "bold"), bg=PANEL_COLOR, fg="white").pack(pady=5)
Â  Â  Â  Â  tk.Label(main_frame, text="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„:", font=("Segoe UI", 14), bg=PANEL_COLOR, fg="white").pack(pady=(10, 5))
Â  Â  Â  Â  self.password_display = tk.Label(main_frame, textvariable=self.password_var, font=("Arial", 24), bg="#F2F2F7", fg=PANEL_COLOR, width=15, anchor='center', relief='flat', bd=5)
Â  Â  Â  Â  self.password_display.pack(pady=5, ipady=5)
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  keypad_frame.pack(pady=15, padx=10)
Â  Â  Â  Â  buttons = [('1', '2', '3'), ('4', '5', '6'), ('7', '8', '9'), ('Ù…Ø³Ø­', '0', 'Ø­Ø°Ù')]
Â  Â  Â  Â  for r, row_vals in enumerate(buttons):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(keypad_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x')
Â  Â  Â  Â  Â  Â  for c, char in enumerate(row_vals):
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=char: self.keypad_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = PRIMARY_COLOR if char.isdigit() else DANGER_COLOR if char == 'Ù…Ø³Ø­' else "#E67E22"
Â  Â  Â  Â  Â  Â  Â  Â  tk.Button(row_frame, text=char, command=cmd, font=("Segoe UI", 14, "bold"), bg=btn_color, fg="white", relief='flat', width=6, height=1).pack(side='right', padx=2, pady=2)
Â  Â  Â  Â  tk.Button(main_frame, text="Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù… ğŸ”“", command=self.check_password, bg="#FFFFFF", fg=PANEL_COLOR, font=FONT_BOLD, width=20, height=2, relief='flat').pack(pady=20)
Â  Â  def keypad_press(self, key):
Â  Â  Â  Â  current = self.password_var.get()
Â  Â  Â  Â  if key == 'Ù…Ø³Ø­': self.password_var.set("")
Â  Â  Â  Â  elif key == 'Ø­Ø°Ù': self.password_var.set(current[:-1])
Â  Â  Â  Â  elif key.isdigit() and len(current) < 10: self.password_var.set(current + key)
Â  Â  def check_password(self):
Â  Â  Â  Â  if self.password_var.get() == "622563":
Â  Â  Â  Â  Â  Â  self.root.destroy()
Â  Â  Â  Â  Â  Â  self.callback()
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!")

class NumericKeypad:
Â  Â  def __init__(self, parent, callback):
Â  Â  Â  Â  self.parent = parent
Â  Â  Â  Â  self.callback = callback
Â  Â  Â  Â  self.value = tk.StringVar(value="0")
Â  Â  Â  Â  self.setup_ui()
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.window = tk.Toplevel(self.parent)
Â  Â  Â  Â  self.window.title("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† (ÙƒØºÙ…)")
Â  Â  Â  Â  self.window.geometry("400x650")
Â  Â  Â  Â  self.window.configure(bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.window.transient(self.parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â  x = self.parent.winfo_x() + (self.parent.winfo_width() // 2) - 200
Â  Â  Â  Â  y = self.parent.winfo_y() + (self.parent.winfo_height() // 2) - 325
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg=BG_MAIN_COLOR, padx=15, pady=15)
Â  Â  Â  Â  main_frame.pack(fill='both', expand=True)
Â  Â  Â  Â  self.display = tk.Label(main_frame, textvariable=self.value, font=("Consolas", 40, "bold"), bg="white", fg=TEXT_COLOR, height=2, anchor='e', padx=10)
Â  Â  Â  Â  self.display.pack(fill='x', pady=(0, 15))
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  keypad_frame.pack(fill='both', expand=True)
Â  Â  Â  Â  buttons = [('7', '8', '9'), ('4', '5', '6'), ('1', '2', '3'), ('0', '.', 'C')]
Â  Â  Â  Â  row, col = 0, 0
Â  Â  Â  Â  for button in buttons:
Â  Â  Â  Â  Â  Â  for b in button:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda x=b: self.button_click(x)
Â  Â  Â  Â  Â  Â  Â  Â  color = "#FFCDD2" if b == 'C' else PANEL_COLOR
Â  Â  Â  Â  Â  Â  Â  Â  fg_col = DANGER_COLOR if b == 'C' else "white"
Â  Â  Â  Â  Â  Â  Â  Â  tk.Button(keypad_frame, text=b, command=cmd, font=("Segoe UI", 22, "bold"), bg=color, fg=fg_col, relief='flat').grid(row=row, column=col, padx=4, pady=4, sticky="nsew")
Â  Â  Â  Â  Â  Â  Â  Â  col += 1
Â  Â  Â  Â  Â  Â  col = 0; row += 1
Â  Â  Â  Â  frac_frame = tk.Frame(keypad_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  frac_frame.grid(row=row, column=0, columnspan=3, sticky='ew', pady=(5,0))
Â  Â  Â  Â  fractions = [("1/4", 0.25), ("1/2", 0.5), ("3/4", 0.75)]
Â  Â  Â  Â  for txt, val in fractions:
Â  Â  Â  Â  Â  Â  tk.Button(frac_frame, text=txt, command=lambda v=val: self.fraction_click(v), font=("Segoe UI", 18, "bold"), bg=SECONDARY_COLOR, fg="white", relief='flat').pack(side='right', fill='x', expand=True, padx=4, pady=4)
Â  Â  Â  Â  row += 1
Â  Â  Â  Â  tk.Button(main_frame, text="ØªØ£ÙƒÙŠÙ€Ù€Ø¯ Ø§Ù„Ù€ÙˆØ²Ù† âœ…", command=self.confirm, bg="#00C853", fg="white", font=("Segoe UI", 18, "bold"), height=2, relief='raised', bd=3).pack(fill='x', pady=(15, 5))
Â  Â  Â  Â  for i in range(3): keypad_frame.columnconfigure(i, weight=1)
Â  Â  Â  Â  for i in range(row): keypad_frame.rowconfigure(i, weight=1)
Â  Â  def button_click(self, key):
Â  Â  Â  Â  if key == 'C': self.value.set("0")
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  current = self.value.get()
Â  Â  Â  Â  Â  Â  if current == "0" and key != '.': self.value.set(key)
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  if key == '.' and '.' in current: return
Â  Â  Â  Â  Â  Â  Â  Â  self.value.set(current + key)
Â  Â  def fraction_click(self, val):
Â  Â  Â  Â  current = self.value.get()
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  current_val = float(current)
Â  Â  Â  Â  Â  Â  self.value.set(f"{current_val + val:.3f}")
Â  Â  Â  Â  except ValueError: self.value.set(f"{val:.3f}")
Â  Â  def confirm(self):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  weight = float(self.value.get())
Â  Â  Â  Â  Â  Â  if weight > 0: self.callback(weight); self.window.destroy()
Â  Â  Â  Â  except ValueError: pass

# ================= Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ù†Ø¸Ø§Ù… =================

class RestaurantPOS:
Â  Â  def __init__(self, root):
Â  Â  Â  Â  self.root = root
Â  Â  Â  Â  self.root.title("Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†")
Â  Â  Â  Â  self.root.state('zoomed')
Â  Â  Â  Â  self.root.configure(bg=BG_MAIN_COLOR)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.setup_styles()
Â  Â  Â  Â  self.cart = []
Â  Â  Â  Â  self.db_name = "restaurant.db"
Â  Â  Â  Â  self.settings_file = "settings.json"
Â  Â  Â  Â  self.load_settings()
Â  Â  Â  Â  self.init_db()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.order_type = tk.StringVar(value="takeaway")
Â  Â  Â  Â  self.phone_var = tk.StringVar()
Â  Â  Â  Â  self.customer_name_var = tk.StringVar()
Â  Â  Â  Â  self.address_var = tk.StringVar()
Â  Â  Â  Â  self.pickup_time_var = tk.StringVar(value="")
Â  Â  Â  Â  self.payment_status_var = tk.StringVar(value="paid")
Â  Â  Â  Â  self.search_var = tk.StringVar()
Â  Â  Â  Â  self.general_notes_var = tk.StringVar()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.phone_var.trace("w", self.on_phone_change)
Â  Â  Â  Â  self.search_var.trace("w", self.on_search_change)
Â  Â  Â  Â  self.order_type.trace("w", lambda *args: self.toggle_fields())
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.setup_ui()

Â  Â  def setup_styles(self):
Â  Â  Â  Â  style = ttk.Style()
Â  Â  Â  Â  style.theme_use('clam')
Â  Â  Â  Â  style.configure("TNotebook", background=BG_MAIN_COLOR, borderwidth=0)
Â  Â  Â  Â  style.configure("TNotebook.Tab", font=("Segoe UI", 12), padding=[15, 8])
Â  Â  Â  Â  style.configure("Treeview", font=("Segoe UI", 11), rowheight=35)
Â  Â  Â  Â  style.configure("Treeview.Heading", font=("Segoe UI", 11, "bold"), background=SECONDARY_COLOR, foreground="white")
Â  Â Â 
Â  Â  def load_settings(self):
Â  Â  Â  Â  default_settings = {"printers": ["Default Printer"], "logo_path": "", "receipt_design": {"header_text": "Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†", "show_logo": True, "footer_text": "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ…"}, "last_closing_date": ""}
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  with open(self.settings_file, 'r', encoding='utf-8') as f: self.settings = json.load(f)
Â  Â  Â  Â  except: self.settings = default_settings
Â  Â  Â  Â  Â  Â Â 
Â  Â  def save_settings(self):
Â  Â  Â  Â  with open(self.settings_file, 'w', encoding='utf-8') as f: json.dump(self.settings, f, ensure_ascii=False, indent=4)
Â  Â  Â  Â Â 
Â  Â  def init_db(self):
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â Â 
Â  Â  Â  Â  # --- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS products (id INTEGER PRIMARY KEY, name TEXT, price REAL, image BLOB, category TEXT, weight_based INTEGER DEFAULT 0, card_color TEXT DEFAULT '#FFFFFF', suggestions TEXT DEFAULT '')''')
Â  Â  Â  Â  try: c.execute("ALTER TABLE products ADD COLUMN card_color TEXT DEFAULT '#FFFFFF'")
Â  Â  Â  Â  except: pass
Â  Â  Â  Â  try: c.execute("ALTER TABLE products ADD COLUMN suggestions TEXT DEFAULT ''")
Â  Â  Â  Â  except: pass
Â  Â  Â  Â Â 
Â  Â  Â  Â  # --- Ø§Ù„Ø²Ø¨Ø§Ø¦Ù† ---
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS customers (phone TEXT PRIMARY KEY, name TEXT, address TEXT, last_order_date TEXT)''')
Â  Â  Â  Â Â 
Â  Â  Â  Â  # --- Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ø¥Ø¶Ø§ÙØ© daily_id Ùˆ is_closed) ---
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS orders (id INTEGER PRIMARY KEY, daily_id INTEGER DEFAULT 1, date TEXT, customer_name TEXT, phone TEXT, type TEXT, details TEXT, total REAL, notes TEXT, status TEXT, pickup_time TEXT, address TEXT, payment_status TEXT, is_closed INTEGER DEFAULT 0)''')
Â  Â  Â  Â  try: c.execute("ALTER TABLE orders ADD COLUMN daily_id INTEGER DEFAULT 1")
Â  Â  Â  Â  except: pass
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ù…Ø¹Ø±ÙØ© Ù‡Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ… Ø¬Ø±Ø¯Ù‡Ø§ Ø£Ù… Ù„Ø§
Â  Â  Â  Â  try: c.execute("ALTER TABLE orders ADD COLUMN is_closed INTEGER DEFAULT 0")
Â  Â  Â  Â  except: pass

Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS sales (id INTEGER PRIMARY KEY, date TEXT, order_id INTEGER, amount REAL, type TEXT)''')
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS order_items (id INTEGER PRIMARY KEY, order_id INTEGER, product_name TEXT, qty REAL, price REAL, total REAL, note TEXT DEFAULT '', FOREIGN KEY(order_id) REFERENCES orders(id))''')
Â  Â  Â  Â  try: c.execute("ALTER TABLE order_items ADD COLUMN note TEXT DEFAULT ''")
Â  Â  Â  Â  except: pass
Â  Â  Â  Â Â 
Â  Â  Â  Â  # --- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¬Ø±Ø¯ (Ø§Ù„Ø´ÙØªØ§Øª) ---
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS daily_shifts (id INTEGER PRIMARY KEY AUTOINCREMENT, closing_time TEXT, total_sales REAL, total_orders INTEGER, report_date TEXT)''')
Â  Â  Â  Â Â 
Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.notebook = ttk.Notebook(self.root)
Â  Â  Â  Â  self.notebook.pack(fill='both', expand=True, padx=5, pady=5)
Â  Â  Â  Â  self.pos_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.pos_frame, text=" ğŸ›’ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ ")
Â  Â  Â  Â  self.build_pos_tab()
Â  Â  Â  Â  self.products_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.products_frame, text=" ğŸ¥© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ")
Â  Â  Â  Â  self.build_products_tab()
Â  Â  Â  Â  self.reports_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.reports_frame, text=" ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ")
Â  Â  Â  Â  self.build_reports_tab()
Â  Â  Â  Â  self.settings_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.settings_frame, text=" âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ")
Â  Â  Â  Â  self.build_settings_tab()
Â  Â  Â  Â Â 
Â  Â  def build_pos_tab(self):
Â  Â  Â  Â  top_control_frame = tk.Frame(self.pos_frame, bg=BG_MAIN_COLOR, pady=5)
Â  Â  Â  Â  top_control_frame.pack(side='top', fill='x')
Â  Â  Â  Â  style_toggle = {"font": ("Segoe UI", 12, "bold"), "indicatoron": 0, "width": 15, "relief": "flat", "bd": 0, "selectcolor": PRIMARY_COLOR, "fg": "#333"}
Â  Â  Â  Â  center_toggle = tk.Frame(top_control_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  center_toggle.pack(anchor='center')
Â  Â  Â  Â  tk.Radiobutton(center_toggle, text="ğŸ›ï¸ Ø³ÙØ±ÙŠ (Ø§Ø³ØªÙ„Ø§Ù…)", variable=self.order_type, value="takeaway", **style_toggle).pack(side='left', padx=2)
Â  Â  Â  Â  tk.Radiobutton(center_toggle, text="ğŸ›µ ØªÙˆØµÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ", variable=self.order_type, value="delivery", **style_toggle).pack(side='left', padx=2)
Â  Â  Â  Â Â 
Â  Â  Â  Â  customer_bar = tk.Frame(self.pos_frame, bg="white", padx=10, pady=8, relief='raised', bd=1)
Â  Â  Â  Â  customer_bar.pack(side='top', fill='x', pady=(0, 5))
Â  Â  Â  Â  right_frame = tk.Frame(customer_bar, bg="white")
Â  Â  Â  Â  right_frame.pack(side='right')
Â  Â  Â  Â  tk.Label(right_frame, text="ğŸ“±", font=("Segoe UI", 12), bg="white").pack(side='right', padx=(5,0))
Â  Â  Â  Â  self.phone_entry = tk.Entry(right_frame, textvariable=self.phone_var, font=("Segoe UI", 11, "bold"), width=15, bg="#F9F9F9", justify='center')
Â  Â  Â  Â  self.phone_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.phone_entry.bind("<Button-1>", self.open_phone_keypad)
Â  Â  Â  Â  tk.Label(right_frame, text="ğŸ‘¤", font=("Segoe UI", 12), bg="white").pack(side='right', padx=(5,0))
Â  Â  Â  Â  self.cust_name_entry = tk.Entry(right_frame, textvariable=self.customer_name_var, font=("Segoe UI", 11), width=20, bg="#F9F9F9", justify='right')
Â  Â  Â  Â  self.cust_name_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.cust_name_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.customer_name_var, "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†", "arabic"))
Â  Â  Â  Â  self.dynamic_fields_frame = tk.Frame(customer_bar, bg="white")
Â  Â  Â  Â  self.dynamic_fields_frame.pack(side='right', padx=20)
Â  Â  Â  Â  self.addr_container = tk.Frame(self.dynamic_fields_frame, bg="white")
Â  Â  Â  Â  tk.Label(self.addr_container, text="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:", bg="white", font=("Segoe UI", 10, "bold")).pack(side='right')
Â  Â  Â  Â  self.addr_entry = tk.Entry(self.addr_container, textvariable=self.address_var, font=("Segoe UI", 10), width=25, bg="#F9F9F9")
Â  Â  Â  Â  self.addr_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.addr_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.address_var, "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", "arabic"))
Â  Â  Â  Â  self.time_container = tk.Frame(self.dynamic_fields_frame, bg="white")
Â  Â  Â  Â  self.lbl_time = tk.Label(self.time_container, text="ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:", bg="white", font=("Segoe UI", 10, "bold"))
Â  Â  Â  Â  self.lbl_time.pack(side='right')
Â  Â  Â  Â  self.time_entry = tk.Entry(self.time_container, textvariable=self.pickup_time_var, font=("Segoe UI", 10), width=15, bg="#F9F9F9")
Â  Â  Â  Â  self.time_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.time_entry.bind("<Button-1>", self.open_time_keypad)
Â  Â  Â  Â  left_frame = tk.Frame(customer_bar, bg="white")
Â  Â  Â  Â  left_frame.pack(side='left')
Â  Â  Â  Â  tk.Button(left_frame, text="Ø¥Ø±Ø¬Ø§Ø¹ ÙØ§ØªÙˆØ±Ø© â†©ï¸", command=lambda: self.retrieve_order_dialog(use_keypad=True), bg="#607D8B", fg="white", font=("Segoe UI", 9, "bold"), relief='flat').pack(side='left', padx=5)
Â  Â  Â  Â  tk.Button(left_frame, text="Ø¥Ø¹Ø§Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø© ğŸ–¨ï¸", command=lambda: self.reprint_order_dialog(use_keypad=True), bg="#795548", fg="white", font=("Segoe UI", 9, "bold"), relief='flat').pack(side='left', padx=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  paned = tk.PanedWindow(self.pos_frame, orient=tk.HORIZONTAL, bg=BG_MAIN_COLOR, sashwidth=6)
Â  Â  Â  Â  paned.pack(fill='both', expand=True, pady=5)
Â  Â  Â  Â  left_cart_frame = tk.Frame(paned, bg=PANEL_COLOR, relief='sunken', bd=1)
Â  Â  Â  Â  paned.add(left_cart_frame, minsize=420, stretch="always")
Â  Â  Â  Â  footer_frame = tk.Frame(left_cart_frame, bg="#F8F9FA")
Â  Â  Â  Â  footer_frame.pack(side='bottom', fill='x')
Â  Â  Â  Â  action_btns = tk.Frame(footer_frame, bg="#F8F9FA", padx=2, pady=2)
Â  Â  Â  Â  action_btns.pack(side='bottom', fill='x')
Â  Â  Â  Â  sub_btns = tk.Frame(action_btns, bg="#F8F9FA")
Â  Â  Â  Â  sub_btns.pack(fill='x', pady=(0, 2))
Â  Â  Â  Â  tk.Button(sub_btns, text="ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© â™»ï¸", command=self.clear_cart, bg=DANGER_COLOR, fg="white", font=("Segoe UI", 9), relief='flat', height=1).pack(side='left', fill='x', expand=True)
Â  Â  Â  Â  tk.Button(action_btns, text="Ø·Ø¨Ø§Ø¹Ø© ÙˆØ¥Ù†Ù‡Ø§Ø¡ ğŸ–¨ï¸", command=self.checkout, bg=SUCCESS_COLOR, fg="white", font=("Segoe UI", 11, "bold"), height=1, relief='flat').pack(fill='x', pady=1)
Â  Â  Â  Â  total_frame = tk.Frame(footer_frame, bg="#343A40", pady=2)
Â  Â  Â  Â  total_frame.pack(side='bottom', fill='x')
Â  Â  Â  Â  self.lbl_total = tk.Label(total_frame, text="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0 Ø¯.Ø¹", font=("Arial", 16, "bold"), bg="#343A40", fg=SUCCESS_COLOR)
Â  Â  Â  Â  self.lbl_total.pack()
Â  Â  Â  Â  pay_opts = tk.Frame(footer_frame, bg="#F8F9FA", pady=2)
Â  Â  Â  Â  pay_opts.pack(side='bottom', fill='x')
Â  Â  Â  Â  self.btn_paid = tk.Button(pay_opts, text="âœ… ÙˆØ§ØµÙ„", font=("Segoe UI", 10, "bold"), relief='raised', bd=1, width=12, command=lambda: self.set_payment_status("paid"))
Â  Â  Â  Â  self.btn_paid.pack(side='right', padx=10, expand=True)
Â  Â  Â  Â  self.btn_unpaid = tk.Button(pay_opts, text="â³ ØºÙŠØ± ÙˆØ§ØµÙ„", font=("Segoe UI", 10, "bold"), relief='raised', bd=1, width=12, command=lambda: self.set_payment_status("unpaid"))
Â  Â  Â  Â  self.btn_unpaid.pack(side='left', padx=10, expand=True)
Â  Â  Â  Â  self.set_payment_status("paid")
Â  Â  Â  Â  general_note_frame = tk.Frame(footer_frame, bg="#F8F9FA", padx=5, pady=2)
Â  Â  Â  Â  general_note_frame.pack(side='bottom', fill='x')
Â  Â  Â  Â  self.general_note_entry = tk.Entry(general_note_frame, textvariable=self.general_notes_var, font=("Segoe UI", 10), bg="white", relief='solid', bd=1)
Â  Â  Â  Â  self.general_note_entry.pack(fill='x', ipady=2)
Â  Â  Â  Â  self.general_note_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.general_notes_var, "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©", "arabic"))
Â  Â  Â  Â  tk.Label(general_note_frame, text="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©:", bg="#F8F9FA", font=("Segoe UI", 9, "bold"), fg=TEXT_SECONDARY).pack(anchor='ne')
Â  Â  Â  Â  tk.Label(left_cart_frame, text="ğŸ§¾ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", font=FONT_BOLD, bg=PANEL_COLOR, fg="white").pack(pady=(5,0))
Â  Â  Â  Â  cols = ('item', 'qty', 'price', 'total', 'note', 'action')
Â  Â  Â  Â  self.tree = ttk.Treeview(left_cart_frame, columns=cols, show='headings', selectmode='browse')
Â  Â  Â  Â  self.tree.heading('item', text='Ø§Ù„ØµÙ†Ù'); self.tree.heading('qty', text='Ø§Ù„ÙƒÙ…ÙŠØ©'); self.tree.heading('price', text='Ø§Ù„Ø³Ø¹Ø±'); self.tree.heading('total', text='Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'); self.tree.heading('note', text='Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª'); self.tree.heading('action', text='')
Â  Â  Â  Â  self.tree.column('item', width=120, anchor='e'); self.tree.column('qty', width=50, anchor='center'); self.tree.column('price', width=70, anchor='center'); self.tree.column('total', width=70, anchor='center'); self.tree.column('note', width=90, anchor='e'); self.tree.column('action', width=40, anchor='center')
Â  Â  Â  Â  self.tree.pack(fill='both', expand=True, padx=5)
Â  Â  Â  Â  self.tree.bind("<Button-1>", self.on_tree_click)
Â  Â  Â  Â  self.tree.bind("<Double-1>", self.on_item_double_click)
Â  Â  Â  Â  right_products_frame = tk.Frame(paned, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  paned.add(right_products_frame, minsize=550)
Â  Â  Â  Â  search_frame = tk.Frame(right_products_frame, bg=PANEL_COLOR, padx=10, pady=10)
Â  Â  Â  Â  search_frame.pack(fill='x', pady=(0, 5))
Â  Â  Â  Â  tk.Label(search_frame, text="ğŸ” Ø¨Ø­Ø«:", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(side='right', padx=5)
Â  Â  Â  Â  tk.Entry(search_frame, textvariable=self.search_var, font=FONT_MAIN, bg="#F2F2F7", relief='flat').pack(side='right', fill='x', expand=True, ipady=3)
Â  Â  Â  Â  products_container = tk.Frame(right_products_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  products_container.pack(fill='both', expand=True)
Â  Â  Â  Â  self.canvas_products = tk.Canvas(products_container, bg=BG_MAIN_COLOR, highlightthickness=0)
Â  Â  Â  Â  self.scroll_y = ttk.Scrollbar(products_container, orient="vertical", command=self.canvas_products.yview)
Â  Â  Â  Â  self.scrollable_frame = tk.Frame(self.canvas_products, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.scrollable_frame.bind("<Configure>", lambda e: self.canvas_products.configure(scrollregion=self.canvas_products.bbox("all")))
Â  Â  Â  Â  self.canvas_products.create_window((0, 0), window=self.scrollable_frame, anchor="ne")
Â  Â  Â  Â  self.canvas_products.configure(yscrollcommand=self.scroll_y.set)
Â  Â  Â  Â  self.scroll_y.pack(side="left", fill="y")
Â  Â  Â  Â  self.canvas_products.pack(side="right", fill="both", expand=True)
Â  Â  Â  Â  self.load_products_grid()
Â  Â  Â  Â  self.toggle_fields()

Â  Â  # --- Ø¯ÙˆØ§Ù„ Ù„ÙˆØ­Ø§Øª Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª ---
Â  Â  def open_phone_keypad(self, event): PhoneKeypad(self.root, self.update_phone_from_keypad, self.phone_var.get()); return "break"
Â  Â  def update_phone_from_keypad(self, val): self.phone_var.set(val)
Â  Â  def open_text_keypad(self, var_obj, title, input_type):
Â  Â  Â  Â  dlg = CustomInputDialog(self.root, title, title, var_obj.get(), input_type)
Â  Â  Â  Â  if dlg.result is not None: var_obj.set(dlg.result)
Â  Â  Â  Â  return "break"
Â  Â  def open_time_keypad(self, event):
Â  Â  Â  Â  dlg = CustomInputDialog(self.root, "ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…/Ø§Ù„ØªÙˆØµÙŠÙ„", "Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆÙ‚Øª (HH:MM AM/PM)", self.pickup_time_var.get(), "time")
Â  Â  Â  Â  if dlg.result: self.pickup_time_var.set(dlg.result)
Â  Â  Â  Â  return "break"
Â  Â  def set_payment_status(self, status):
Â  Â  Â  Â  self.payment_status_var.set(status)
Â  Â  Â  Â  if status == "paid": self.btn_paid.config(bg=SUCCESS_COLOR, fg="white", state="normal", relief="sunken"); self.btn_unpaid.config(bg="#E0E0E0", fg="#666", state="normal", relief="raised"); self.lbl_total.config(fg=SUCCESS_COLOR)
Â  Â  Â  Â  else: self.btn_paid.config(bg="#E0E0E0", fg="#666", state="normal", relief="raised"); self.btn_unpaid.config(bg=DANGER_COLOR, fg="white", state="normal", relief="sunken"); self.lbl_total.config(fg=DANGER_COLOR)
Â  Â  def on_tree_click(self, event):
Â  Â  Â  Â  region = self.tree.identify_region(event.x, event.y)
Â  Â  Â  Â  if region == "cell" and self.tree.identify_column(event.x) == '#6':
Â  Â  Â  Â  Â  Â  item_id = self.tree.identify_row(event.y)
Â  Â  Â  Â  Â  Â  if item_id: self.cart.pop(self.tree.index(item_id)); self.update_cart_view()
Â  Â  def on_item_double_click(self, event):
Â  Â  Â  Â  if self.tree.identify_column(event.x) == '#6': return
Â  Â  Â  Â  item_id = self.tree.identify_row(event.y)
Â  Â  Â  Â  if item_id:
Â  Â  Â  Â  Â  Â  index = self.tree.index(item_id)
Â  Â  Â  Â  Â  Â  current = self.cart[index]
Â  Â  Â  Â  Â  Â  dlg = NoteDialog(self.root, "Ù…Ù„Ø§Ø­Ø¸Ø© ÙˆØ¬Ø¨Ø©", f"Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù€ ({current['name']}):", current['note'], suggestions_str=current.get('suggestions', ''))
Â  Â  Â  Â  Â  Â  if dlg.result is not None: self.cart[index]['note'] = dlg.result; self.update_cart_view()
Â  Â  def on_phone_change(self, *args):
Â  Â  Â  Â  phone = self.phone_var.get()
Â  Â  Â  Â  if not phone.isdigit() and phone != "": self.phone_var.set(''.join(filter(str.isdigit, phone))); return
Â  Â  Â  Â  if len(phone) == 11: self.phone_entry.config(fg=SUCCESS_COLOR); self.fetch_customer_data(phone)
Â  Â  Â  Â  else: self.phone_entry.config(fg="black")
Â  Â  Â  Â  if len(phone) > 11: self.phone_var.set(phone[:11]); self.phone_entry.config(fg=SUCCESS_COLOR)
Â  Â  def on_search_change(self, *args): self.load_products_grid()
Â  Â  def fetch_customer_data(self, phone):
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  c.execute("SELECT name, address FROM customers WHERE phone=?", (phone,))
Â  Â  Â  Â  res = c.fetchone(); conn.close()
Â  Â  Â  Â  if res: self.customer_name_var.set(res[0]); self.address_var.set(res[1] if res[1] else "")
Â  Â  Â  Â  else: self.customer_name_var.set(""); self.address_var.set("")
Â  Â  def toggle_fields(self):
Â  Â  Â  Â  val = self.order_type.get()
Â  Â  Â  Â  self.addr_container.pack_forget(); self.time_container.pack_forget()
Â  Â  Â  Â  self.time_container.pack(side='right', padx=5)
Â  Â  Â  Â  if val == "takeaway": self.lbl_time.config(text="ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:")
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.lbl_time.config(text="ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„:"); self.addr_container.pack(side='right', padx=5)
Â  Â  Â  Â  Â  Â  if len(self.phone_var.get()) == 11: self.fetch_customer_data(self.phone_var.get())
Â  Â  def load_products_grid(self):
Â  Â  Â  Â  for widget in self.scrollable_frame.winfo_children(): widget.destroy()
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  search_term = self.search_var.get()
Â  Â  Â  Â  query = "SELECT id, name, price, image, weight_based, card_color, suggestions FROM products"
Â  Â  Â  Â  params = []
Â  Â  Â  Â  if search_term: query += " WHERE name LIKE ?"; params = [f'%{search_term}%']
Â  Â  Â  Â  c.execute(query, params)
Â  Â  Â  Â  products = c.fetchall(); conn.close()
Â  Â  Â  Â  MAX_COLS = 5; row = 0; col = 0
Â  Â  Â  Â  for pid, name, price, img_blob, weight_based, card_color, suggestions in products:
Â  Â  Â  Â  Â  Â  bg_color = card_color if card_color else "#FFFFFF"
Â  Â  Â  Â  Â  Â  card = tk.Frame(self.scrollable_frame, bg=bg_color, bd=0, relief="flat", highlightbackground="#E0E0E0", highlightthickness=1)
Â  Â  Â  Â  Â  Â  card.grid(row=row, column=MAX_COLS - 1 - col, padx=4, pady=4, sticky="nsew")
Â  Â  Â  Â  Â  Â  click_cmd = lambda e, p=pid, n=name, pr=price, w=weight_based, s=suggestions, c=bg_color: self.add_product_to_cart(p, n, pr, w, s, c)
Â  Â  Â  Â  Â  Â  card.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  img_frame = tk.Frame(card, bg=bg_color, height=80, width=120); img_frame.pack_propagate(False); img_frame.pack()
Â  Â  Â  Â  Â  Â  img_frame.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  if img_blob:
Â  Â  Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image = Image.open(io.BytesIO(img_blob)); image = image.resize((120, 80), Image.Resampling.LANCZOS); photo = ImageTk.PhotoImage(image)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl = tk.Label(img_frame, image=photo, bg=bg_color); lbl.image = photo; lbl.pack(); lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  Â  Â  except: lbl = tk.Label(img_frame, text="ğŸ–", font=("Segoe UI", 24), bg=bg_color, fg="#CCC"); lbl.pack(expand=True, fill='both'); lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  else: lbl = tk.Label(img_frame, text="ğŸ–", font=("Segoe UI", 24), bg=bg_color, fg="#CCC"); lbl.pack(expand=True, fill='both'); lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  info_frame = tk.Frame(card, bg=bg_color, pady=2); info_frame.pack(fill='x'); info_frame.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  name_lbl = tk.Label(info_frame, text=name, font=("Segoe UI", 10, "bold"), bg=bg_color, fg=TEXT_COLOR, wraplength=110); name_lbl.pack(); name_lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  price_color = ACCENT_COLOR if weight_based else SUCCESS_COLOR
Â  Â  Â  Â  Â  Â  price_lbl = tk.Label(info_frame, text=f"{price:,.0f} Ø¯.Ø¹", font=("Segoe UI", 9), bg=bg_color, fg=price_color); price_lbl.pack(); price_lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  bar = tk.Frame(card, bg=price_color, height=3); bar.pack(fill='x', side='bottom'); bar.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  col += 1
Â  Â  Â  Â  Â  Â  if col >= MAX_COLS: col = 0; row += 1
Â  Â  Â  Â  self.scrollable_frame.update_idletasks()
Â  Â  Â  Â  self.canvas_products.configure(scrollregion=self.canvas_products.bbox("all"))
Â  Â  Â  Â Â 
Â  Â  def add_product_to_cart(self, pid, name, price, weight_based, suggestions, color):
Â  Â  Â  Â  if weight_based: NumericKeypad(self.root, lambda weight: self.add_weight_item(pid, name, price, weight, suggestions, color))
Â  Â  Â  Â  else: self.add_regular_item(pid, name, price, suggestions, color)
Â  Â  def add_regular_item(self, pid, name, price, suggestions, color):
Â  Â  Â  Â  for item in self.cart:
Â  Â  Â  Â  Â  Â  if item['id'] == pid and not item['weight_based']:
Â  Â  Â  Â  Â  Â  Â  Â  item['qty'] += 1; item['total'] = item['qty'] * price; self.update_cart_view(); return
Â  Â  Â  Â  self.cart.append({"id": pid, "name": name, "qty": 1, "price": price, "total": price, "weight_based": False, "note": "", "suggestions": suggestions, "color": color})
Â  Â  Â  Â  self.update_cart_view()
Â  Â  def add_weight_item(self, pid, name, price, weight, suggestions, color):
Â  Â  Â  Â  self.cart.append({"id": pid, "name": name, "qty": weight, "price": price, "total": weight * price, "weight_based": True, "note": "", "suggestions": suggestions, "color": color})
Â  Â  Â  Â  self.update_cart_view()
Â  Â  def update_cart_view(self):
Â  Â  Â  Â  for item in self.tree.get_children(): self.tree.delete(item)
Â  Â  Â  Â  grand_total = 0
Â  Â  Â  Â  for item in self.cart:
Â  Â  Â  Â  Â  Â  qty_val = item['qty']; qty_fmt = str(int(qty_val)) if abs(qty_val - int(qty_val)) < 0.001 else f"{qty_val:.3f}"
Â  Â  Â  Â  Â  Â  if item['weight_based']:
Â  Â  Â  Â  Â  Â  Â  Â  int_part = int(qty_val); frac_part = qty_val - int_part
Â  Â  Â  Â  Â  Â  Â  Â  if abs(frac_part) < 0.001: qty_fmt = str(int_part)
Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = "1/4" if abs(frac_part - 0.25) < 0.001 else "1/2" if abs(frac_part - 0.5) < 0.001 else "3/4" if abs(frac_part - 0.75) < 0.001 else f"{frac_part:.3f}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty_fmt = f"{int_part} Ùˆ {frac_str}" if int_part > 0 else frac_str
Â  Â  Â  Â  Â  Â  Â  Â  if qty_fmt == "1 Ùˆ 0.000": qty_fmt = "1"
Â  Â  Â  Â  Â  Â  note_display = f"ğŸ“ {item['note']}" if item['note'] else ""
Â  Â  Â  Â  Â  Â  row_color = item.get('color', '#FFFFFF')
Â  Â  Â  Â  Â  Â  self.tree.insert('', 'end', values=(item['name'], qty_fmt, f"{item['price']:,.0f}", f"{item['total']:,.0f}", note_display, "âŒ"), tags=(row_color,))
Â  Â  Â  Â  Â  Â  self.tree.tag_configure(row_color, background=row_color)
Â  Â  Â  Â  Â  Â  grand_total += item['total']
Â  Â  Â  Â  self.lbl_total.config(text=f"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {grand_total:,.0f} Ø¯.Ø¹")
Â  Â  Â  Â Â 
Â  Â  def clear_cart(self):
Â  Â  Â  Â  self.cart = []; self.general_notes_var.set(""); self.update_cart_view()
Â  Â Â 
Â  Â  def retrieve_order_dialog(self, use_keypad=False):
Â  Â  Â  Â  dlg = CustomInputDialog(self.root, "Ø¥Ø±Ø¬Ø§Ø¹ ÙØ§ØªÙˆØ±Ø©", "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:", initial_value="", input_type="numeric")
Â  Â  Â  Â  if not dlg.result: return
Â  Â  Â  Â  oid = int(dlg.result)
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  c.execute("SELECT * FROM orders WHERE daily_id=?", (oid,)) # Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ…
Â  Â  Â  Â  order = c.fetchone(); conn.close()
Â  Â  Â  Â  if not order: messagebox.showerror("Ø®Ø·Ø£", "Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©"); return
Â  Â  Â  Â  msg = f"Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: {order[1]}\nØ§Ù„ØªØ§Ø±ÙŠØ®: {order[2]}\nØ§Ù„Ø²Ø¨ÙˆÙ†: {order[3]}\nØ§Ù„Ù…Ø¨Ù„Øº: {order[7]:,.0f} Ø¯.Ø¹\n"
Â  Â  Â  Â  if order[9] == "Ù…Ø±ØªØ¬Ø¹": messagebox.showinfo("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", msg + "\n\nâš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ø§Ù‹."); return
Â  Â  Â  Â  if messagebox.askyesno("ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", msg + "\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ (Ø¥Ù„ØºØ§Ø¡) Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ"): self.process_return(order[0], order[7])
Â  Â  Â  Â Â 
Â  Â  def reprint_order_dialog(self, use_keypad=False):
Â  Â  Â  Â  dlg = CustomInputDialog(self.root, "Ø¥Ø¹Ø§Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø©", "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ù„ÙŠÙˆÙ…ÙŠ):", initial_value="", input_type="numeric")
Â  Â  Â  Â  if not dlg.result: return
Â  Â  Â  Â  try: daily_oid = int(dlg.result)
Â  Â  Â  Â  except: return
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  # Ù†Ø¨Ø­Ø« ÙÙ‚Ø· ÙÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¬Ø±ÙˆØ¯Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù…ØŒ Ø£Ùˆ Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù…
Â  Â  Â  Â  # Ù‡Ù†Ø§ Ø³Ù†Ø¨Ø­Ø« Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ù… Ø¹Ù† Ø¢Ø®Ø± ÙØ§ØªÙˆØ±Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…
Â  Â  Â  Â  c.execute("SELECT * FROM orders WHERE daily_id=? ORDER BY id DESC LIMIT 1", (daily_oid,))
Â  Â  Â  Â  order = c.fetchone()
Â  Â  Â  Â  if not order: messagebox.showerror("Ø®Ø·Ø£", "Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©"); conn.close(); return
Â  Â  Â  Â  c.execute("SELECT product_name, qty, price, total, note FROM order_items WHERE order_id=?", (order[0],))
Â  Â  Â  Â  items = c.fetchall(); conn.close()
Â  Â  Â  Â  cart_items_for_print = []
Â  Â  Â  Â  for name, qty, price, total, note in items:
Â  Â  Â  Â  Â  Â  cart_items_for_print.append({"name": name, "qty": qty, "price": price, "total": total, "weight_based": qty != int(qty), "note": note})
Â  Â  Â  Â  self.print_receipt(daily_oid, order[3], order[4], order[5], order[10], order[11], cart_items_for_print, order[7], order[9], order[8], is_reprint=True)

Â  Â  def process_return(self, oid, amount):
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  c.execute("UPDATE orders SET status='Ù…Ø±ØªØ¬Ø¹' WHERE id=?", (oid,))
Â  Â  Â  Â  now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
Â  Â  Â  Â  c.execute("INSERT INTO sales (date, order_id, amount, type) VALUES (?, ?, ?, ?)", (now, oid, -amount, "return"))
Â  Â  Â  Â  conn.commit(); conn.close()
Â  Â  Â  Â  messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.")
Â  Â  Â  Â  self.load_reports()

Â  Â  def checkout(self):
Â  Â  Â  Â  if not self.cart: messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©"); return
Â  Â  Â  Â  phone = self.phone_var.get(); name = self.customer_name_var.get()
Â  Â  Â  Â  if len(phone) != 11 and phone != "":
Â  Â  Â  Â  Â  Â  Â if not messagebox.askyesno("ØªÙ†Ø¨ÙŠÙ‡", "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„. Ù…ØªØ§Ø¨Ø¹Ø©ØŸ"): return
Â  Â  Â  Â  if not name.strip(): name = "Ø²Ø¨ÙˆÙ† Ø¹Ø§Ù…"
Â  Â  Â  Â  current_order_type = self.order_type.get()
Â  Â  Â  Â  address = self.address_var.get() if current_order_type == 'delivery' else ""
Â  Â  Â  Â  pickup_time = self.pickup_time_var.get()
Â  Â  Â  Â Â 
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  now_dt = datetime.datetime.now()
Â  Â  Â  Â  now = now_dt.strftime("%Y-%m-%d %H:%M:%S")
Â  Â  Â  Â  today_str = now_dt.strftime("%Y-%m-%d")
Â  Â  Â  Â Â 
Â  Â  Â  Â  # --- Ø­Ø³Ø§Ø¨ Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙØªÙˆØ­Ø© ÙÙ‚Ø· ---
Â  Â  Â  Â  c.execute("SELECT MAX(daily_id) FROM orders WHERE date LIKE ? AND is_closed = 0", (f"{today_str}%",))
Â  Â  Â  Â  max_daily = c.fetchone()[0]
Â  Â  Â  Â  daily_id = 1 if max_daily is None else max_daily + 1
Â  Â  Â  Â  # -----------------------------------------------

Â  Â  Â  Â  if phone: c.execute("INSERT OR REPLACE INTO customers (phone, name, address, last_order_date) VALUES (?, ?, ?, ?)", (phone, name, address, now))
Â  Â  Â  Â  total_val = sum(x['total'] for x in self.cart)
Â  Â  Â  Â  details_list = [f"{x['name']} ({x['qty']})" for x in self.cart]
Â  Â  Â  Â  details = ", ".join(details_list)
Â  Â  Â  Â  is_paid_status = self.payment_status_var.get()
Â  Â  Â  Â  status_text = "ÙˆØ§ØµÙ„" if is_paid_status == "paid" else "ØºÙŠØ± ÙˆØ§ØµÙ„"
Â  Â  Â  Â  general_note = self.general_notes_var.get()
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute('''INSERT INTO orders (daily_id, date, customer_name, phone, type, details, total, notes, status, pickup_time, address, payment_status, is_closed)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  VALUES (?,?,?,?,?,?,?,?,?,?,?,?, 0)''', (daily_id, now, name, phone, current_order_type, details, total_val, general_note, status_text, pickup_time, address, is_paid_status))
Â  Â  Â  Â  order_id = c.lastrowid
Â  Â  Â  Â  for x in self.cart:
Â  Â  Â  Â  Â  Â  c.execute("INSERT INTO order_items (order_id, product_name, qty, price, total, note) VALUES (?, ?, ?, ?, ?, ?)", (order_id, x['name'], x['qty'], x['price'], x['total'], x['note']))
Â  Â  Â  Â  c.execute("INSERT INTO sales (date, order_id, amount, type) VALUES (?, ?, ?, ?)", (now, order_id, total_val, "order"))
Â  Â  Â  Â  conn.commit(); conn.close()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.print_receipt(daily_id, name, phone, current_order_type, pickup_time, address, self.cart, total_val, status_text, general_note)
Â  Â  Â  Â  self.clear_cart(); self.pickup_time_var.set(""); self.customer_name_var.set(""); self.phone_var.set("")

Â  Â  def print_receipt(self, oid, name, phone, order_type, time_str, address_str, cart_items, total, status, g_note, is_reprint=False):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  PAPER_WIDTH = 570
Â  Â  Â  Â  Â  Â  MARGIN = 10
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # --- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ· ---
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  font_path_bold = "C:\\Windows\\Fonts\\arialbd.ttf"
Â  Â  Â  Â  Â  Â  Â  Â  font_path_reg = "C:\\Windows\\Fonts\\arial.ttf"
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  font_header = ImageFont.truetype(font_path_bold, 45)
Â  Â  Â  Â  Â  Â  Â  Â  font_subheader = ImageFont.truetype(font_path_bold, 24)
Â  Â  Â  Â  Â  Â  Â  Â  font_receipt_no = ImageFont.truetype(font_path_bold, 60)
Â  Â  Â  Â  Â  Â  Â  Â  font_title = ImageFont.truetype(font_path_bold, 26)
Â  Â  Â  Â  Â  Â  Â  Â  font_details = ImageFont.truetype(font_path_bold, 28)
Â  Â  Â  Â  Â  Â  Â  Â  font_table_header = ImageFont.truetype(font_path_bold, 24)
Â  Â  Â  Â  Â  Â  Â  Â  font_table_row = ImageFont.truetype(font_path_bold, 24)
Â  Â  Â  Â  Â  Â  Â  Â  font_note_item = ImageFont.truetype(font_path_reg, 20) # Ø®Ø· Ø®Ø§Øµ Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø§Ù„ÙˆØ¬Ø¨Ø©
Â  Â  Â  Â  Â  Â  Â  Â  font_total = ImageFont.truetype(font_path_bold, 50)
Â  Â  Â  Â  Â  Â  Â  Â  font_footer = ImageFont.truetype(font_path_bold, 20)
Â  Â  Â  Â  Â  Â  Â  Â  font_time_large = ImageFont.truetype(font_path_bold, 50)
Â  Â  Â  Â  Â  Â  Â  Â  font_order_type = ImageFont.truetype(font_path_bold, 38)
Â  Â  Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  Â  Â  # Ø®Ø·ÙˆØ· Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·ÙˆØ·
Â  Â  Â  Â  Â  Â  Â  Â  default_font = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â  font_header = font_subheader = font_receipt_no = font_title = default_font
Â  Â  Â  Â  Â  Â  Â  Â  font_details = font_table_header = font_table_row = font_note_item = default_font
Â  Â  Â  Â  Â  Â  Â  Â  font_total = font_footer = font_time_large = font_order_type = default_font

Â  Â  Â  Â  Â  Â  # --- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ---
Â  Â  Â  Â  Â  Â  header_h = 450
Â  Â  Â  Â  Â  Â  # ØªÙ‚Ø¯ÙŠØ± Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø²ÙŠØ§Ø¯Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
Â  Â  Â  Â  Â  Â  table_h = (len(cart_items) * 100) + 100Â 
Â  Â  Â  Â  Â  Â  footer_h = 800 # Ø²ÙŠØ§Ø¯Ø© Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù‚Ù…Ø§Ø´ÙŠØ© (Canvas)
Â  Â  Â  Â  Â  Â  img = Image.new('RGB', (PAPER_WIDTH, header_h + table_h + footer_h), color='white')
Â  Â  Â  Â  Â  Â  draw = ImageDraw.Draw(img)

Â  Â  Â  Â  Â  Â  # --- Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ---
Â  Â  Â  Â  Â  Â  def draw_text_align(text, x, y, font, align='center', color='black'):
Â  Â  Â  Â  Â  Â  Â  Â  if not text: return
Â  Â  Â  Â  Â  Â  Â  Â  bidi_text = get_display(arabic_reshaper.reshape(str(text)))
Â  Â  Â  Â  Â  Â  Â  Â  bbox = draw.textbbox((0, 0), bidi_text, font=font)
Â  Â  Â  Â  Â  Â  Â  Â  w = bbox[2] - bbox[0]
Â  Â  Â  Â  Â  Â  Â  Â  if align == 'center':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw.text((x - (w / 2), y), bidi_text, font=font, fill=color)
Â  Â  Â  Â  Â  Â  Â  Â  elif align == 'right':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw.text((x - w, y), bidi_text, font=font, fill=color)
Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw.text((x, y), bidi_text, font=font, fill=color)

Â  Â  Â  Â  Â  Â  y = 20

Â  Â  Â  Â  Â  Â  # --- Ø±Ø³Ù… Ø§Ù„Ù„ÙˆØ¬Ùˆ ---
Â  Â  Â  Â  Â  Â  logo_path = self.settings.get('logo_path', '')
Â  Â  Â  Â  Â  Â  if self.settings['receipt_design']['show_logo'] and logo_path and os.path.exists(logo_path):
Â  Â  Â  Â  Â  Â  Â  Â  Â try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â logo = Image.open(logo_path)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â basewidth = 160
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â wpercent = (basewidth / float(logo.size[0]))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â hsize = int((float(logo.size[1]) * float(wpercent)))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â logo = logo.resize((basewidth, hsize), Image.Resampling.LANCZOS)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â img.paste(logo, (int((PAPER_WIDTH - basewidth)/2), y))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â y += hsize + 15
Â  Â  Â  Â  Â  Â  Â  Â  Â except: pass

Â  Â  Â  Â  Â  Â  # --- ØªØ±ÙˆÙŠØ³Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ---
Â  Â  Â  Â  Â  Â  draw_text_align(self.settings['receipt_design']['header_text'], PAPER_WIDTH/2, y, font_header, 'center')
Â  Â  Â  Â  Â  Â  y += 60
Â  Â  Â  Â  Â  Â  draw_text_align("07736161216", PAPER_WIDTH/2, y, font_subheader, 'center')
Â  Â  Â  Â  Â  Â  y += 50

Â  Â  Â  Â  Â  Â  # --- Ù…Ø±Ø¨Ø¹ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ---
Â  Â  Â  Â  Â  Â  rect_x = MARGIN
Â  Â  Â  Â  Â  Â  rect_y = y
Â  Â  Â  Â  Â  Â  rect_w = 160
Â  Â  Â  Â  Â  Â  rect_h = 90
Â  Â  Â  Â  Â  Â  draw.rectangle((rect_x, rect_y, rect_x + rect_w, rect_y + rect_h), outline="black", width=5)
Â  Â  Â  Â  Â  Â  draw_text_align(str(oid), rect_x + (rect_w/2), rect_y + 10, font_receipt_no, 'center')

Â  Â  Â  Â  Â  Â  # --- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙˆØ§Ù„ÙˆÙ‚Øª ---
Â  Â  Â  Â  Â  Â  current_time = datetime.datetime.now().strftime("%I:%M %p")
Â  Â  Â  Â  Â  Â  draw_text_align("Ø§Ù„ÙƒØ§Ø´ÙŠØ±: ÙƒØ§Ø´ÙŠØ±", PAPER_WIDTH - MARGIN, y + 10, font_title, 'right')
Â  Â  Â  Â  Â  Â  draw_text_align(current_time, PAPER_WIDTH - MARGIN, y + 50, font_title, 'right')
Â  Â  Â  Â  Â  Â  y += 110

Â  Â  Â  Â  Â  Â  # --- Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ ---
Â  Â  Â  Â  Â  Â  order_title = "ØªÙˆØµÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ" if order_type == 'delivery' else "Ø³ÙØ±ÙŠ (Ø§Ø³ØªÙ„Ø§Ù…)"
Â  Â  Â  Â  Â  Â  if is_reprint: order_title += " (Ù†Ø³Ø®Ø© Ù…ÙƒØ±Ø±Ø©)"
Â  Â  Â  Â  Â  Â  draw.rectangle((MARGIN, y, PAPER_WIDTH - MARGIN, y + 60), fill="#DDDDDD")
Â  Â  Â  Â  Â  Â  draw_text_align(order_title, PAPER_WIDTH/2, y + 10, font_order_type, 'center')
Â  Â  Â  Â  Â  Â  y += 70

Â  Â  Â  Â  Â  Â  # --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ ---
Â  Â  Â  Â  Â  Â  col_x_start = MARGIN
Â  Â  Â  Â  Â  Â  col_x_end = PAPER_WIDTH - MARGIN
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  x_total_line = 130
Â  Â  Â  Â  Â  Â  x_price_line = 230
Â  Â  Â  Â  Â  Â  x_qty_line = 340
Â  Â  Â  Â  Â  Â  x_name_line = 480

Â  Â  Â  Â  Â  Â  # --- Ø±Ø³Ù… Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ---
Â  Â  Â  Â  Â  Â  header_row_h = 60
Â  Â  Â  Â  Â  Â  draw.rectangle((col_x_start, y, col_x_end, y + header_row_h), outline="black", width=3, fill="#EEEEEE")
Â  Â  Â  Â  Â  Â  for x_line in [x_total_line, x_price_line, x_qty_line, x_name_line]:
Â  Â  Â  Â  Â  Â  Â  Â  draw.line((x_line, y, x_line, y + header_row_h), fill="black", width=3)

Â  Â  Â  Â  Â  Â  draw_text_align("Øª", (x_name_line + col_x_end)/2, y+15, font_table_header, 'center')
Â  Â  Â  Â  Â  Â  draw_text_align("Ø§Ù„Ù…Ø§Ø¯Ø©", (x_qty_line + x_name_line)/2, y+15, font_table_header, 'center')
Â  Â  Â  Â  Â  Â  draw_text_align("Ø§Ù„ÙƒÙ…ÙŠØ©", (x_price_line + x_qty_line)/2, y+15, font_table_header, 'center')
Â  Â  Â  Â  Â  Â  draw_text_align("Ø§Ù„Ø³Ø¹Ø±", (x_total_line + x_price_line)/2, y+15, font_table_header, 'center')
Â  Â  Â  Â  Â  Â  draw_text_align("Ø§Ø¬Ù…Ø§Ù„ÙŠ", (col_x_start + x_total_line)/2, y+15, font_table_header, 'center')
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  y += header_row_h

Â  Â  Â  Â  Â  Â  # --- Ø±Ø³Ù… Ø³Ø·ÙˆØ± Ø§Ù„Ù…ÙˆØ§Ø¯ (Ù…Ø¹ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª) ---
Â  Â  Â  Â  Â  Â  for idx, item in enumerate(cart_items):
Â  Â  Â  Â  Â  Â  Â  Â  # ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø³Ø·Ø±: 60 Ø¨ÙŠÙƒØ³Ù„ Ø¹Ø§Ø¯ÙŠØŒ ÙˆÙŠØ¶Ø§Ù 35 Ø¨ÙŠÙƒØ³Ù„ Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª Ù…Ù„Ø§Ø­Ø¸Ø©
Â  Â  Â  Â  Â  Â  Â  Â  base_row_h = 60
Â  Â  Â  Â  Â  Â  Â  Â  has_note = item.get('note') and str(item.get('note')).strip() != ""
Â  Â  Â  Â  Â  Â  Â  Â  current_row_h = base_row_h + (35 if has_note else 0)

Â  Â  Â  Â  Â  Â  Â  Â  # Ø±Ø³Ù… Ø¥Ø·Ø§Ø± Ø§Ù„Ø³Ø·Ø±
Â  Â  Â  Â  Â  Â  Â  Â  draw.rectangle((col_x_start, y, col_x_end, y + current_row_h), outline="black", width=2)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø±Ø³Ù… Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  for x_line in [x_total_line, x_price_line, x_qty_line, x_name_line]:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw.line((x_line, y, x_line, y + current_row_h), fill="black", width=2)

Â  Â  Â  Â  Â  Â  Â  Â  # 1. Ø§Ù„ØªØ³Ù„Ø³Ù„
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(str(idx + 1), (x_name_line + col_x_end)/2, y+15, font_table_row, 'center')

Â  Â  Â  Â  Â  Â  Â  Â  # 2. Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©
Â  Â  Â  Â  Â  Â  Â  Â  # Ø±Ø³Ù… Ø§Ù„Ø§Ø³Ù…
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(item['name'], (x_qty_line + x_name_line)/2, y+15, font_table_row, 'center')
Â  Â  Â  Â  Â  Â  Â  Â  # Ø±Ø³Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
Â  Â  Â  Â  Â  Â  Â  Â  if has_note:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  note_text = f"({item['note']})"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # Ù†Ø±Ø³Ù… Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ø³ÙÙ„ Ø§Ù„Ø§Ø³Ù… Ø¨Ù‚Ù„ÙŠÙ„ ÙˆØ¨Ø®Ø· Ø£ØµØºØ±
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙˆØ¯ (black) Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(note_text, (x_qty_line + x_name_line)/2, y+50, font_note_item, 'center', color='black')

Â  Â  Â  Â  Â  Â  Â  Â  # 3. Ø§Ù„ÙƒÙ…ÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  qty_val = item['qty']
Â  Â  Â  Â  Â  Â  Â  Â  int_part = int(qty_val)
Â  Â  Â  Â  Â  Â  Â  Â  frac_part = qty_val - int_part
Â  Â  Â  Â  Â  Â  Â  Â  frac_str = ""
Â  Â  Â  Â  Â  Â  Â  Â  if abs(frac_part - 0.25) < 0.01: frac_str = "1/4"
Â  Â  Â  Â  Â  Â  Â  Â  elif abs(frac_part - 0.50) < 0.01: frac_str = "1/2"
Â  Â  Â  Â  Â  Â  Â  Â  elif abs(frac_part - 0.75) < 0.01: frac_str = "3/4"
Â  Â  Â  Â  Â  Â  Â  Â  elif frac_part > 0.001: frac_str = f"{frac_part:.2f}"
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  qty_str = f"{int_part} Ùˆ {frac_str}" if int_part > 0 and frac_str else str(int_part) if int_part > 0 else frac_str
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(qty_str, (x_price_line + x_qty_line)/2, y+15, font_table_row, 'center')

Â  Â  Â  Â  Â  Â  Â  Â  # 4. Ø§Ù„Ø³Ø¹Ø±
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(f"{item['price']:,.0f}", (x_total_line + x_price_line)/2, y+15, font_table_row, 'center')

Â  Â  Â  Â  Â  Â  Â  Â  # 5. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(f"{item['total']:,.0f}", (col_x_start + x_total_line)/2, y+15, font_table_row, 'center')

Â  Â  Â  Â  Â  Â  Â  Â  y += current_row_h

Â  Â  Â  Â  Â  Â  y += 20

Â  Â  Â  Â  Â  Â  # --- Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ---
Â  Â  Â  Â  Â  Â  total_box_h = 90
Â  Â  Â  Â  Â  Â  draw.rectangle((col_x_start, y, col_x_end, y + total_box_h), outline="black", width=4)
Â  Â  Â  Â  Â  Â  draw_text_align(": Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ØµØ§ÙÙŠ", col_x_end - 20, y + 25, font_title, 'right')
Â  Â  Â  Â  Â  Â  draw_text_align(f"{total:,.0f}", col_x_start + 40, y + 15, font_total, 'left')
Â  Â  Â  Â  Â  Â  y += total_box_h + 30

Â  Â  Â  Â  Â  Â  # --- ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© ---
Â  Â  Â  Â  Â  Â  draw_text_align(f"Ø§Ù„Ø­Ø§Ù„Ø©: {status}", PAPER_WIDTH/2, y, font_title, 'center')
Â  Â  Â  Â  Â  Â  y += 40

Â  Â  Â  Â  Â  Â  # Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (General Notes) ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨ÙˆØ¶ÙˆØ­
Â  Â  Â  Â  Â  Â  if g_note and str(g_note).strip() != "":
Â  Â  Â  Â  Â  Â  Â  Â  # ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙˆØ¯ (black) ÙˆØ¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(f"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ù„Ø¨: {g_note}", col_x_end, y, font_details, 'right', color='black')
Â  Â  Â  Â  Â  Â  Â  Â  y += 50
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if name:
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(f"Ø§Ù„Ø²Ø¨ÙˆÙ† : {name}", col_x_end, y, font_details, 'right')
Â  Â  Â  Â  Â  Â  Â  Â  y += 40
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if address_str and order_type == 'delivery':
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(f"Ø§Ù„Ø¹Ù†ÙˆØ§Ù† : {address_str}", col_x_end, y, font_details, 'right')
Â  Â  Â  Â  Â  Â  Â  Â  y += 40
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if phone:
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(f"Ù‡Ø§ØªÙ Ø§Ù„Ø²Ø¨ÙˆÙ† : {phone}", col_x_end, y, font_details, 'right')
Â  Â  Â  Â  Â  Â  Â  Â  y += 50

Â  Â  Â  Â  Â  Â  # ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±
Â  Â  Â  Â  Â  Â  if time_str:
Â  Â  Â  Â  Â  Â  Â  Â  y += 10
Â  Â  Â  Â  Â  Â  Â  Â  time_box_h = 80
Â  Â  Â  Â  Â  Â  Â  Â  draw.rectangle((MARGIN, y, PAPER_WIDTH - MARGIN, y + time_box_h), fill="black")
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_align(f"Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø§Ø¹Ø© {time_str}", PAPER_WIDTH/2, y + 10, font_time_large, 'center', color='white')
Â  Â  Â  Â  Â  Â  Â  Â  y += time_box_h + 30

Â  Â  Â  Â  Â  Â  # --- Ø§Ù„ØªØ°ÙŠÙŠÙ„ ---
Â  Â  Â  Â  Â  Â  draw.line((col_x_start, y, col_x_end, y), fill="black", width=3)
Â  Â  Â  Â  Â  Â  y += 10
Â  Â  Â  Â  Â  Â  draw_text_align(self.settings['receipt_design']['footer_text'], PAPER_WIDTH/2, y, font_footer, 'center')
Â  Â  Â  Â  Â  Â  y += 35
Â  Â  Â  Â  Â  Â  draw_text_align("Ø­ÙŠ Ø§Ù„Ø¬Ù‡Ø§Ø¯ - Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ - Ø´Ø§Ø±Ø¹ Ø¬Ø§Ù…Ø¹ Ø´Ù†Ø´Ù„ - Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ø²Ù‡Ø§Ø±", PAPER_WIDTH/2, y, font_footer, 'center')
Â  Â  Â  Â  Â  Â  y += 50

Â  Â  Â  Â  Â  Â  # --- Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø·ÙˆÙ„ Ø§Ù„ÙØ¹Ù„ÙŠ ---
Â  Â  Â  Â  Â  Â  final_img = img.crop((0, 0, PAPER_WIDTH, y))
Â  Â  Â  Â  Â  Â  self.send_image_to_printer(final_img)

Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©", str(e))

Â  Â  def generate_daily_report(self):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  Â  Â  now_dt = datetime.datetime.now()
Â  Â  Â  Â  Â  Â  now_date = now_dt.strftime("%Y-%m-%d")
Â  Â  Â  Â  Â  Â  now_time = now_dt.strftime("%Y-%m-%d %H:%M:%S")

Â  Â  Â  Â  Â  Â  # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¬Ø±ÙˆØ¯Ø© (is_closed = 0) Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
Â  Â  Â  Â  Â  Â  c.execute("SELECT COUNT(*), IFNULL(SUM(CASE WHEN status != 'Ù…Ø±ØªØ¬Ø¹' THEN total ELSE 0 END), 0) FROM orders WHERE date LIKE ? AND is_closed = 0", (f"{now_date}%",))
Â  Â  Â  Â  Â  Â  summary = c.fetchone()
Â  Â  Â  Â  Â  Â  total_orders = summary[0] if summary[0] else 0
Â  Â  Â  Â  Â  Â  total_sales = summary[1] if summary[1] else 0

Â  Â  Â  Â  Â  Â  # Ø¬Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ Ù„Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¬Ø±ÙˆØ¯Ø©
Â  Â  Â  Â  Â  Â  c.execute('''SELECT product_name, SUM(qty), SUM(order_items.total)Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â FROM order_itemsÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â JOIN orders ON order_items.order_id = orders.idÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â WHERE orders.date LIKE ? AND orders.status != 'Ù…Ø±ØªØ¬Ø¹' AND orders.is_closed = 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â GROUP BY product_name''', (f"{now_date}%",))
Â  Â  Â  Â  Â  Â  items_summary = c.fetchall()

Â  Â  Â  Â  Â  Â  if total_orders == 0:
Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showinfo("ØªÙ†Ø¨ÙŠÙ‡", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© (ØºÙŠØ± Ù…Ø¬Ø±ÙˆØ¯Ø©) Ù„Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§."); conn.close(); return

Â  Â  Â  Â  Â  Â  msg = f"ØªÙ‚Ø±ÙŠØ± Ø¥ØºÙ„Ø§Ù‚ Ø´ÙŠÙØª/ÙØªØ±Ø© ({now_time})\nØ¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: {total_orders}\nÙ…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙØªØ±Ø©: {total_sales:,.0f} Ø¯.Ø¹\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø­ÙØ¸ Ø§Ù„Ø¬Ø±Ø¯ ÙˆØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©ØŸ"
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if messagebox.askyesno("Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙØªØ±Ø©", msg):
Â  Â  Â  Â  Â  Â  Â  Â  # Ø­ÙØ¸ PDF
Â  Â  Â  Â  Â  Â  Â  Â  report_name = f"{now_date}_Shift_{datetime.datetime.now().strftime('%H-%M')}"
Â  Â  Â  Â  Â  Â  Â  Â  self.save_daily_report_pdf(report_name, total_orders, total_sales, items_summary)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¯
Â  Â  Â  Â  Â  Â  Â  Â  c.execute("INSERT INTO daily_shifts (closing_time, total_sales, total_orders, report_date) VALUES (?, ?, ?, ?)", (now_time, total_sales, total_orders, now_date))
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
Â  Â  Â  Â  Â  Â  Â  Â  c.execute("UPDATE orders SET is_closed = 1 WHERE date LIKE ? AND is_closed = 0", (f"{now_date}%",))
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø¬Ø±Ø¯ Ø§Ù„ÙØªØ±Ø© Ø¨Ù†Ø¬Ø§Ø­.\nØ³ÙŠØ¨Ø¯Ø£ Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù…Ù† Ø±Ù‚Ù… 1 Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.")
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£: {str(e)}")

Â  Â  def save_daily_report_pdf(self, report_name, total_orders, total_sales, items_summary):
Â  Â  Â  Â  # --- Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ù„Ù„Ø­ÙØ¸ ---
Â  Â  Â  Â  folder_name = "DailyReports"
Â  Â  Â  Â  if not os.path.exists(folder_name): os.makedirs(folder_name)
Â  Â  Â  Â  filename = f"{report_name}.pdf"
Â  Â  Â  Â  filepath = os.path.join(folder_name, filename)

Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  pdfmetrics.registerFont(TTFont('ArabicFont', 'C:\\Windows\\Fonts\\arial.ttf'))
Â  Â  Â  Â  Â  Â  pdfmetrics.registerFont(TTFont('ArabicBold', 'C:\\Windows\\Fonts\\arialbd.ttf'))
Â  Â  Â  Â  Â  Â  ARABIC_FONT = 'ArabicFont'; ARABIC_BOLD = 'ArabicBold'
Â  Â  Â  Â  except: ARABIC_FONT = 'Helvetica'; ARABIC_BOLD = 'Helvetica-Bold'

Â  Â  Â  Â  # --- Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙØ­Ø© Ø¨Ø­Ø¬Ù… 80 Ù…Ù… ---
Â  Â  Â  Â  PAGE_WIDTH = 80 * mm
Â  Â  Â  Â  PAGE_HEIGHT = (150 * mm) + (len(items_summary) * 8 * mm)
Â  Â  Â  Â Â 
Â  Â  Â  Â  doc = SimpleDocTemplate(filepath, pagesize=(PAGE_WIDTH, PAGE_HEIGHT),Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  rightMargin=2*mm, leftMargin=2*mm, topMargin=5*mm, bottomMargin=5*mm)
Â  Â  Â  Â  elements = []
Â  Â  Â  Â Â 
Â  Â  Â  Â  def ar(text): return get_display(arabic_reshaper.reshape(str(text)))

Â  Â  Â  Â  # Ø§Ù†Ù…Ø§Ø· Ø§Ù„Ø®Ø·ÙˆØ·
Â  Â  Â  Â  style_header = ParagraphStyle('Header', fontName=ARABIC_BOLD, fontSize=16, alignment=TA_CENTER)
Â  Â  Â  Â  style_sub = ParagraphStyle('Sub', fontName=ARABIC_BOLD, fontSize=10, alignment=TA_CENTER)
Â  Â  Â  Â  style_bold_row = ParagraphStyle('Row', fontName=ARABIC_BOLD, fontSize=10, alignment=TA_CENTER)
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø§Ù„Ø±Ø£Ø³
Â  Â  Â  Â  elements.append(Paragraph(ar("ØªÙ‚Ø±ÙŠØ± Ø¥ØºÙ„Ø§Ù‚ ÙØªØ±Ø© (Z-Report)"), style_header))
Â  Â  Â  Â  elements.append(Spacer(1, 3*mm))
Â  Â  Â  Â Â 
Â  Â  Â  Â  now_time = datetime.datetime.now().strftime("%Y-%m-%dÂ  %I:%M %p")
Â  Â  Â  Â  elements.append(Paragraph(ar(f"ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¬Ø±Ø¯: {now_time}"), style_sub))
Â  Â  Â  Â  elements.append(Paragraph(ar(f"Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: {total_orders}"), style_sub))
Â  Â  Â  Â  elements.append(Spacer(1, 4*mm))
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø§Ù„Ø¬Ø¯ÙˆÙ„
Â  Â  Â  Â  table_data = [[ar("Ø§Ø¬Ù…Ø§Ù„ÙŠ"), ar("Ø§Ù„Ø¹Ø¯Ø¯"), ar("Ø§Ù„Ù…Ø§Ø¯Ø©")]]
Â  Â  Â  Â Â 
Â  Â  Â  Â  for name, qty, total in items_summary:
Â  Â  Â  Â  Â  Â  qty_txt = str(int(qty)) if qty == int(qty) else f"{qty:.2f}"
Â  Â  Â  Â  Â  Â  row = [
Â  Â  Â  Â  Â  Â  Â  Â  ar(f"{total:,.0f}"),
Â  Â  Â  Â  Â  Â  Â  Â  ar(qty_txt),
Â  Â  Â  Â  Â  Â  Â  Â  ar(name)
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  table_data.append(row)

Â  Â  Â  Â  col_widths = [22*mm, 13*mm, 35*mm]
Â  Â  Â  Â  t = Table(table_data, colWidths=col_widths)
Â  Â  Â  Â  t.setStyle(TableStyle([
Â  Â  Â  Â  Â  Â  ('FONT', (0, 0), (-1, -1), ARABIC_BOLD, 9),
Â  Â  Â  Â  Â  Â  ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
Â  Â  Â  Â  Â  Â  ('GRID', (0, 0), (-1, -1), 1, colors.black), # Ø®Ø·ÙˆØ· Ø´Ø¨ÙƒØ© ÙˆØ§Ø¶Ø­Ø©
Â  Â  Â  Â  Â  Â  ('BACKGROUND', (0, 0), (-1, 0), colors.lightgrey),
Â  Â  Â  Â  Â  Â  ('VALIGN', (0, 0), (-1, -1), 'MIDDLE'),
Â  Â  Â  Â  Â  Â  ('LEFTPADDING', (0, 0), (-1, -1), 1),
Â  Â  Â  Â  Â  Â  ('RIGHTPADDING', (0, 0), (-1, -1), 1),
Â  Â  Â  Â  ]))
Â  Â  Â  Â  elements.append(t)
Â  Â  Â  Â  elements.append(Spacer(1, 5*mm))

Â  Â  Â  Â  # Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
Â  Â  Â  Â  elements.append(Paragraph(ar("-" * 25), style_sub))
Â  Â  Â  Â  elements.append(Paragraph(ar(f"Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙØªØ±Ø©"), style_sub))
Â  Â  Â  Â  elements.append(Paragraph(ar(f"{total_sales:,.0f} Ø¯.Ø¹"), style_header))
Â  Â  Â  Â  elements.append(Paragraph(ar("-" * 25), style_sub))

Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  doc.build(elements)
Â  Â  Â  Â  Â  Â  # ÙØªØ­ Ø§Ù„Ù…Ù„Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
Â  Â  Â  Â  Â  Â  os.startfile(filepath)
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", f"ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ PDF: {e}")

Â  Â  def send_image_to_printer(self, image):
Â  Â  Â  Â  # Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
Â  Â  Â  Â  selected_printers = self.settings.get('printers', [])
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ© Ø£Ùˆ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "Default"ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙ‚Ø·
Â  Â  Â  Â  if not selected_printers or (len(selected_printers) == 1 and selected_printers[0] == "Default"):
Â  Â  Â  Â  Â  Â  selected_printers = [win32print.GetDefaultPrinter()]
Â  Â  Â  Â Â 
Â  Â  Â  Â  errors = []
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø­Ù„Ù‚Ø© ØªÙƒØ±Ø§Ø±ÙŠØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¹Ù„Ù‰ ÙƒÙ„ Ø·Ø§Ø¨Ø¹Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
Â  Â  Â  Â  for printer_name in selected_printers:
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  target_printer = printer_name
Â  Â  Â  Â  Â  Â  Â  Â  if target_printer == "Default" or target_printer == "Default Printer":
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  target_printer = win32print.GetDefaultPrinter()

Â  Â  Â  Â  Â  Â  Â  Â  # Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©
Â  Â  Â  Â  Â  Â  Â  Â  hDC = win32ui.CreateDC()
Â  Â  Â  Â  Â  Â  Â  Â  hDC.CreatePrinterDC(target_printer)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø¨Ø¯Ø¡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
Â  Â  Â  Â  Â  Â  Â  Â  hDC.StartDoc(f"Receipt_{target_printer}")
Â  Â  Â  Â  Â  Â  Â  Â  hDC.StartPage()
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø±Ø³Ù… Ø§Ù„ØµÙˆØ±Ø©
Â  Â  Â  Â  Â  Â  Â  Â  dib = ImageWin.Dib(image)
Â  Â  Â  Â  Â  Â  Â  Â  dib.draw(hDC.GetHandleOutput(), (0, 0, image.size[0], image.size[1]))
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
Â  Â  Â  Â  Â  Â  Â  Â  hDC.EndPage()
Â  Â  Â  Â  Â  Â  Â  Â  hDC.EndDoc()
Â  Â  Â  Â  Â  Â  Â  Â  hDC.DeleteDC()
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  Â  Â  # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ù† ÙˆØ¬Ø¯ ÙˆÙ„ÙƒÙ† Ù„Ø§ Ù†ÙˆÙ‚Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø­ØªÙ‰ ØªØ·Ø¨Ø¹ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰
Â  Â  Â  Â  Â  Â  Â  Â  errors.append(f"Ø®Ø·Ø£ ÙÙŠ {printer_name}: {str(e)}")

Â  Â  Â  Â  # Ø¥Ø°Ø§ Ø­Ø¯Ø«Øª Ø£Ø®Ø·Ø§Ø¡ Ù†Ø¹Ø±Ø¶Ù‡Ø§
Â  Â  Â  Â  if errors:
Â  Â  Â  Â  Â  Â  error_msg = "\n".join(errors)
Â  Â  Â  Â  Â  Â  messagebox.showerror("ØªÙ†Ø¨ÙŠÙ‡ Ø·Ø¨Ø§Ø¹Ø©", f"Ø­Ø¯Ø«Øª Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡:\n{error_msg}")
Â  Â  Â  Â Â 
Â  Â  def build_products_tab(self):
Â  Â  Â  Â  main_frame = tk.Frame(self.products_frame, bg=BG_MAIN_COLOR, padx=20, pady=20); main_frame.pack(fill='both', expand=True)
Â  Â  Â  Â  side_panel = tk.Frame(main_frame, bg=PANEL_COLOR, width=350, relief='raised', bd=1, padx=15, pady=15); side_panel.pack(side='right', fill='y', padx=(10, 0)); side_panel.pack_propagate(False)
Â  Â  Â  Â  tk.Label(side_panel, text="â• Ø¥Ø¶Ø§ÙØ© ÙˆØ¬Ø¨Ø©", font=FONT_TITLE, bg=PANEL_COLOR, fg="white").pack(pady=(0, 20))
Â  Â  Â  Â  self.p_name = tk.StringVar(); self.p_price = tk.DoubleVar(); self.p_weight_based = tk.BooleanVar(); self.p_card_color = tk.StringVar(value="Ø£Ø¨ÙŠØ¶ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)"); self.p_suggestions = tk.StringVar(); self.p_image_path = None
Â  Â  Â  Â  tk.Label(side_panel, text="Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  p_name_entry = tk.Entry(side_panel, textvariable=self.p_name, font=FONT_MAIN, bg="#F9F9F9"); p_name_entry.pack(fill='x', pady=(5, 10), ipady=5); p_name_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.p_name, "Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©", "arabic"))
Â  Â  Â  Â  tk.Label(side_panel, text="Ø§Ù„Ø³Ø¹Ø±", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  tk.Entry(side_panel, textvariable=self.p_price, font=FONT_MAIN, bg="#F9F9F9").pack(fill='x', pady=(5, 10), ipady=5)
Â  Â  Â  Â  tk.Label(side_panel, text="Ù„ÙˆÙ† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆØ¬Ø¨Ø© ğŸ¨", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  cb_colors = ttk.Combobox(side_panel, textvariable=self.p_card_color, values=list(CARD_COLORS.keys()), state="readonly", font=FONT_MAIN); cb_colors.pack(fill='x', pady=(5, 10)); cb_colors.current(0)
Â  Â  Â  Â  tk.Label(side_panel, text="Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  p_sug_entry = tk.Entry(side_panel, textvariable=self.p_suggestions, font=("Segoe UI", 10), bg="#F9F9F9"); p_sug_entry.pack(fill='x', pady=(5, 10), ipady=5); p_sug_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.p_suggestions, "Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª", "arabic"))
Â  Â  Â  Â  tk.Checkbutton(side_panel, text="Ø¨ÙŠØ¹ Ø¨Ø§Ù„ÙˆØ²Ù† (ÙƒØºÙ…) âš–ï¸", variable=self.p_weight_based, bg=PANEL_COLOR, font=FONT_MAIN, fg="white", selectcolor=PANEL_COLOR).pack(anchor='e', pady=10)
Â  Â  Â  Â  tk.Button(side_panel, text="ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© ğŸ–¼ï¸", command=self.upload_image, bg=SECONDARY_COLOR, fg="white", font=FONT_MAIN, relief='flat').pack(fill='x', pady=5)
Â  Â  Â  Â  self.lbl_img_path = tk.Label(side_panel, text="Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©", bg=PANEL_COLOR, fg="#DDD"); self.lbl_img_path.pack()
Â  Â  Â  Â  tk.Button(side_panel, text="ğŸ’¾ Ø­Ù€ÙÙ€Ø¸ Ø§Ù„Ù€ÙˆØ¬Ù€Ø¨Ù€Ø©", command=self.save_product, bg=SUCCESS_COLOR, fg="white", font=("Segoe UI", 20, "bold"), height=1, relief='raised', bd=2).pack(fill='x', pady=0)
Â  Â  Â  Â  list_frame = tk.Frame(main_frame, bg=BG_MAIN_COLOR); list_frame.pack(side='left', fill='both', expand=True)
Â  Â  Â  Â  tk.Label(list_frame, text="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©", font=FONT_TITLE, bg=BG_MAIN_COLOR, fg=TEXT_COLOR).pack(anchor='e', pady=10)
Â  Â  Â  Â  cols = ('id', 'name', 'price', 'type'); self.products_tree = ttk.Treeview(list_frame, columns=cols, show='headings')
Â  Â  Â  Â  self.products_tree.heading('id', text='#'); self.products_tree.heading('name', text='Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©'); self.products_tree.heading('price', text='Ø§Ù„Ø³Ø¹Ø±'); self.products_tree.heading('type', text='Ø§Ù„Ù†ÙˆØ¹')
Â  Â  Â  Â  self.products_tree.column('id', width=50, anchor='center'); self.products_tree.pack(fill='both', expand=True)
Â  Â  Â  Â  btn_frame = tk.Frame(list_frame, bg=BG_MAIN_COLOR, pady=10); btn_frame.pack(fill='x')
Â  Â  Â  Â  tk.Button(btn_frame, text="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ”„", command=self.load_products_list, font=FONT_MAIN, bg="white").pack(side='right', padx=5)
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ âŒ", command=self.delete_product, font=FONT_MAIN, bg=DANGER_COLOR, fg="white").pack(side='right', padx=5)
Â  Â  Â  Â  self.load_products_list()
Â  Â  def upload_image(self):
Â  Â  Â  Â  path = filedialog.askopenfilename(filetypes=[("Images", "*.jpg *.png *.jpeg")])
Â  Â  Â  Â  if path: self.p_image_path = path; self.lbl_img_path.config(text=os.path.basename(path))
Â  Â  def save_product(self):
Â  Â  Â  Â  if not self.p_name.get() or self.p_price.get() <= 0: messagebox.showerror("Ø®Ø·Ø£", "ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return
Â  Â  Â  Â  img = None
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  if self.p_image_path:
Â  Â  Â  Â  Â  Â  Â  Â  with open(self.p_image_path, 'rb') as f: img = f.read()
Â  Â  Â  Â  except: img = None
Â  Â  Â  Â  color_hex = CARD_COLORS.get(self.p_card_color.get(), "#FFFFFF"); suggestions_txt = self.p_suggestions.get()
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  c.execute("INSERT INTO products (name, price, image, category, weight_based, card_color, suggestions) VALUES (?,?,?,?,?,?,?)", (self.p_name.get(), self.p_price.get(), img, "Ø¹Ø§Ù…", 1 if self.p_weight_based.get() else 0, color_hex, suggestions_txt))
Â  Â  Â  Â  conn.commit(); conn.close()
Â  Â  Â  Â  self.search_var.set(""); self.load_products_list(); self.load_products_grid()
Â  Â  Â  Â  self.p_name.set(""); self.p_price.set(0); self.p_weight_based.set(False); self.p_suggestions.set(""); self.p_card_color.set("Ø£Ø¨ÙŠØ¶ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)"); self.lbl_img_path.config(text="Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©"); self.p_image_path = None; messagebox.showinfo("ØªÙ…", "ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙˆØ¬Ø¨Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©")
Â  Â  def load_products_list(self):
Â  Â  Â  Â  for i in self.products_tree.get_children(): self.products_tree.delete(i)
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  c.execute("SELECT id, name, price, weight_based FROM products")
Â  Â  Â  Â  for r in c.fetchall(): t = "ÙˆØ²Ù†" if r[3] else "Ù‚Ø·Ø¹Ø©"; self.products_tree.insert('', 'end', values=(r[0], r[1], r[2], t))
Â  Â  Â  Â  conn.close()
Â  Â  def delete_product(self):
Â  Â  Â  Â  sel = self.products_tree.selection()
Â  Â  Â  Â  if not sel: return
Â  Â  Â  Â  pid = self.products_tree.item(sel[0])['values'][0]
Â  Â  Â  Â  if messagebox.askyesno("ØªØ£ÙƒÙŠØ¯", "Ø­Ø°Ù Ø§Ù„ÙˆØ¬Ø¨Ø©ØŸ"):
Â  Â  Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); conn.cursor().execute("DELETE FROM products WHERE id=?", (pid,)); conn.commit(); conn.close()
Â  Â  Â  Â  Â  Â  self.load_products_list(); self.load_products_grid()
Â  Â  def build_reports_tab(self):
Â  Â  Â  Â  main_frame = tk.Frame(self.reports_frame, bg="#E6EBEF"); main_frame.pack(fill='both', expand=True, padx=0, pady=0)
Â  Â  Â  Â  header_frame = tk.Frame(main_frame, bg="#CAD6DC", pady=10, padx=20, relief='raised', bd=1); header_frame.pack(fill='x')
Â  Â  Â  Â  tk.Label(header_frame, text="ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙˆØ§ØªÙŠØ±", font=("Segoe UI", 16, "bold", "underline"), bg="#CAD6DC", fg="#333").pack(side='top', pady=(0,5))
Â  Â  Â  Â  filter_frame = tk.Frame(header_frame, bg="#CAD6DC"); filter_frame.pack(side='top', fill='x')
Â  Â  Â  Â  self.report_period = tk.StringVar(value="today")
Â  Â  Â  Â  modes = [("Ø§Ù„ÙŠÙˆÙ…", "today"), ("Ø£Ø³Ø¨ÙˆØ¹", "week"), ("Ø´Ù‡Ø±", "month"), ("Ø³Ù†Ø©", "year"), ("Ø§Ù„ÙƒÙ„", "all")]
Â  Â  Â  Â  tk.Label(filter_frame, text="Ø¹Ø±Ø¶ Ø­Ø³Ø¨:", bg="#CAD6DC", font=FONT_BOLD).pack(side='right', padx=10)
Â  Â  Â  Â  for txt, val in modes: tk.Radiobutton(filter_frame, text=txt, variable=self.report_period, value=val, command=self.load_reports, bg="#CAD6DC", font=FONT_MAIN, selectcolor="white", indicatoron=0, width=8, relief='groove').pack(side='right', padx=2)
Â  Â  Â  Â  tk.Button(filter_frame, text="ØªØµØ¯ÙŠØ± ğŸ“„", command=self.export_report, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD).pack(side='left', padx=10)
Â  Â  Â  Â  tk.Button(filter_frame, text="ØªØ­Ø¯ÙŠØ« ğŸ”„", command=self.load_reports, bg=PRIMARY_COLOR, fg="white", font=FONT_BOLD).pack(side='left', padx=10)
Â  Â  Â  Â  tk.Button(filter_frame, text="Ø¥ØºÙ„Ø§Ù‚ ÙØªØ±Ø©/Ø´ÙŠÙØª (Ø¬Ø±Ø¯) ğŸ", command=self.generate_daily_report, bg="#FF9800", fg="white", font=FONT_BOLD, relief='raised', bd=2).pack(side='left', padx=20)
Â  Â  Â  Â  tree_frame = tk.Frame(main_frame, bg="white", padx=10, pady=10); tree_frame.pack(fill='both', expand=True)
Â  Â  Â  Â  cols = ('seq', 'date', 'type', 'cust', 'total'); self.report_tree = ttk.Treeview(tree_frame, columns=cols, show='headings', selectmode='extended')
Â  Â  Â  Â  self.report_tree.heading('seq', text='Øª'); self.report_tree.heading('date', text='Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª'); self.report_tree.heading('type', text='Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨'); self.report_tree.heading('cust', text='Ø§Ù„Ø²Ø¨ÙˆÙ†'); self.report_tree.heading('total', text='Ø§Ù„Ù…Ø¨Ù„Øº')
Â  Â  Â  Â  self.report_tree.column('seq', width=50, anchor='center'); self.report_tree.column('date', width=150, anchor='center'); self.report_tree.column('type', width=100, anchor='center'); self.report_tree.column('cust', width=150, anchor='center'); self.report_tree.column('total', width=100, anchor='center')
Â  Â  Â  Â  scrollbar = ttk.Scrollbar(tree_frame, orient="vertical", command=self.report_tree.yview); self.report_tree.configure(yscrollcommand=scrollbar.set); scrollbar.pack(side='right', fill='y'); self.report_tree.pack(fill='both', expand=True)
Â  Â  Â  Â  delete_btns_frame = tk.Frame(tree_frame, bg="white", pady=3); delete_btns_frame.pack(fill='x', side='bottom')
Â  Â  Â  Â  tk.Button(delete_btns_frame, text="Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ğŸ—‘ï¸", command=self.delete_selected_reports, bg=DANGER_COLOR, fg="white", font=FONT_BOLD).pack(side='right', padx=3)
Â  Â  Â  Â  tk.Button(delete_btns_frame, text="Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ğŸ’£", command=self.delete_all_reports, bg="#8B0000", fg="white", font=FONT_BOLD).pack(side='right', padx=3)
Â  Â  Â  Â  summary_container = tk.Frame(main_frame, bg="#D5DBDB", pady=3, padx=10, relief='raised', bd=2); summary_container.pack(fill='x', side='bottom')
Â  Â  Â  Â  total_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid"); total_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(total_frame, text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº", bg="#95A5A6", fg="white", font=("Segoe UI", 8, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_total_sales = tk.Label(total_frame, text="0", bg="white", font=("Segoe UI", 12, "bold"), fg=SUCCESS_COLOR, height=2); self.lbl_total_sales.pack(fill='x')
Â  Â  Â  Â  disc_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid"); disc_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(disc_frame, text="Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±", bg="#95A5A6", fg="white", font=("Segoe UI", 12, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_count = tk.Label(disc_frame, text="0", bg="white", font=("Segoe UI", 10, "bold"), fg="#2C3E50", height=2); self.lbl_count.pack(fill='x')
Â  Â  Â  Â  exp_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid"); exp_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(exp_frame, text="Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ", bg="#95A5A6", fg="white", font=("Segoe UI", 12, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_expenses = tk.Label(exp_frame, text="0", bg="white", font=("Segoe UI", 10, "bold"), fg=DANGER_COLOR, height=2); self.lbl_expenses.pack(fill='x')
Â  Â  Â  Â  net_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid"); net_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(net_frame, text="Ø§Ù„ØµØ§ÙÙŠ", bg="#95A5A6", fg="white", font=("Segoe UI", 12, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_net_profit = tk.Label(net_frame, text="0", bg="white", font=("Segoe UI", 10, "bold"), fg="#2C3E50", height=2); self.lbl_net_profit.pack(fill='x')
Â  Â  Â  Â  self.load_reports()
Â  Â  def delete_selected_reports(self):
Â  Â  Â  Â  selected_items = self.report_tree.selection()
Â  Â  Â  Â  if not selected_items: messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø£ÙƒØ«Ø± Ù„Ù„Ø­Ø°Ù."); return
Â  Â  Â  Â  if not messagebox.askyesno("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù", f"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù {len(selected_items)} ÙØ§ØªÙˆØ±Ø©ØŸ"): return
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  for item in selected_items:
Â  Â  Â  Â  Â  Â  Â  Â  order_id = self.report_tree.item(item)['values'][0]
Â  Â  Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM orders WHERE id=?", (order_id,)); c.execute("DELETE FROM order_items WHERE order_id=?", (order_id,)); c.execute("DELETE FROM sales WHERE order_id=?", (order_id,))
Â  Â  Â  Â  Â  Â  conn.commit(); messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­.")
Â  Â  Â  Â  except Exception as e: conn.rollback(); messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: {str(e)}")
Â  Â  Â  Â  finally: conn.close(); self.load_reports()
Â  Â  def delete_all_reports(self):
Â  Â  Â  Â  if not messagebox.askyesno("ØªØ­Ø°ÙŠØ±! Ø­Ø°Ù Ø´Ø§Ù…Ù„", "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù **Ø¬Ù…ÙŠØ¹** Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡."): return
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  try: c.execute("DELETE FROM orders"); c.execute("DELETE FROM order_items"); c.execute("DELETE FROM sales"); c.execute("DELETE FROM daily_shifts"); conn.commit(); messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.")
Â  Â  Â  Â  except Exception as e: conn.rollback(); messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø´Ø§Ù…Ù„: {str(e)}")
Â  Â  Â  Â  finally: conn.close(); self.load_reports()
Â  Â  def load_reports(self):
Â  Â  Â  Â  for i in self.report_tree.get_children(): self.report_tree.delete(i)
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name); c = conn.cursor()
Â  Â  Â  Â  period = self.report_period.get(); now = datetime.datetime.now()
Â  Â  Â  Â  query = "SELECT id, date, type, customer_name, total, status, daily_id FROM orders WHERE 1=1"
Â  Â  Â  Â  params = []
Â  Â  Â  Â  if period == "today": date_filter = now.strftime("%Y-%m-%d"); query += " AND date LIKE ?"; params.append(f"{date_filter}%")
Â  Â  Â  Â  elif period == "week": d = (now - datetime.timedelta(days=7)).strftime("%Y-%m-%d"); query += " AND date >= ?"; params.append(d)
Â  Â  Â  Â  elif period == "month": d = (now - datetime.timedelta(days=30)).strftime("%Y-%m-%d"); query += " AND date >= ?"; params.append(d)
Â  Â  Â  Â  elif period == "year": d = (now - datetime.timedelta(days=365)).strftime("%Y-%m-%d"); query += " AND date >= ?"; params.append(d)
Â  Â  Â  Â  query += " ORDER BY id DESC"
Â  Â  Â  Â  c.execute(query, params); rows = c.fetchall()
Â  Â  Â  Â  total_sum = 0; count = 0
Â  Â  Â  Â  for idx, r in enumerate(rows):
Â  Â  Â  Â  Â  Â  t_type = "Ø³ÙØ±ÙŠ" if r[2] == "takeaway" else "ØªÙˆØµÙŠÙ„"
Â  Â  Â  Â  Â  Â  if r[5] == "Ù…Ø±ØªØ¬Ø¹": t_type += " (Ù…Ø±ØªØ¬Ø¹)"
Â  Â  Â  Â  Â  Â  display_id = r[6] if r[6] else r[0] # Ø§Ø³ØªØ®Ø¯Ø§Ù… daily_id
Â  Â  Â  Â  Â  Â  self.report_tree.insert('', 'end', values=(display_id, r[1][:16], t_type, r[3], f"{r[4]:,.0f}"))
Â  Â  Â  Â  Â  Â  if r[5] != "Ù…Ø±ØªØ¬Ø¹": total_sum += r[4]
Â  Â  Â  Â  Â  Â  count += 1
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  self.lbl_total_sales.config(text=f"{total_sum:,.0f}"); self.lbl_count.config(text=str(count)); self.lbl_net_profit.config(text=f"{total_sum:,.0f}"); self.lbl_expenses.config(text="0")
Â  Â  def export_report(self):
Â  Â  Â  Â  path = filedialog.asksaveasfilename(defaultextension=".txt")
Â  Â  Â  Â  if path:
Â  Â  Â  Â  Â  Â  with open(path, 'w', encoding='utf-8') as f:
Â  Â  Â  Â  Â  Â  Â  Â  f.write("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª\n"); f.write(f"Ø§Ù„ÙØªØ±Ø©: {self.report_period.get()}\n"); f.write("-" * 50 + "\n")
Â  Â  Â  Â  Â  Â  Â  Â  for item in self.report_tree.get_children(): vals = self.report_tree.item(item)['values']; f.write(f"{vals}\n")
Â  Â  Â  Â  Â  Â  Â  Â  f.write("-" * 50 + "\n"); f.write(f"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: {self.lbl_total_sales.cget('text')}\n")
Â  Â  Â  Â  Â  Â  messagebox.showinfo("ØªÙ…", "ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±")
Â  Â Â 
Â  Â  def build_settings_tab(self):
Â  Â  Â  Â  frame = tk.Frame(self.settings_frame, bg=BG_MAIN_COLOR, padx=30, pady=30)
Â  Â  Â  Â  frame.pack(fill='both', expand=True)

Â  Â  Â  Â  # --- Ø¥Ø·Ø§Ø± Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª ---
Â  Â  Â  Â  p_frame = tk.LabelFrame(frame, text=" Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© ", font=FONT_BOLD, bg=BG_MAIN_COLOR, padx=20, pady=20)
Â  Â  Â  Â  p_frame.pack(fill='x', pady=10)

Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  # Ø¬Ù„Ø¨ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø«Ø¨ØªØ© ÙÙŠ Ø§Ù„ÙˆÙŠÙ†Ø¯ÙˆØ²
Â  Â  Â  Â  Â  Â  printers = [p[2] for p in win32print.EnumPrinters(win32print.PRINTER_ENUM_LOCAL)]
Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  printers = ["Default"]

Â  Â  Â  Â  # selectmode=tk.MULTIPLE ÙŠØ³Ù…Ø­ Ø¨Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ø§Ø¨Ø¹Ø©
Â  Â  Â  Â  self.printer_list = tk.Listbox(p_frame, selectmode=tk.MULTIPLE, height=8, font=FONT_MAIN, bg="#FFF", activestyle='dotbox')
Â  Â  Â  Â  self.printer_list.pack(fill='x', pady=5)

Â  Â  Â  Â  # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­ÙÙˆØ¸ Ù…Ù†Ù‡Ø§ Ø³Ø§Ø¨Ù‚Ø§Ù‹
Â  Â  Â  Â  saved_printers = self.settings.get('printers', [])
Â  Â  Â  Â Â 
Â  Â  Â  Â  for idx, p in enumerate(printers):
Â  Â  Â  Â  Â  Â  self.printer_list.insert('end', p)
Â  Â  Â  Â  Â  Â  # Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ¯Ù‡Ø§
Â  Â  Â  Â  Â  Â  if p in saved_printers:
Â  Â  Â  Â  Â  Â  Â  Â  self.printer_list.selection_set(idx)

Â  Â  Â  Â  tk.Button(p_frame, text="Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©) ğŸ’¾", command=self.save_printers, bg=PRIMARY_COLOR, fg="white", font=FONT_MAIN).pack(pady=5)

Â  Â  Â  Â  # --- Ø¥Ø·Ø§Ø± Ø§Ù„ØªØµÙ…ÙŠÙ… ---
Â  Â  Â  Â  r_frame = tk.LabelFrame(frame, text=" ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ", font=FONT_BOLD, bg=BG_MAIN_COLOR, padx=0, pady=0)
Â  Â  Â  Â  r_frame.pack(fill='x', pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(r_frame, text="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø©", bg=BG_MAIN_COLOR).pack(anchor='e')
Â  Â  Â  Â  self.h_text = tk.Entry(r_frame, font=FONT_MAIN)
Â  Â  Â  Â  self.h_text.insert(0, self.settings['receipt_design']['header_text'])
Â  Â  Â  Â  self.h_text.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(r_frame, text="ØªØ°ÙŠÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", bg=BG_MAIN_COLOR).pack(anchor='e')
Â  Â  Â  Â  self.f_text = tk.Entry(r_frame, font=FONT_MAIN)
Â  Â  Â  Â  self.f_text.insert(0, self.settings['receipt_design']['footer_text'])
Â  Â  Â  Â  self.f_text.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(r_frame, text="Ø§Ø®ØªÙŠØ§Ø± Ø´Ø¹Ø§Ø±", command=self.choose_logo, bg=SECONDARY_COLOR, fg="white").pack(pady=0)
Â  Â  Â  Â  self.s_logo_lbl = tk.Label(r_frame, text=self.settings['logo_path'], bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.s_logo_lbl.pack()
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(r_frame, text="Ø­ÙØ¸ Ø§Ù„ØªØµÙ…ÙŠÙ… ğŸ’¾", command=self.save_design, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD).pack(pady=0)

Â  Â  def save_printers(self):
Â  Â  Â  Â  idxs = self.printer_list.curselection()
Â  Â  Â  Â  if not idxs:
Â  Â  Â  Â  Â  Â  messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ø¨Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â Â 
Â  Â  Â  Â  selected_printers = [self.printer_list.get(i) for i in idxs]
Â  Â  Â  Â  self.settings['printers'] = selected_printers
Â  Â  Â  Â  self.save_settings()
Â  Â  Â  Â Â 
Â  Â  Â  Â  printers_str = "\n".join(selected_printers)
Â  Â  Â  Â  messagebox.showinfo("ØªÙ…", f"ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:\n{printers_str}")

Â  Â  def choose_logo(self):
Â  Â  Â  Â  p = filedialog.askopenfilename()
Â  Â  Â  Â  if p: self.settings['logo_path'] = p; self.s_logo_lbl.config(text=p)
Â  Â  def save_design(self):
Â  Â  Â  Â  self.settings['receipt_design']['header_text'] = self.h_text.get(); self.settings['receipt_design']['footer_text'] = self.f_text.get(); self.save_settings(); messagebox.showinfo("ØªÙ…", "Ø­ÙØ¸ Ø§Ù„ØªØµÙ…ÙŠÙ…")

def start_app():
Â  Â  root = tk.Tk(); app = RestaurantPOS(root); root.mainloop()
Â  Â Â 
if __name__ == "__main__":
Â  Â  l_root = tk.Tk(); LoginWindow(l_root, start_app); l_root.mainloop()  Ø§Ø±ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ø¶Ø§ÙØ©  Ø§ÙƒØ«Ø± Ù…Ù† ÙˆØ¬Ø¨Ø© ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù…ÙƒØ§Ù†ÙŠØ© Ø±ÙØ¹ Ù…Ù† Ø®Ù„Ø§Ù„ Ù„Ù…Ø³ Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø¨Ù‚ÙŠØ© ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø±ÙŠØ¯ ØªÙ†Ø¶Ù Ø§Ù„Ø¹Ø§Ù†ÙˆÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ø±ÙŠØ¯ ØªØ¶ÙŠÙ Ø§Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¬Ø¨Ø© ÙˆØ§Ù…ÙƒØ§Ù†ÙŠØ© ÙƒØªØ§Ø¨Ø© ØµÙ†Ù Ø§Ù„ÙˆØ¬Ø¨Ø© ÙˆÙŠØ¶Ù‡Ø± ÙÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ ÙˆØµÙ†Ù Ø§Ù„ÙƒÙ„ ÙŠØ¬Ù…Ø¹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§ØµÙ†Ø§Ù Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„
