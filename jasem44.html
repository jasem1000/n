import tkinter as tk
from tkinter import ttk, messagebox, filedialog, simpledialog
import sqlite3
import datetime
import io
import os
import json
import time
# --- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„ØµÙˆØ± ---
from PIL import Image, ImageTk, ImageDraw, ImageFont, ImageWin
import win32print
import win32ui
import win32con
# --- Ù…ÙƒØªØ¨Ø§Øª Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ---
try:
Â  Â  import arabic_reshaper
Â  Â  from bidi.algorithm import get_display
except ImportError:
Â  Â  print("ÙŠØ±Ø¬Ù‰ ØªØ«Ø¨ÙŠØª Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: pip install arabic-reshaper python-bidi")
Â  Â  def get_display(text): return text
Â  Â  class arabic_reshaper:
Â  Â  Â  Â  @staticmethod
Â  Â  Â  Â  def reshape(text): return text
# --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… ---
BG_MAIN_COLOR = "#F4F7F6"
PANEL_COLOR = "#3F6287"
PRIMARY_COLOR = "#007AFF"
SECONDARY_COLOR = "#00AEFF"
ACCENT_COLOR = "#0DAAFF"
SUCCESS_COLOR = "#28a745"
DANGER_COLOR = "#dc3545"
TEXT_COLOR = "#0099FF"
TEXT_SECONDARY = "#6c757d"
CARD_COLORS = {
Â  Â  "Ø£Ø¨ÙŠØ¶ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)": "#FFFFFF",
Â  Â  "Ø£Ø­Ù…Ø± ÙØ§ØªØ­": "#FFEBEE",
Â  Â  "Ø£Ø®Ø¶Ø± ÙØ§ØªØ­": "#E8F5E9",
Â  Â  "Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­": "#E3F2FD",
Â  Â  "Ø£ØµÙØ± ÙØ§ØªØ­": "#FFFDE7",
Â  Â  "Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ ÙØ§ØªØ­": "#FFF3E0",
Â  Â  "Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­": "#F5F5F5"
}
FONT_MAIN = ("Segoe UI", 12)
FONT_BOLD = ("Segoe UI", 12, "bold")
FONT_HEADER = ("Segoe UI", 20, "bold")
FONT_TITLE = ("Segoe UI", 14, "bold")

class CustomInputDialog:
Â  Â  """Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ù…Ø¹ Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­ (Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø±Ù‚Ù…ÙŠØ©)"""
Â  Â  def __init__(self, parent, title, prompt, initial_value="", input_type="text"):
Â  Â  Â  Â  self.result = None
Â  Â  Â  Â  self.window = tk.Toplevel(parent)
Â  Â  Â  Â  self.window.title(title)
Â  Â  Â  Â  self.window.geometry("600x450")
Â  Â  Â  Â  self.window.configure(bg="#FFFFFF")
Â  Â  Â  Â  self.window.resizable(False, False)
Â  Â  Â  Â  self.window.transient(parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â Â 
Â  Â  Â  Â  x = parent.winfo_rootx() + (parent.winfo_width() // 2) - 300
Â  Â  Â  Â  y = parent.winfo_rooty() + (parent.winfo_height() // 2) - 225
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â Â 
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg=PANEL_COLOR, padx=20, pady=20, relief='raised', bd=1)
Â  Â  Â  Â  main_frame.pack(expand=True, fill='both', padx=10, pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(main_frame, text=prompt, font=FONT_BOLD, bg=PANEL_COLOR, fg="white").pack(pady=(0, 10))
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.input_var = tk.StringVar(value=initial_value)
Â  Â  Â  Â  self.entry = tk.Entry(main_frame, textvariable=self.input_var, font=("Segoe UI", 16), bg="#F9F9F9", justify='center')
Â  Â  Â  Â  self.entry.pack(fill='x', pady=5, ipady=10)
Â  Â  Â  Â  self.entry.focus_set()
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  keypad_frame.pack(fill='both', expand=True, pady=10)

Â  Â  Â  Â  if input_type == "arabic":
Â  Â  Â  Â  Â  Â  self.build_arabic_keypad(keypad_frame)
Â  Â  Â  Â  elif input_type == "numeric":
Â  Â  Â  Â  Â  Â  self.build_numeric_keypad(keypad_frame)
Â  Â  Â  Â  elif input_type == "time":
Â  Â  Â  Â  Â  Â  self.build_time_keypad(keypad_frame)
Â  Â  Â  Â Â 
Â  Â  Â  Â  btn_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  btn_frame.pack(fill='x', pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡ âŒ", command=self.window.destroy, bg=DANGER_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=10).pack(side='left', padx=5)
Â  Â  Â  Â  tk.Button(btn_frame, text="ØªØ£ÙƒÙŠØ¯ âœ…", command=self.confirm, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=15).pack(side='right', padx=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.window.wait_window()
Â  Â  Â  Â Â 
Â  Â  def build_arabic_keypad(self, parent):
Â  Â  Â  Â  keys = [
Â  Â  Â  Â  Â  Â  ('Ø¶', 'Øµ', 'Ø«', 'Ù‚', 'Ù', 'Øº', 'Ø¹', 'Ù‡', 'Ø®', 'Ø­', 'Ø¬', 'Ø¯'),
Â  Â  Â  Â  Â  Â  ('Ø´', 'Ø³', 'ÙŠ', 'Ø¨', 'Ù„', 'Ø£', 'Øª', 'Ù†', 'Ù…', 'Ùƒ', 'Ø·'),
Â  Â  Â  Â  Â  Â  ('Ø°', 'Ø¡', 'Ø¤', 'Ø±', 'Ù„Ø§', 'Ù‰', 'Ø©', 'Ùˆ', 'Ø²', 'Ø¸'),
Â  Â  Â  Â  Â  Â  (' ', 'Back', 'Clear') # Ù…Ø³Ø§ÙØ© ÙˆØ­Ø°Ù ÙˆÙ…Ø³Ø­
Â  Â  Â  Â  ]
Â  Â  Â  Â Â 
Â  Â  Â  Â  for r, row_keys in enumerate(keys):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x', expand=True)
Â  Â  Â  Â  Â  Â  for key in row_keys:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=key: self.key_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = "#E3F2FD" if len(key) == 1 or key == 'Ù„Ø§' else PRIMARY_COLOR if key != 'Clear' else DANGER_COLOR
Â  Â  Â  Â  Â  Â  Â  Â  fg_color = "#1565C0" if len(key) == 1 or key == 'Ù„Ø§' else "white"
Â  Â  Â  Â  Â  Â  Â  Â  font = ("Segoe UI", 12) if len(key) == 1 or key == 'Ù„Ø§' else FONT_BOLD

Â  Â  Â  Â  Â  Â  Â  Â  btn = tk.Button(row_frame, text=get_display(arabic_reshaper.reshape(key)), command=cmd,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font=font, bg=btn_color, fg=fg_color, relief='flat', padx=5, pady=5)
Â  Â  Â  Â  Â  Â  Â  Â  btn.pack(side='right', padx=2, pady=2, fill='x', expand=True)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  def build_numeric_keypad(self, parent):
Â  Â  Â  Â  keys = [
Â  Â  Â  Â  Â  Â  ('1', '2', '3'),
Â  Â  Â  Â  Â  Â  ('4', '5', '6'),
Â  Â  Â  Â  Â  Â  ('7', '8', '9'),
Â  Â  Â  Â  Â  Â  ('Clear', '0', 'Back')
Â  Â  Â  Â  ]
Â  Â  Â  Â  for r, row_keys in enumerate(keys):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x', expand=True)
Â  Â  Â  Â  Â  Â  for key in row_keys:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=key: self.key_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = DANGER_COLOR if key == 'Clear' else PRIMARY_COLOR if key != 'Back' else "#E67E22"
Â  Â  Â  Â  Â  Â  Â  Â  btn = tk.Button(row_frame, text=key, command=cmd,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 18, "bold"), bg=btn_color, fg="white", relief='flat', padx=5, pady=5)
Â  Â  Â  Â  Â  Â  Â  Â  btn.pack(side='right', padx=2, pady=2, fill='x', expand=True)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  def build_time_keypad(self, parent):
Â  Â  Â  Â  # Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­ Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª: HH:MM AM/PM
Â  Â  Â  Â  keys_digits = [
Â  Â  Â  Â  Â  Â  ('1', '2', '3'),
Â  Â  Â  Â  Â  Â  ('4', '5', '6'),
Â  Â  Â  Â  Â  Â  ('7', '8', '9'),
Â  Â  Â  Â  Â  Â  ('AM', '0', 'PM')
Â  Â  Â  Â  ]
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø¥Ø·Ø§Ø± Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
Â  Â  Â  Â  digits_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  digits_frame.pack(side='right', fill='both', expand=True, padx=10)

Â  Â  Â  Â  for r, row_keys in enumerate(keys_digits):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(digits_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x', expand=True)
Â  Â  Â  Â  Â  Â  for key in row_keys:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=key: self.time_key_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = PRIMARY_COLOR if key.isdigit() else SECONDARY_COLOR
Â  Â  Â  Â  Â  Â  Â  Â  btn = tk.Button(row_frame, text=key, command=cmd,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 18, "bold"), bg=btn_color, fg="white", relief='flat', padx=5, pady=5)
Â  Â  Â  Â  Â  Â  Â  Â  btn.pack(side='right', padx=2, pady=2, fill='x', expand=True)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø¥Ø·Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
Â  Â  Â  Â  control_frame = tk.Frame(parent, bg=PANEL_COLOR)
Â  Â  Â  Â  control_frame.pack(side='left', fill='y', padx=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(control_frame, text="Ø­Ø°Ù", command=lambda: self.time_key_press('Back'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 18, "bold"), bg="#E67E22", fg="white", relief='flat', width=6, height=2).pack(pady=5, fill='x')
Â  Â  Â  Â  tk.Button(control_frame, text="Ù…Ø³Ø­", command=lambda: self.time_key_press('Clear'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 18, "bold"), bg=DANGER_COLOR, fg="white", relief='flat', width=6, height=2).pack(pady=5, fill='x')
Â  Â  Â  Â  tk.Button(control_frame, text=": ÙØ§ØµÙ„", command=lambda: self.time_key_press(':'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 18, "bold"), bg="#5D6D7E", fg="white", relief='flat', width=6, height=2).pack(pady=5, fill='x')
Â  Â  Â  Â Â 
Â  Â  def key_press(self, key):
Â  Â  Â  Â  current = self.input_var.get()
Â  Â  Â  Â  if key == 'Clear':
Â  Â  Â  Â  Â  Â  self.input_var.set("")
Â  Â  Â  Â  elif key == 'Back':
Â  Â  Â  Â  Â  Â  self.input_var.set(current[:-1])
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.input_var.set(current + key)
Â  Â  Â  Â  self.entry.icursor(tk.END)
Â  Â  Â  Â Â 
Â  Â  def time_key_press(self, key):
Â  Â  Â  Â  current = self.input_var.get()
Â  Â  Â  Â  if key == 'Clear':
Â  Â  Â  Â  Â  Â  self.input_var.set("")
Â  Â  Â  Â  elif key == 'Back':
Â  Â  Â  Â  Â  Â  # Ø­Ø°Ù Ø­Ø±Ù Ø£Ùˆ AM/PM
Â  Â  Â  Â  Â  Â  if current.endswith(" AM") or current.endswith(" PM"):
Â  Â  Â  Â  Â  Â  Â  Â  self.input_var.set(current[:-3])
Â  Â  Â  Â  Â  Â  elif current:
Â  Â  Â  Â  Â  Â  Â  Â  self.input_var.set(current[:-1])
Â  Â  Â  Â  elif key.isdigit():
Â  Â  Â  Â  Â  Â  self.input_var.set(current + key)
Â  Â  Â  Â  elif key == ':':
Â  Â  Â  Â  Â  Â  # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ÙØ§ØµÙ„ØªÙŠÙ† Ù…ØªØªØ§Ù„ÙŠØªÙŠÙ† Ø£Ùˆ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
Â  Â  Â  Â  Â  Â  if not current.endswith(':') and current.strip():
Â  Â  Â  Â  Â  Â  Â  Â  Â self.input_var.set(current + key)
Â  Â  Â  Â  elif key in ['AM', 'PM']:
Â  Â  Â  Â  Â  Â  # Ø¥Ø¶Ø§ÙØ© AM/PMØŒ ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯
Â  Â  Â  Â  Â  Â  if " AM" in current:
Â  Â  Â  Â  Â  Â  Â  Â  self.input_var.set(current.replace(" AM", f" {key}"))
Â  Â  Â  Â  Â  Â  elif " PM" in current:
Â  Â  Â  Â  Â  Â  Â  Â  self.input_var.set(current.replace(" PM", f" {key}"))
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â self.input_var.set(current + f" {key}")
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.entry.icursor(tk.END)
Â  Â  Â  Â Â 
Â  Â  def confirm(self):
Â  Â  Â  Â  self.result = self.input_var.get()
Â  Â  Â  Â  self.window.destroy()

class NoteDialog:
Â  Â  """Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø¹ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª (Ø¨Ø§Ù‚ÙŠ ÙƒÙ…Ø§ Ù‡ÙŠ)"""
Â  Â  # ... (Ù…Ø­ØªÙˆÙŠØ§Øª NoteDialog)
Â  Â  def __init__(self, parent, title, prompt, initial_value="", suggestions_str=""):
Â  Â  Â  Â  self.result = None
Â  Â  Â  Â  self.window = tk.Toplevel(parent)
Â  Â  Â  Â  self.window.title(title)
Â  Â  Â  Â  self.window.geometry("500x350")
Â  Â  Â  Â  self.window.configure(bg="#FFFFFF")
Â  Â  Â  Â  self.window.resizable(False, False)
Â  Â  Â  Â  self.window.transient(parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â Â 
Â  Â  Â  Â  x = parent.winfo_rootx() + (parent.winfo_width() // 2) - 250
Â  Â  Â  Â  y = parent.winfo_rooty() + (parent.winfo_height() // 2) - 175
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â Â 
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg=PANEL_COLOR, padx=20, pady=20, relief='raised', bd=1)
Â  Â  Â  Â  main_frame.pack(expand=True, fill='both', padx=10, pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(main_frame, text=prompt, font=FONT_BOLD, bg=PANEL_COLOR, fg="white").pack(pady=(0, 10))
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.note_var = tk.StringVar(value=initial_value)
Â  Â  Â  Â  self.entry = tk.Entry(main_frame, textvariable=self.note_var, font=("Segoe UI", 14), bg="#F9F9F9", justify='center')
Â  Â  Â  Â  self.entry.pack(fill='x', pady=5, ipady=5)
Â  Â  Â  Â  self.entry.focus_set()
Â  Â  Â  Â  self.entry.bind('<Return>', lambda e: self.confirm())
Â  Â  Â  Â Â 
Â  Â  Â  Â  if suggestions_str:
Â  Â  Â  Â  Â  Â  suggestions_frame = tk.LabelFrame(main_frame, text="Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø³Ø±ÙŠØ¹Ø©", bg=PANEL_COLOR, fg="white", font=("Segoe UI", 10))
Â  Â  Â  Â  Â  Â  suggestions_frame.pack(fill='x', pady=10)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  sug_list = [s.strip() for s in suggestions_str.split(',') if s.strip()]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  grid_frame = tk.Frame(suggestions_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  grid_frame.pack(fill='both', padx=5, pady=5)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  r, c = 0, 0
Â  Â  Â  Â  Â  Â  for sug in sug_list:
Â  Â  Â  Â  Â  Â  Â  Â  btn = tk.Button(grid_frame, text=sug, font=("Segoe UI", 9),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bg="#E3F2FD", fg="#1565C0", relief='flat',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  command=lambda s=sug: self.add_suggestion(s))
Â  Â  Â  Â  Â  Â  Â  Â  btn.grid(row=r, column=c, padx=2, pady=2, sticky='ew')
Â  Â  Â  Â  Â  Â  Â  Â  c += 1
Â  Â  Â  Â  Â  Â  Â  Â  if c > 2:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  c = 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  r += 1
Â  Â  Â  Â  Â  Â  for i in range(3): grid_frame.columnconfigure(i, weight=1)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  btn_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  btn_frame.pack(fill='x', pady=20)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø¥Ù„ØºØ§Ø¡ âŒ", command=self.window.destroy, bg=DANGER_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=10).pack(side='left', padx=5)
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© âœ…", command=self.confirm, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD, relief='flat', width=15).pack(side='right', padx=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.window.wait_window()
Â  Â  Â  Â Â 
Â  Â  def add_suggestion(self, text):
Â  Â  Â  Â  current = self.note_var.get()
Â  Â  Â  Â  if current:
Â  Â  Â  Â  Â  Â  self.note_var.set(current + "ØŒ " + text)
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.note_var.set(text)
Â  Â  Â  Â  self.entry.focus_set()
Â  Â  Â  Â  self.entry.icursor(tk.END)
Â  Â  Â  Â Â 
Â  Â  def confirm(self):
Â  Â  Â  Â  self.result = self.note_var.get()
Â  Â  Â  Â  self.window.destroy()

class PhoneKeypad:
Â  Â  """Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¨Ø§Ù‚ÙŠ ÙƒÙ…Ø§ Ù‡ÙŠ)"""
Â  Â  # ... (Ù…Ø­ØªÙˆÙŠØ§Øª PhoneKeypad)
Â  Â  def __init__(self, parent, callback, initial_value=""):
Â  Â  Â  Â  self.parent = parent
Â  Â  Â  Â  self.callback = callback
Â  Â  Â  Â  self.value = tk.StringVar(value=initial_value)
Â  Â  Â  Â  self.setup_ui()
Â  Â  Â  Â Â 
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.window = tk.Toplevel(self.parent)
Â  Â  Â  Â  self.window.title("Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ")
Â  Â  Â  Â  self.window.geometry("350x500")
Â  Â  Â  Â  self.window.configure(bg="#2C3E50")
Â  Â  Â  Â  self.window.transient(self.parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â Â 
Â  Â  Â  Â  x = self.parent.winfo_rootx() + (self.parent.winfo_width() // 2) - 175
Â  Â  Â  Â  y = self.parent.winfo_rooty() + (self.parent.winfo_height() // 2) - 250
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â Â 
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg="#2C3E50", padx=10, pady=10)
Â  Â  Â  Â  main_frame.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  display_frame = tk.Frame(main_frame, bg="#ECF0F1", pady=10, padx=10, relief='sunken', bd=2)
Â  Â  Â  Â  display_frame.pack(fill='x', pady=(0, 15))
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.display = tk.Label(display_frame, textvariable=self.value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â font=("Consolas", 28, "bold"), bg="#ECF0F1",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â fg="#2C3E50", height=1, anchor='center')
Â  Â  Â  Â  self.display.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg="#2C3E50")
Â  Â  Â  Â  keypad_frame.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  buttons = [
Â  Â  Â  Â  Â  Â  ('1', '2', '3'),
Â  Â  Â  Â  Â  Â  ('4', '5', '6'),
Â  Â  Â  Â  Â  Â  ('7', '8', '9'),
Â  Â  Â  Â  Â  Â  ('C', '0', 'âŒ«')
Â  Â  Â  Â  ]
Â  Â  Â  Â Â 
Â  Â  Â  Â  for r, row_vals in enumerate(buttons):
Â  Â  Â  Â  Â  Â  for c, char in enumerate(row_vals):
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = "#34495E"
Â  Â  Â  Â  Â  Â  Â  Â  fg_color = "white"
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=char: self.button_click(k)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if char == 'C':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn_color = "#E74C3C"
Â  Â  Â  Â  Â  Â  Â  Â  elif char == 'âŒ«':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  btn_color = "#E67E22"
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  btn = tk.Button(keypad_frame, text=char, command=cmd,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 18, "bold"), bg=btn_color, fg=fg_color,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  relief='flat', activebackground="#95A5A6")
Â  Â  Â  Â  Â  Â  Â  Â  btn.grid(row=r, column=c, padx=3, pady=3, sticky="nsew")
Â  Â  Â  Â Â 
Â  Â  Â  Â  confirm_btn = tk.Button(main_frame, text="ØªØ£ÙƒÙŠÙ€Ù€Ø¯ âœ…", command=self.confirm,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bg="#27AE60", fg="white", font=("Segoe UI", 16, "bold"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height=1, relief='flat', cursor="hand2")
Â  Â  Â  Â  confirm_btn.pack(fill='x', pady=(10, 0))
Â  Â  Â  Â Â 
Â  Â  Â  Â  for i in range(3): keypad_frame.columnconfigure(i, weight=1)
Â  Â  Â  Â  for i in range(4): keypad_frame.rowconfigure(i, weight=1)
Â  Â Â 
Â  Â  def button_click(self, key):
Â  Â  Â  Â  current = self.value.get()
Â  Â  Â  Â  if key == 'C':
Â  Â  Â  Â  Â  Â  self.value.set("")
Â  Â  Â  Â  elif key == 'âŒ«':
Â  Â  Â  Â  Â  Â  self.value.set(current[:-1])
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  if len(current) < 11:
Â  Â  Â  Â  Â  Â  Â  Â  self.value.set(current + key)
Â  Â Â 
Â  Â  def confirm(self):
Â  Â  Â  Â  self.callback(self.value.get())
Â  Â  Â  Â  self.window.destroy()

class LoginWindow:
Â  Â  """Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Ù„ÙˆØ­Ø© Ù…ÙØ§ØªÙŠØ­ Ø±Ù‚Ù…ÙŠØ© Ù„Ù„Ø±Ù…Ø²"""
Â  Â  # ... (Ù…Ø­ØªÙˆÙŠØ§Øª LoginWindow)
Â  Â  def __init__(self, root, callback):
Â  Â  Â  Â  self.root = root
Â  Â  Â  Â  self.callback = callback
Â  Â  Â  Â  self.password_var = tk.StringVar()
Â  Â  Â  Â  self.setup_ui()
Â  Â  Â  Â Â 
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.root.title("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†")
Â  Â  Â  Â  self.root.geometry("450x600") # ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
Â  Â  Â  Â  self.root.configure(bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.root.resizable(False, False)
Â  Â  Â  Â Â 
Â  Â  Â  Â  screen_width = self.root.winfo_screenwidth()
Â  Â  Â  Â  screen_height = self.root.winfo_screenheight()
Â  Â  Â  Â  x = (screen_width/2) - (450/2)
Â  Â  Â  Â  y = (screen_height/2) - (600/2)
Â  Â  Â  Â  self.root.geometry('%dx%d+%d+%d' % (450, 600, x, y))
Â  Â  Â  Â Â 
Â  Â  Â  Â  main_frame = tk.Frame(self.root, bg=PANEL_COLOR, padx=30, pady=20, relief='raised', bd=1)
Â  Â  Â  Â  main_frame.place(relx=0.5, rely=0.5, anchor='center')
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(main_frame, text="ğŸ–", font=("Segoe UI", 40), bg=PANEL_COLOR).pack()
Â  Â  Â  Â  tk.Label(main_frame, text="Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†",
Â  Â  Â  Â  Â  Â  Â  Â  Â font=("Segoe UI", 18, "bold"), bg=PANEL_COLOR, fg="white").pack(pady=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(main_frame, text="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„:", font=("Segoe UI", 14), bg=PANEL_COLOR, fg="white").pack(pady=(10, 5))

Â  Â  Â  Â  # Ø­Ù‚Ù„ Ø¹Ø±Ø¶ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
Â  Â  Â  Â  self.password_display = tk.Label(main_frame, textvariable=self.password_var,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â font=("Arial", 24), bg="#F2F2F7", fg=PANEL_COLOR,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â width=15, anchor='center', relief='flat', bd=5)
Â  Â  Â  Â  self.password_display.pack(pady=5, ipady=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  keypad_frame.pack(pady=15, padx=10)

Â  Â  Â  Â  buttons = [
Â  Â  Â  Â  Â  Â  ('1', '2', '3'),
Â  Â  Â  Â  Â  Â  ('4', '5', '6'),
Â  Â  Â  Â  Â  Â  ('7', '8', '9'),
Â  Â  Â  Â  Â  Â  ('Ù…Ø³Ø­', '0', 'Ø­Ø°Ù')
Â  Â  Â  Â  ]
Â  Â  Â  Â Â 
Â  Â  Â  Â  for r, row_vals in enumerate(buttons):
Â  Â  Â  Â  Â  Â  row_frame = tk.Frame(keypad_frame, bg=PANEL_COLOR)
Â  Â  Â  Â  Â  Â  row_frame.pack(fill='x')
Â  Â  Â  Â  Â  Â  for c, char in enumerate(row_vals):
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda k=char: self.keypad_press(k)
Â  Â  Â  Â  Â  Â  Â  Â  btn_color = PRIMARY_COLOR if char.isdigit() else DANGER_COLOR if char == 'Ù…Ø³Ø­' else "#E67E22"
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  btn = tk.Button(row_frame, text=char, command=cmd,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 14, "bold"), bg=btn_color, fg="white",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  relief='flat', width=6, height=1)
Â  Â  Â  Â  Â  Â  Â  Â  btn.pack(side='right', padx=2, pady=2)

Â  Â  Â  Â  login_btn = tk.Button(main_frame, text="Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù… ğŸ”“", command=self.check_password,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bg="#FFFFFF", fg=PANEL_COLOR, font=FONT_BOLD,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  width=20, height=2, relief='flat', cursor="hand2")
Â  Â  Â  Â  login_btn.pack(pady=20)

Â  Â  def keypad_press(self, key):
Â  Â  Â  Â  current = self.password_var.get()
Â  Â  Â  Â  if key == 'Ù…Ø³Ø­':
Â  Â  Â  Â  Â  Â  self.password_var.set("")
Â  Â  Â  Â  elif key == 'Ø­Ø°Ù':
Â  Â  Â  Â  Â  Â  self.password_var.set(current[:-1])
Â  Â  Â  Â  elif key.isdigit() and len(current) < 10:
Â  Â  Â  Â  Â  Â  self.password_var.set(current + key)

Â  Â  def check_password(self):
Â  Â  Â  Â  if self.password_var.get() == "1":
Â  Â  Â  Â  Â  Â  self.root.destroy()
Â  Â  Â  Â  Â  Â  self.callback()
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!")

class NumericKeypad:
Â  Â  """Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù† (Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒØ³ÙˆØ±)"""
Â  Â  # ... (Ù…Ø­ØªÙˆÙŠØ§Øª NumericKeypad)
Â  Â  def __init__(self, parent, callback):
Â  Â  Â  Â  self.parent = parent
Â  Â  Â  Â  self.callback = callback
Â  Â  Â  Â  self.value = tk.StringVar(value="0")
Â  Â  Â  Â  self.setup_ui()
Â  Â  Â  Â Â 
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.window = tk.Toplevel(self.parent)
Â  Â  Â  Â  self.window.title("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆØ²Ù† (ÙƒØºÙ…)")
Â  Â  Â  Â  self.window.geometry("400x650") # ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ ØµÙ Ø¥Ø¶Ø§ÙÙŠ
Â  Â  Â  Â  self.window.configure(bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.window.transient(self.parent)
Â  Â  Â  Â  self.window.grab_set()
Â  Â  Â  Â Â 
Â  Â  Â  Â  x = self.parent.winfo_x() + (self.parent.winfo_width() // 2) - 200
Â  Â  Â  Â  y = self.parent.winfo_y() + (self.parent.winfo_height() // 2) - 325
Â  Â  Â  Â  self.window.geometry(f"+{x}+{y}")
Â  Â  Â  Â Â 
Â  Â  Â  Â  main_frame = tk.Frame(self.window, bg=BG_MAIN_COLOR, padx=15, pady=15)
Â  Â  Â  Â  main_frame.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.display = tk.Label(main_frame, textvariable=self.value,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â font=("Consolas", 40, "bold"), bg="white",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â fg=TEXT_COLOR, height=2, anchor='e', padx=10)
Â  Â  Â  Â  self.display.pack(fill='x', pady=(0, 15))
Â  Â  Â  Â Â 
Â  Â  Â  Â  keypad_frame = tk.Frame(main_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  keypad_frame.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø£Ø²Ø±Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
Â  Â  Â  Â  buttons = [
Â  Â  Â  Â  Â  Â  ('7', '8', '9'),
Â  Â  Â  Â  Â  Â  ('4', '5', '6'),
Â  Â  Â  Â  Â  Â  ('1', '2', '3'),
Â  Â  Â  Â  Â  Â  ('0', '.', 'C')
Â  Â  Â  Â  ]
Â  Â  Â  Â Â 
Â  Â  Â  Â  row, col = 0, 0
Â  Â  Â  Â  for button in buttons:
Â  Â  Â  Â  Â  Â  for b in button:
Â  Â  Â  Â  Â  Â  Â  Â  cmd = lambda x=b: self.button_click(x)
Â  Â  Â  Â  Â  Â  Â  Â  color = "#FFCDD2" if b == 'C' else PANEL_COLOR
Â  Â  Â  Â  Â  Â  Â  Â  fg_col = DANGER_COLOR if b == 'C' else "white"
Â  Â  Â  Â  Â  Â  Â  Â  btn = tk.Button(keypad_frame, text=b, command=cmd,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 22, "bold"), bg=color, fg=fg_col, relief='flat')
Â  Â  Â  Â  Â  Â  Â  Â  btn.grid(row=row, column=col, padx=4, pady=4, sticky="nsew")
Â  Â  Â  Â  Â  Â  Â  Â  col += 1
Â  Â  Â  Â  Â  Â  col = 0
Â  Â  Â  Â  Â  Â  row += 1

Â  Â  Â  Â  # ØµÙ Ø§Ù„ÙƒØ³ÙˆØ±
Â  Â  Â  Â  frac_frame = tk.Frame(keypad_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  frac_frame.grid(row=row, column=0, columnspan=3, sticky='ew', pady=(5,0))
Â  Â  Â  Â Â 
Â  Â  Â  Â  fractions = [("1/4", 0.25), ("1/2", 0.5), ("3/4", 0.75)]
Â  Â  Â  Â  for txt, val in fractions:
Â  Â  Â  Â  Â  Â  cmd = lambda v=val: self.fraction_click(v)
Â  Â  Â  Â  Â  Â  btn = tk.Button(frac_frame, text=txt, command=cmd,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font=("Segoe UI", 18, "bold"), bg=SECONDARY_COLOR, fg="white", relief='flat')
Â  Â  Â  Â  Â  Â  btn.pack(side='right', fill='x', expand=True, padx=4, pady=4)

Â  Â  Â  Â  row += 1
Â  Â  Â  Â Â 
Â  Â  Â  Â  confirm_btn = tk.Button(main_frame, text="ØªØ£ÙƒÙŠÙ€Ù€Ø¯ Ø§Ù„Ù€ÙˆØ²Ù† âœ…", command=self.confirm,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bg="#00C853", fg="white", font=("Segoe UI", 18, "bold"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  height=2, relief='raised', bd=3, cursor="hand2")
Â  Â  Â  Â  confirm_btn.pack(fill='x', pady=(15, 5))
Â  Â  Â  Â Â 
Â  Â  Â  Â  for i in range(3): keypad_frame.columnconfigure(i, weight=1)
Â  Â  Â  Â  for i in range(row): keypad_frame.rowconfigure(i, weight=1)
Â  Â Â 
Â  Â  def button_click(self, key):
Â  Â  Â  Â  if key == 'C': self.value.set("0")
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  current = self.value.get()
Â  Â  Â  Â  Â  Â  if current == "0" and key != '.': self.value.set(key)
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  if key == '.' and '.' in current: return
Â  Â  Â  Â  Â  Â  Â  Â  self.value.set(current + key)

Â  Â  def fraction_click(self, val):
Â  Â  Â  Â  current = self.value.get()
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  current_val = float(current)
Â  Â  Â  Â  Â  Â  self.value.set(f"{current_val + val:.3f}") # 3 Ø®Ø§Ù†Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© 0.25
Â  Â  Â  Â  except ValueError:
Â  Â  Â  Â  Â  Â  self.value.set(f"{val:.3f}")
Â  Â Â 
Â  Â  def confirm(self):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  weight = float(self.value.get())
Â  Â  Â  Â  Â  Â  if weight > 0:
Â  Â  Â  Â  Â  Â  Â  Â  self.callback(weight)
Â  Â  Â  Â  Â  Â  Â  Â  self.window.destroy()
Â  Â  Â  Â  except ValueError: pass

# ØªÙ… Ø­Ø°Ù DateTimePicker ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„ ÙˆØ¸ÙŠÙØªÙ‡ Ø¨Ù€ CustomInputDialog Ù…Ø¹ Ù†Ù…Ø· "time"
# class DateTimePicker(simpledialog.Dialog): ...

class RestaurantPOS:
Â  Â  def __init__(self, root):
Â  Â  Â  Â  self.root = root
Â  Â  Â  Â  self.root.title("Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†")
Â  Â  Â  Â  self.root.state('zoomed')
Â  Â  Â  Â  self.root.configure(bg=BG_MAIN_COLOR)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.setup_styles()
Â  Â  Â  Â  self.cart = []
Â  Â  Â  Â  self.db_name = "restaurant.db"
Â  Â  Â  Â  self.settings_file = "settings.json"
Â  Â  Â  Â  self.load_settings()
Â  Â  Â  Â  self.init_db()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.order_type = tk.StringVar(value="takeaway")
Â  Â  Â  Â  self.phone_var = tk.StringVar()
Â  Â  Â  Â  self.customer_name_var = tk.StringVar()
Â  Â  Â  Â  self.address_var = tk.StringVar()
Â  Â  Â  Â  self.pickup_time_var = tk.StringVar(value=datetime.datetime.now().strftime("%I:%M %p")) # ÙˆÙ‚Øª Ø§ÙØªØ±Ø§Ø¶ÙŠ
Â  Â  Â  Â  self.payment_status_var = tk.StringVar(value="paid")
Â  Â  Â  Â  self.search_var = tk.StringVar()
Â  Â  Â  Â  self.general_notes_var = tk.StringVar()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.phone_var.trace("w", self.on_phone_change)
Â  Â  Â  Â  self.search_var.trace("w", self.on_search_change)
Â  Â  Â  Â  self.order_type.trace("w", lambda *args: self.toggle_fields())
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.setup_ui()

Â  Â  def setup_styles(self):
Â  Â  Â  Â  style = ttk.Style()
Â  Â  Â  Â  style.theme_use('clam')
Â  Â  Â  Â  style.configure("TNotebook", background=BG_MAIN_COLOR, borderwidth=0)
Â  Â  Â  Â  style.configure("TNotebook.Tab", font=("Segoe UI", 12), padding=[15, 8])
Â  Â  Â  Â  style.configure("Treeview", font=("Segoe UI", 11), rowheight=35)
Â  Â  Â  Â  style.configure("Treeview.Heading", font=("Segoe UI", 11, "bold"), background=SECONDARY_COLOR, foreground="white")
Â  Â Â 
Â  Â  def load_settings(self):
Â  Â  Â  Â  default_settings = {
Â  Â  Â  Â  Â  Â  "printers": ["Default Printer"],
Â  Â  Â  Â  Â  Â  "logo_path": "",
Â  Â  Â  Â  Â  Â  "receipt_design": {"header_text": "Ù‚ØµØ§Ø¨Ø© ÙˆÙ…Ø´ÙˆÙŠØ§Øª Ø§Ù„Ø­Ø³Ù†", "show_logo": True, "footer_text": "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ…"},
Â  Â  Â  Â  Â  Â  "last_closing_date": "" # Ø³Ø¬Ù„ Ø¢Ø®Ø± ØªØ§Ø±ÙŠØ® ØªÙ… ÙÙŠÙ‡ Ø§Ù„Ø¬Ø±Ø¯
Â  Â  Â  Â  }
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  with open(self.settings_file, 'r', encoding='utf-8') as f: self.settings = json.load(f)
Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  self.settings = default_settings
Â  Â  Â  Â  Â  Â Â 
Â  Â  def save_settings(self):
Â  Â  Â  Â  with open(self.settings_file, 'w', encoding='utf-8') as f: json.dump(self.settings, f, ensure_ascii=False, indent=4)
Â  Â  Â  Â Â 
Â  Â  def init_db(self):
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS products (
Â  Â  Â  Â  Â  Â  id INTEGER PRIMARY KEY,
Â  Â  Â  Â  Â  Â  name TEXT,
Â  Â  Â  Â  Â  Â  price REAL,
Â  Â  Â  Â  Â  Â  image BLOB,
Â  Â  Â  Â  Â  Â  category TEXT,
Â  Â  Â  Â  Â  Â  weight_based INTEGER DEFAULT 0,
Â  Â  Â  Â  Â  Â  card_color TEXT DEFAULT '#FFFFFF',
Â  Â  Â  Â  Â  Â  suggestions TEXT DEFAULT ''
Â  Â  Â  Â  )''')
Â  Â  Â  Â Â 
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  c.execute("ALTER TABLE products ADD COLUMN card_color TEXT DEFAULT '#FFFFFF'")
Â  Â  Â  Â  except: pass
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  c.execute("ALTER TABLE products ADD COLUMN suggestions TEXT DEFAULT ''")
Â  Â  Â  Â  except: pass
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS customers (phone TEXT PRIMARY KEY, name TEXT, address TEXT, last_order_date TEXT)''')
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS orders (id INTEGER PRIMARY KEY, date TEXT, customer_name TEXT, phone TEXT, type TEXT, details TEXT, total REAL, notes TEXT, status TEXT, pickup_time TEXT, address TEXT, payment_status TEXT)''')
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS sales (id INTEGER PRIMARY KEY, date TEXT, order_id INTEGER, amount REAL, type TEXT)''')
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS order_items (
Â  Â  Â  Â  Â  Â  id INTEGER PRIMARY KEY,
Â  Â  Â  Â  Â  Â  order_id INTEGER,
Â  Â  Â  Â  Â  Â  product_name TEXT,
Â  Â  Â  Â  Â  Â  qty REAL,
Â  Â  Â  Â  Â  Â  price REAL,
Â  Â  Â  Â  Â  Â  total REAL,
Â  Â  Â  Â  Â  Â  note TEXT DEFAULT '',
Â  Â  Â  Â  Â  Â  FOREIGN KEY(order_id) REFERENCES orders(id)
Â  Â  Â  Â  )''')
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  c.execute("ALTER TABLE order_items ADD COLUMN note TEXT DEFAULT ''")
Â  Â  Â  Â  except: pass
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute('''CREATE TABLE IF NOT EXISTS daily_closings (date TEXT PRIMARY KEY, total_sales REAL, total_orders INTEGER)''')

Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  def setup_ui(self):
Â  Â  Â  Â  self.notebook = ttk.Notebook(self.root)
Â  Â  Â  Â  self.notebook.pack(fill='both', expand=True, padx=5, pady=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.pos_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.pos_frame, text=" ğŸ›’ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ ")
Â  Â  Â  Â  self.build_pos_tab()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.products_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.products_frame, text=" ğŸ¥© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ")
Â  Â  Â  Â  self.build_products_tab()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.reports_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.reports_frame, text=" ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ")
Â  Â  Â  Â  self.build_reports_tab()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.settings_frame = ttk.Frame(self.notebook)
Â  Â  Â  Â  self.notebook.add(self.settings_frame, text=" âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ")
Â  Â  Â  Â  self.build_settings_tab()
Â  Â  Â  Â Â 
Â  Â  def build_pos_tab(self):
Â  Â  Â  Â  top_control_frame = tk.Frame(self.pos_frame, bg=BG_MAIN_COLOR, pady=5)
Â  Â  Â  Â  top_control_frame.pack(side='top', fill='x')
Â  Â  Â  Â  style_toggle = {"font": ("Segoe UI", 12, "bold"), "indicatoron": 0, "width": 15, "relief": "flat", "bd": 0, "selectcolor": PRIMARY_COLOR, "fg": "#333"}
Â  Â  Â  Â Â 
Â  Â  Â  Â  center_toggle = tk.Frame(top_control_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  center_toggle.pack(anchor='center')
Â  Â  Â  Â  rb_takeaway = tk.Radiobutton(center_toggle, text="ğŸ›ï¸ Ø³ÙØ±ÙŠ (Ø§Ø³ØªÙ„Ø§Ù…)", variable=self.order_type, value="takeaway", **style_toggle)
Â  Â  Â  Â  rb_takeaway.pack(side='left', padx=2)
Â  Â  Â  Â Â 
Â  Â  Â  Â  rb_delivery = tk.Radiobutton(center_toggle, text="ğŸ›µ ØªÙˆØµÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ", variable=self.order_type, value="delivery", **style_toggle)
Â  Â  Â  Â  rb_delivery.pack(side='left', padx=2)
Â  Â  Â  Â  # Ø´Ø±ÙŠØ· Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†
Â  Â  Â  Â  customer_bar = tk.Frame(self.pos_frame, bg="white", padx=10, pady=8, relief='raised', bd=1)
Â  Â  Â  Â  customer_bar.pack(side='top', fill='x', pady=(0, 5))
Â  Â  Â  Â Â 
Â  Â  Â  Â  right_frame = tk.Frame(customer_bar, bg="white")
Â  Â  Â  Â  right_frame.pack(side='right')
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(right_frame, text="ğŸ“±", font=("Segoe UI", 12), bg="white").pack(side='right', padx=(5,0))
Â  Â  Â  Â  self.phone_entry = tk.Entry(right_frame, textvariable=self.phone_var, font=("Segoe UI", 11, "bold"), width=15, bg="#F9F9F9", justify='center')
Â  Â  Â  Â  self.phone_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.phone_entry.bind("<Button-1>", self.open_phone_keypad)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(right_frame, text="ğŸ‘¤", font=("Segoe UI", 12), bg="white").pack(side='right', padx=(5,0))
Â  Â  Â  Â  self.cust_name_entry = tk.Entry(right_frame, textvariable=self.customer_name_var, font=("Segoe UI", 11), width=20, bg="#F9F9F9", justify='right')
Â  Â  Â  Â  self.cust_name_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.cust_name_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.customer_name_var, "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†", "arabic"))
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.dynamic_fields_frame = tk.Frame(customer_bar, bg="white")
Â  Â  Â  Â  self.dynamic_fields_frame.pack(side='right', padx=20)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.addr_container = tk.Frame(self.dynamic_fields_frame, bg="white")
Â  Â  Â  Â  tk.Label(self.addr_container, text="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:", bg="white", font=("Segoe UI", 10, "bold")).pack(side='right')
Â  Â  Â  Â  self.addr_entry = tk.Entry(self.addr_container, textvariable=self.address_var, font=("Segoe UI", 10), width=25, bg="#F9F9F9")
Â  Â  Â  Â  self.addr_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.addr_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.address_var, "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†", "arabic"))

Â  Â  Â  Â Â 
Â  Â  Â  Â  self.time_container = tk.Frame(self.dynamic_fields_frame, bg="white")
Â  Â  Â  Â  self.lbl_time = tk.Label(self.time_container, text="ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:", bg="white", font=("Segoe UI", 10, "bold"))
Â  Â  Â  Â  self.lbl_time.pack(side='right')
Â  Â  Â  Â  self.time_entry = tk.Entry(self.time_container, textvariable=self.pickup_time_var, font=("Segoe UI", 10), width=15, bg="#F9F9F9")
Â  Â  Â  Â  self.time_entry.pack(side='right', padx=5)
Â  Â  Â  Â  self.time_entry.bind("<Button-1>", self.open_time_keypad) # ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§
Â  Â  Â  Â Â 
Â  Â  Â  Â  left_frame = tk.Frame(customer_bar, bg="white")
Â  Â  Â  Â  left_frame.pack(side='left')
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ø¹Ø¯ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
Â  Â  Â  Â  tk.Button(left_frame, text="Ø¥Ø±Ø¬Ø§Ø¹ ÙØ§ØªÙˆØ±Ø© â†©ï¸", command=lambda: self.retrieve_order_dialog(use_keypad=True),
Â  Â  Â  Â  Â  Â  Â  Â  Â  bg="#607D8B", fg="white", font=("Segoe UI", 9, "bold"), relief='flat').pack(side='left', padx=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(left_frame, text="Ø¥Ø¹Ø§Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø© ğŸ–¨ï¸", command=lambda: self.reprint_order_dialog(use_keypad=True),
Â  Â  Â  Â  Â  Â  Â  Â  Â  bg="#795548", fg="white", font=("Segoe UI", 9, "bold"), relief='flat').pack(side='left', padx=5)
Â  Â  Â  Â  # Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
Â  Â  Â  Â  paned = tk.PanedWindow(self.pos_frame, orient=tk.HORIZONTAL, bg=BG_MAIN_COLOR, sashwidth=6)
Â  Â  Â  Â  paned.pack(fill='both', expand=True, pady=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  # === Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ù„Ø³Ù„Ø© ===
Â  Â  Â  Â  left_cart_frame = tk.Frame(paned, bg=PANEL_COLOR, relief='sunken', bd=1)
Â  Â  Â  Â  paned.add(left_cart_frame, minsize=420, stretch="always")
Â  Â  Â  Â Â 
Â  Â  Â  Â  footer_frame = tk.Frame(left_cart_frame, bg="#F8F9FA")
Â  Â  Â  Â  footer_frame.pack(side='bottom', fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  action_btns = tk.Frame(footer_frame, bg="#F8F9FA", padx=2, pady=2)
Â  Â  Â  Â  action_btns.pack(side='bottom', fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  sub_btns = tk.Frame(action_btns, bg="#F8F9FA")
Â  Â  Â  Â  sub_btns.pack(fill='x', pady=(0, 2))
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(sub_btns, text="ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© â™»ï¸", command=self.clear_cart, bg=DANGER_COLOR, fg="white", font=("Segoe UI", 9), relief='flat', height=1).pack(side='left', fill='x', expand=True)
Â  Â  Â  Â  tk.Button(action_btns, text="Ø·Ø¨Ø§Ø¹Ø© ÙˆØ¥Ù†Ù‡Ø§Ø¡ ğŸ–¨ï¸", command=self.checkout, bg=SUCCESS_COLOR, fg="white", font=("Segoe UI", 11, "bold"), height=1, relief='flat').pack(fill='x', pady=1)
Â  Â  Â  Â Â 
Â  Â  Â  Â  total_frame = tk.Frame(footer_frame, bg="#343A40", pady=2)
Â  Â  Â  Â  total_frame.pack(side='bottom', fill='x')
Â  Â  Â  Â  self.lbl_total = tk.Label(total_frame, text="Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0 Ø¯.Ø¹", font=("Arial", 16, "bold"), bg="#343A40", fg=SUCCESS_COLOR)
Â  Â  Â  Â  self.lbl_total.pack()
Â  Â  Â  Â Â 
Â  Â  Â  Â  pay_opts = tk.Frame(footer_frame, bg="#F8F9FA", pady=2)
Â  Â  Â  Â  pay_opts.pack(side='bottom', fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.btn_paid = tk.Button(pay_opts, text="âœ… ÙˆØ§ØµÙ„", font=("Segoe UI", 10, "bold"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  relief='raised', bd=1, width=12, cursor="hand2",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  command=lambda: self.set_payment_status("paid"))
Â  Â  Â  Â  self.btn_paid.pack(side='right', padx=10, expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.btn_unpaid = tk.Button(pay_opts, text="â³ ØºÙŠØ± ÙˆØ§ØµÙ„", font=("Segoe UI", 10, "bold"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  relief='raised', bd=1, width=12, cursor="hand2",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  command=lambda: self.set_payment_status("unpaid"))
Â  Â  Â  Â  self.btn_unpaid.pack(side='left', padx=10, expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.set_payment_status("paid")
Â  Â  Â  Â Â 
Â  Â  Â  Â  general_note_frame = tk.Frame(footer_frame, bg="#F8F9FA", padx=5, pady=2)
Â  Â  Â  Â  general_note_frame.pack(side='bottom', fill='x')
Â  Â  Â  Â  self.general_note_entry = tk.Entry(general_note_frame, textvariable=self.general_notes_var, font=("Segoe UI", 10), bg="white", relief='solid', bd=1)
Â  Â  Â  Â  self.general_note_entry.pack(fill='x', ipady=2)
Â  Â  Â  Â  self.general_note_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.general_notes_var, "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©", "arabic"))
Â  Â  Â  Â  tk.Label(general_note_frame, text="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¹Ø§Ù…Ø©:", bg="#F8F9FA", font=("Segoe UI", 9, "bold"), fg=TEXT_SECONDARY).pack(anchor='ne')
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
Â  Â  Â  Â  tk.Label(left_cart_frame, text="ğŸ§¾ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", font=FONT_BOLD, bg=PANEL_COLOR, fg="white").pack(pady=(5,0))
Â  Â  Â  Â Â 
Â  Â  Â  Â  cols = ('item', 'qty', 'price', 'total', 'note', 'action')
Â  Â  Â  Â  self.tree = ttk.Treeview(left_cart_frame, columns=cols, show='headings', selectmode='browse')
Â  Â  Â  Â  self.tree.heading('item', text='Ø§Ù„ØµÙ†Ù')
Â  Â  Â  Â  self.tree.heading('qty', text='Ø§Ù„ÙƒÙ…ÙŠØ©')
Â  Â  Â  Â  self.tree.heading('price', text='Ø§Ù„Ø³Ø¹Ø±')
Â  Â  Â  Â  self.tree.heading('total', text='Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ')
Â  Â  Â  Â  self.tree.heading('note', text='Ù…Ù„Ø§Ø­Ø¸Ø§Øª')
Â  Â  Â  Â  self.tree.heading('action', text='')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.tree.column('item', width=120, anchor='e')
Â  Â  Â  Â  self.tree.column('qty', width=50, anchor='center')
Â  Â  Â  Â  self.tree.column('price', width=70, anchor='center')
Â  Â  Â  Â  self.tree.column('total', width=70, anchor='center')
Â  Â  Â  Â  self.tree.column('note', width=90, anchor='e')
Â  Â  Â  Â  self.tree.column('action', width=40, anchor='center')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.tree.pack(fill='both', expand=True, padx=5)
Â  Â  Â  Â  self.tree.bind("<Button-1>", self.on_tree_click)
Â  Â  Â  Â  self.tree.bind("<Double-1>", self.on_item_double_click)
Â  Â  Â  Â Â 
Â  Â  Â  Â  # === Ø§Ù„ÙŠÙ…ÙŠÙ†: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø¨Ø­Ø« ===
Â  Â  Â  Â  right_products_frame = tk.Frame(paned, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  paned.add(right_products_frame, minsize=550)
Â  Â  Â  Â Â 
Â  Â  Â  Â  search_frame = tk.Frame(right_products_frame, bg=PANEL_COLOR, padx=10, pady=10)
Â  Â  Â  Â  search_frame.pack(fill='x', pady=(0, 5))
Â  Â  Â  Â  tk.Label(search_frame, text="ğŸ” Ø¨Ø­Ø«:", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(side='right', padx=5)
Â  Â  Â  Â  tk.Entry(search_frame, textvariable=self.search_var, font=FONT_MAIN, bg="#F2F2F7", relief='flat').pack(side='right', fill='x', expand=True, ipady=3)
Â  Â  Â  Â Â 
Â  Â  Â  Â  products_container = tk.Frame(right_products_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  products_container.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.canvas_products = tk.Canvas(products_container, bg=BG_MAIN_COLOR, highlightthickness=0)
Â  Â  Â  Â  self.scroll_y = ttk.Scrollbar(products_container, orient="vertical", command=self.canvas_products.yview)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.scrollable_frame = tk.Frame(self.canvas_products, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.scrollable_frame.bind("<Configure>", lambda e: self.canvas_products.configure(scrollregion=self.canvas_products.bbox("all")))
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.canvas_products.create_window((0, 0), window=self.scrollable_frame, anchor="ne")
Â  Â  Â  Â  self.canvas_products.configure(yscrollcommand=self.scroll_y.set)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.scroll_y.pack(side="left", fill="y")
Â  Â  Â  Â  self.canvas_products.pack(side="right", fill="both", expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.load_products_grid()
Â  Â  Â  Â  self.toggle_fields()

Â  Â  # --- Ø¯ÙˆØ§Ù„ Ù„ÙˆØ­Ø§Øª Ø§Ù„Ù…ÙØ§ØªÙŠØ­ ÙˆØ§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© ---
Â  Â  def open_phone_keypad(self, event):
Â  Â  Â  Â  PhoneKeypad(self.root, self.update_phone_from_keypad, self.phone_var.get())
Â  Â  Â  Â  return "break"
Â  Â Â 
Â  Â  def update_phone_from_keypad(self, val):
Â  Â  Â  Â  self.phone_var.set(val)

Â  Â  def open_text_keypad(self, var_obj, title, input_type):
Â  Â  Â  Â  dlg = CustomInputDialog(self.root, title, title, var_obj.get(), input_type)
Â  Â  Â  Â  if dlg.result is not None:
Â  Â  Â  Â  Â  Â  var_obj.set(dlg.result)
Â  Â  Â  Â  return "break"

Â  Â  # Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ÙˆÙ‚Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ø®ØµØµØ©
Â  Â  def open_time_keypad(self, event):
Â  Â  Â  Â  dlg = CustomInputDialog(self.root, "ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…/Ø§Ù„ØªÙˆØµÙŠÙ„", "Ø£Ø¯Ø®Ù„ Ø§Ù„ÙˆÙ‚Øª (HH:MM AM/PM)", self.pickup_time_var.get(), "time")
Â  Â  Â  Â  if dlg.result:
Â  Â  Â  Â  Â  Â  self.pickup_time_var.set(dlg.result)
Â  Â  Â  Â  return "break"

Â  Â  def set_payment_status(self, status):
Â  Â  Â  Â  self.payment_status_var.set(status)
Â  Â  Â  Â  if status == "paid":
Â  Â  Â  Â  Â  Â  self.btn_paid.config(bg=SUCCESS_COLOR, fg="white", state="normal", relief="sunken")
Â  Â  Â  Â  Â  Â  self.btn_unpaid.config(bg="#E0E0E0", fg="#666", state="normal", relief="raised")
Â  Â  Â  Â  Â  Â  self.lbl_total.config(fg=SUCCESS_COLOR)
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.btn_paid.config(bg="#E0E0E0", fg="#666", state="normal", relief="raised")
Â  Â  Â  Â  Â  Â  self.btn_unpaid.config(bg=DANGER_COLOR, fg="white", state="normal", relief="sunken")
Â  Â  Â  Â  Â  Â  self.lbl_total.config(fg=DANGER_COLOR)
Â  Â  Â  Â  Â  Â Â 
Â  Â  def on_tree_click(self, event):
Â  Â  Â  Â  region = self.tree.identify_region(event.x, event.y)
Â  Â  Â  Â  if region == "cell":
Â  Â  Â  Â  Â  Â  column = self.tree.identify_column(event.x)
Â  Â  Â  Â  Â  Â  if column == '#6':
Â  Â  Â  Â  Â  Â  Â  Â  item_id = self.tree.identify_row(event.y)
Â  Â  Â  Â  Â  Â  Â  Â  if item_id:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  index = self.tree.index(item_id)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if 0 <= index < len(self.cart):
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.cart.pop(index)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  self.update_cart_view()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  def on_item_double_click(self, event):
Â  Â  Â  Â  column = self.tree.identify_column(event.x)
Â  Â  Â  Â  if column == '#6': return
Â  Â  Â  Â  item_id = self.tree.identify_row(event.y)
Â  Â  Â  Â  if not item_id:
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â Â 
Â  Â  Â  Â  index = self.tree.index(item_id)
Â  Â  Â  Â  if 0 <= index < len(self.cart):
Â  Â  Â  Â  Â  Â  current_item = self.cart[index]
Â  Â  Â  Â  Â  Â  current_note = current_item.get('note', '')
Â  Â  Â  Â  Â  Â  sugs = current_item.get('suggestions', '')
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  dlg = NoteDialog(self.root, "Ù…Ù„Ø§Ø­Ø¸Ø© ÙˆØ¬Ø¨Ø©", f"Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø© Ù„Ù€ ({current_item['name']}):", current_note, suggestions_str=sugs)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if dlg.result is not None:
Â  Â  Â  Â  Â  Â  Â  Â  self.cart[index]['note'] = dlg.result
Â  Â  Â  Â  Â  Â  Â  Â  self.update_cart_view()

Â  Â  def on_phone_change(self, *args):
Â  Â  Â  Â  phone = self.phone_var.get()
Â  Â  Â  Â  if not phone.isdigit() and phone != "":
Â  Â  Â  Â  Â  Â  self.phone_var.set(''.join(filter(str.isdigit, phone)))
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â Â 
Â  Â  Â  Â  if len(phone) == 11:
Â  Â  Â  Â  Â  Â  self.phone_entry.config(fg=SUCCESS_COLOR)
Â  Â  Â  Â  Â  Â  self.fetch_customer_data(phone)
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.phone_entry.config(fg="black")
Â  Â  Â  Â Â 
Â  Â  Â  Â  if len(phone) > 11:
Â  Â  Â  Â  Â  Â  self.phone_var.set(phone[:11])
Â  Â  Â  Â  Â  Â  self.phone_entry.config(fg=SUCCESS_COLOR)
Â  Â  Â  Â  Â  Â Â 
Â  Â  def on_search_change(self, *args):
Â  Â  Â  Â  self.load_products_grid()
Â  Â  Â  Â Â 
Â  Â  def fetch_customer_data(self, phone):
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  c.execute("SELECT name, address FROM customers WHERE phone=?", (phone,))
Â  Â  Â  Â  res = c.fetchone()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  if res:
Â  Â  Â  Â  Â  Â  self.customer_name_var.set(res[0])
Â  Â  Â  Â  Â  Â  self.address_var.set(res[1] if res[1] else "")
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.customer_name_var.set("")
Â  Â  Â  Â  Â  Â  self.address_var.set("")
Â  Â  Â  Â  Â  Â Â 
Â  Â  def toggle_fields(self):
Â  Â  Â  Â  val = self.order_type.get()
Â  Â  Â  Â  self.addr_container.pack_forget()
Â  Â  Â  Â  self.time_container.pack_forget()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.time_container.pack(side='right', padx=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  if val == "takeaway":
Â  Â  Â  Â  Â  Â  self.lbl_time.config(text="ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:")
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.lbl_time.config(text="ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„:")
Â  Â  Â  Â  Â  Â  self.addr_container.pack(side='right', padx=5)
Â  Â  Â  Â  Â  Â  if len(self.phone_var.get()) == 11:
Â  Â  Â  Â  Â  Â  Â  Â  self.fetch_customer_data(self.phone_var.get())
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  def load_products_grid(self):
Â  Â  Â  Â  for widget in self.scrollable_frame.winfo_children(): widget.destroy()
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  search_term = self.search_var.get()
Â  Â  Â  Â Â 
Â  Â  Â  Â  query = "SELECT id, name, price, image, weight_based, card_color, suggestions FROM products"
Â  Â  Â  Â  params = []
Â  Â  Â  Â  if search_term:
Â  Â  Â  Â  Â  Â  query += " WHERE name LIKE ?"
Â  Â  Â  Â  Â  Â  params = [f'%{search_term}%']
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute(query, params)
Â  Â  Â  Â  products = c.fetchall()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  Â  Â  MAX_COLS = 5
Â  Â  Â  Â  row = 0
Â  Â  Â  Â  col = 0
Â  Â  Â  Â Â 
Â  Â  Â  Â  for pid, name, price, img_blob, weight_based, card_color, suggestions in products:
Â  Â  Â  Â  Â  Â  bg_color = card_color if card_color else "#FFFFFF"
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  card = tk.Frame(self.scrollable_frame, bg=bg_color, bd=0, relief="flat", highlightbackground="#E0E0E0", highlightthickness=1)
Â  Â  Â  Â  Â  Â  card.grid(row=row, column=MAX_COLS - 1 - col, padx=4, pady=4, sticky="nsew")
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  click_cmd = lambda e, p=pid, n=name, pr=price, w=weight_based, s=suggestions, c=bg_color: self.add_product_to_cart(p, n, pr, w, s, c)
Â  Â  Â  Â  Â  Â  card.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  img_frame = tk.Frame(card, bg=bg_color, height=80, width=120)
Â  Â  Â  Â  Â  Â  img_frame.pack_propagate(False)
Â  Â  Â  Â  Â  Â  img_frame.pack()
Â  Â  Â  Â  Â  Â  img_frame.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if img_blob:
Â  Â  Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image = Image.open(io.BytesIO(img_blob))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image = image.resize((120, 80), Image.Resampling.LANCZOS)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  photo = ImageTk.PhotoImage(image)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl = tk.Label(img_frame, image=photo, bg=bg_color)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl.image = photo
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl.pack()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl_icon = tk.Label(img_frame, text="ğŸ–", font=("Segoe UI", 24), bg=bg_color, fg="#CCC")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl_icon.pack(expand=True, fill='both')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lbl_icon.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  lbl_icon = tk.Label(img_frame, text="ğŸ–", font=("Segoe UI", 24), bg=bg_color, fg="#CCC")
Â  Â  Â  Â  Â  Â  Â  Â  lbl_icon.pack(expand=True, fill='both')
Â  Â  Â  Â  Â  Â  Â  Â  lbl_icon.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  info_frame = tk.Frame(card, bg=bg_color, pady=2)
Â  Â  Â  Â  Â  Â  info_frame.pack(fill='x')
Â  Â  Â  Â  Â  Â  info_frame.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  name_lbl = tk.Label(info_frame, text=name, font=("Segoe UI", 10, "bold"), bg=bg_color, fg=TEXT_COLOR, wraplength=110)
Â  Â  Â  Â  Â  Â  name_lbl.pack()
Â  Â  Â  Â  Â  Â  name_lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  unit = "ÙƒØºÙ…" if weight_based else "Ù‚Ø·Ø¹Ø©"
Â  Â  Â  Â  Â  Â  price_color = ACCENT_COLOR if weight_based else SUCCESS_COLOR
Â  Â  Â  Â  Â  Â  price_lbl = tk.Label(info_frame, text=f"{price:,.0f} Ø¯.Ø¹", font=("Segoe UI", 9), bg=bg_color, fg=price_color)
Â  Â  Â  Â  Â  Â  price_lbl.pack()
Â  Â  Â  Â  Â  Â  price_lbl.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  bar = tk.Frame(card, bg=price_color, height=3)
Â  Â  Â  Â  Â  Â  bar.pack(fill='x', side='bottom')
Â  Â  Â  Â  Â  Â  bar.bind("<Button-1>", click_cmd)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  col += 1
Â  Â  Â  Â  Â  Â  if col >= MAX_COLS:
Â  Â  Â  Â  Â  Â  Â  Â  col = 0
Â  Â  Â  Â  Â  Â  Â  Â  row += 1
Â  Â  Â  Â  self.scrollable_frame.update_idletasks()
Â  Â  Â  Â  self.canvas_products.configure(scrollregion=self.canvas_products.bbox("all"))
Â  Â  Â  Â Â 
Â  Â  def add_product_to_cart(self, pid, name, price, weight_based, suggestions, color):
Â  Â  Â  Â  if weight_based:
Â  Â  Â  Â  Â  Â  NumericKeypad(self.root, lambda weight: self.add_weight_item(pid, name, price, weight, suggestions, color))
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  self.add_regular_item(pid, name, price, suggestions, color)
Â  Â  Â  Â  Â  Â Â 
Â  Â  def add_regular_item(self, pid, name, price, suggestions, color):
Â  Â  Â  Â  for item in self.cart:
Â  Â  Â  Â  Â  Â  if item['id'] == pid and not item['weight_based']:
Â  Â  Â  Â  Â  Â  Â  Â  item['qty'] += 1
Â  Â  Â  Â  Â  Â  Â  Â  item['total'] = item['qty'] * price
Â  Â  Â  Â  Â  Â  Â  Â  self.update_cart_view()
Â  Â  Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  self.cart.append({"id": pid, "name": name, "qty": 1, "price": price, "total": price, "weight_based": False, "note": "", "suggestions": suggestions, "color": color})
Â  Â  Â  Â  self.update_cart_view()
Â  Â  Â  Â Â 
Â  Â  def add_weight_item(self, pid, name, price, weight, suggestions, color):
Â  Â  Â  Â  self.cart.append({"id": pid, "name": name, "qty": weight, "price": price, "total": weight * price, "weight_based": True, "note": "", "suggestions": suggestions, "color": color})
Â  Â  Â  Â  self.update_cart_view()
Â  Â  Â  Â Â 
Â  Â  def update_cart_view(self):
Â  Â  Â  Â  for item in self.tree.get_children():
Â  Â  Â  Â  Â  Â  self.tree.delete(item)
Â  Â  Â  Â  grand_total = 0
Â  Â  Â  Â  for item in self.cart:
Â  Â  Â  Â  Â  Â  qty_val = item['qty']
Â  Â  Â  Â  Â  Â  qty_fmt = str(int(qty_val)) if qty_val == int(qty_val) else f"{qty_val:.3f}"
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # --- ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆØ²Ù†ÙŠØ© ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù€ POS ---
Â  Â  Â  Â  Â  Â  if item['weight_based']:
Â  Â  Â  Â  Â  Â  Â  Â  int_part = int(qty_val)
Â  Â  Â  Â  Â  Â  Â  Â  frac_part = qty_val - int_part
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø© ÙÙ‚Ø· (1ØŒ 2ØŒ 3...)
Â  Â  Â  Â  Â  Â  Â  Â  if abs(frac_part) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty_fmt = str(int_part)
Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  # Ù„Ù„ÙƒÙ…ÙŠØ§Øª Ù…Ø«Ù„ 1.5, 1.25, 1.75
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = ""
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if abs(frac_part - 0.25) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = "1/4"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elif abs(frac_part - 0.5) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = "1/2"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elif abs(frac_part - 0.75) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = "3/4"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = f"{frac_part:.3f}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if int_part > 0:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty_fmt = f"{int_part} Ùˆ {frac_str}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty_fmt = frac_str
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ø±Ø¶ "1" Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† "1.000"
Â  Â  Â  Â  Â  Â  Â  Â  if qty_fmt == "1 Ùˆ 0.000": qty_fmt = "1"
Â  Â  Â  Â  Â  Â  # --- Ù†Ù‡Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆØ²Ù†ÙŠØ© ---

Â  Â  Â  Â  Â  Â  note_display = f"ğŸ“ {item['note']}" if item['note'] else ""
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  row_color = item.get('color', '#FFFFFF')
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  self.tree.insert('', 'end', values=(item['name'], qty_fmt, f"{item['price']:,.0f}", f"{item['total']:,.0f}", note_display, "âŒ"), tags=(row_color,))
Â  Â  Â  Â  Â  Â  self.tree.tag_configure(row_color, background=row_color)
Â  Â  Â  Â  Â  Â  grand_total += item['total']
Â  Â  Â  Â  self.lbl_total.config(text=f"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: {grand_total:,.0f} Ø¯.Ø¹")
Â  Â  Â  Â Â 
Â  Â  def clear_cart(self):
Â  Â  Â  Â  self.cart = []
Â  Â  Â  Â  self.general_notes_var.set("")
Â  Â  Â  Â  self.update_cart_view()
Â  Â  Â  Â Â 
Â  Â  def retrieve_order_dialog(self, use_keypad=False):
Â  Â  Â  Â  if use_keypad:
Â  Â  Â  Â  Â  Â  dlg = CustomInputDialog(self.root, "Ø¥Ø±Ø¬Ø§Ø¹ ÙØ§ØªÙˆØ±Ø©", "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:", input_type="numeric")
Â  Â  Â  Â  Â  Â  oid = dlg.result
Â  Â  Â  Â  Â  Â  if oid:
Â  Â  Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oid = int(oid)
Â  Â  Â  Â  Â  Â  Â  Â  except ValueError:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± ØµØ§Ù„Ø­")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  oid = simpledialog.askinteger("Ø¥Ø±Ø¬Ø§Ø¹ ÙØ§ØªÙˆØ±Ø©", "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:")

Â  Â  Â  Â  if not oid: return
Â  Â  Â  Â Â 
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  c.execute("SELECT * FROM orders WHERE id=?", (oid,))
Â  Â  Â  Â  order = c.fetchone()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  Â  Â  if not order:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  msg = f"Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: {order[0]}\nØ§Ù„ØªØ§Ø±ÙŠØ®: {order[1]}\nØ§Ù„Ø²Ø¨ÙˆÙ†: {order[2]}\nØ§Ù„Ù‡Ø§ØªÙ: {order[3]}\n"
Â  Â  Â  Â  msg += f"Ø§Ù„ØªÙØ§ØµÙŠÙ„: {order[5]}\nØ§Ù„Ù…Ø¨Ù„Øº: {order[6]:,.0f} Ø¯.Ø¹\nØ§Ù„Ø­Ø§Ù„Ø©: {order[8]}\n"
Â  Â  Â  Â Â 
Â  Â  Â  Â  if order[8] == "Ù…Ø±ØªØ¬Ø¹":
Â  Â  Â  Â  Â  Â  Â messagebox.showinfo("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª", msg + "\n\nâš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ… Ø¥Ø±Ø¬Ø§Ø¹Ù‡Ø§ Ù…Ø³Ø¨Ù‚Ø§Ù‹.")
Â  Â  Â  Â  Â  Â  Â return
Â  Â  Â  Â  if messagebox.askyesno("ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", msg + "\n\nÙ‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ (Ø¥Ù„ØºØ§Ø¡) Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ"):
Â  Â  Â  Â  Â  Â  self.process_return(oid, order[6])
Â  Â  Â  Â  Â  Â Â 
Â  Â  def reprint_order_dialog(self, use_keypad=False):
Â  Â  Â  Â  if use_keypad:
Â  Â  Â  Â  Â  Â  dlg = CustomInputDialog(self.root, "Ø¥Ø¹Ø§Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø©", "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©:", input_type="numeric")
Â  Â  Â  Â  Â  Â  oid = dlg.result
Â  Â  Â  Â  Â  Â  if oid:
Â  Â  Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  oid = int(oid)
Â  Â  Â  Â  Â  Â  Â  Â  except ValueError:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± ØµØ§Ù„Ø­")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  oid = simpledialog.askinteger("Ø¥Ø¹Ø§Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø©", "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø·Ø¨Ø§Ø¹ØªÙ‡Ø§:")

Â  Â  Â  Â  if not oid: return
Â  Â  Â  Â Â 
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  c.execute("SELECT * FROM orders WHERE id=?", (oid,))
Â  Â  Â  Â  order = c.fetchone()
Â  Â  Â  Â  c.execute("SELECT product_name, qty, price, total, note FROM order_items WHERE order_id=?", (oid,))
Â  Â  Â  Â  items = c.fetchall()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  Â  Â  if not order:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â Â 
Â  Â  Â  Â  # ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø© (Cart format)
Â  Â  Â  Â  cart_items_for_print = []
Â  Â  Â  Â  for name, qty, price, total, note in items:
Â  Â  Â  Â  Â  Â  Â # Ù†Ø­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙˆØ²Ù†ÙŠØ© Ù„ØºØ±Ø¶ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø·
Â  Â  Â  Â  Â  Â  Â # Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£ÙØ¶Ù„ Ù‡ÙŠ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù‚ÙŠÙ…Ø© weight_based Ù…Ù† Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
Â  Â  Â  Â  Â  Â  Â # Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø£Ù…Ø±ØŒ Ø³Ù†ÙØªØ±Ø¶ Ø£Ù†Ù‡Ø§ Ù„ÙŠØ³Øª ÙˆØ²Ù†ÙŠØ© Ù…Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø·Ø±ÙŠÙ‚Ø© Ù„ØªØ­Ø¯ÙŠØ¯Ù‡Ø§
Â  Â  Â  Â  Â  Â  Â # Ù„ÙƒÙ† Ø¯Ø§Ù„Ø© print_receipt ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¢Ù†
Â  Â  Â  Â  Â  Â  Â is_weight = qty != int(qty)
Â  Â  Â  Â  Â  Â  Â cart_items_for_print.append({"name": name, "qty": qty, "price": price, "total": total, "weight_based": is_weight, "note": note})
Â  Â  Â  Â Â 
Â  Â  Â  Â  order_type_val = order[4]
Â  Â  Â  Â  time_val = order[9]
Â  Â  Â  Â  addr_val = order[10]
Â  Â  Â  Â  self.print_receipt(
Â  Â  Â  Â  Â  Â  oid=order[0],
Â  Â  Â  Â  Â  Â  name=order[2],
Â  Â  Â  Â  Â  Â  phone=order[3],
Â  Â  Â  Â  Â  Â  order_type=order_type_val,
Â  Â  Â  Â  Â  Â  time_str=time_val,
Â  Â  Â  Â  Â  Â  address_str=addr_val,
Â  Â  Â  Â  Â  Â  cart_items=cart_items_for_print,
Â  Â  Â  Â  Â  Â  total=order[6],
Â  Â  Â  Â  Â  Â  status=order[8],
Â  Â  Â  Â  Â  Â  g_note=order[7],
Â  Â  Â  Â  Â  Â  is_reprint=True
Â  Â  Â  Â  )

Â  Â  def process_return(self, oid, amount):
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  c.execute("UPDATE orders SET status='Ù…Ø±ØªØ¬Ø¹' WHERE id=?", (oid,))
Â  Â  Â  Â  now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
Â  Â  Â  Â  c.execute("INSERT INTO sales (date, order_id, amount, type) VALUES (?, ?, ?, ?)",
Â  Â  Â  Â  Â  Â  Â  Â  Â  (now, oid, -amount, "return"))
Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… {oid} Ø¨Ù†Ø¬Ø§Ø­.")
Â  Â  Â  Â  self.load_reports()
Â  Â  Â  Â Â 
Â  Â  def checkout(self):
Â  Â  Â  Â  if not self.cart:
Â  Â  Â  Â  Â  Â  messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  phone = self.phone_var.get()
Â  Â  Â  Â  name = self.customer_name_var.get()
Â  Â  Â  Â Â 
Â  Â  Â  Â  if len(phone) != 11 and phone != "":
Â  Â  Â  Â  Â  Â  Â  if not messagebox.askyesno("ØªÙ†Ø¨ÙŠÙ‡", "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„ (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 11 Ø±Ù‚Ù…). Ù…ØªØ§Ø¨Ø¹Ø©ØŸ"): return
Â  Â  Â  Â  if not name.strip(): name = "Ø²Ø¨ÙˆÙ† Ø¹Ø§Ù…"
Â  Â  Â  Â Â 
Â  Â  Â  Â  current_order_type = self.order_type.get()
Â  Â  Â  Â  address = self.address_var.get() if current_order_type == 'delivery' else ""
Â  Â  Â  Â  pickup_time = self.pickup_time_var.get()
Â  Â  Â  Â Â 
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  now = datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S")
Â  Â  Â  Â Â 
Â  Â  Â  Â  if phone:
Â  Â  Â  Â  Â  Â  c.execute("INSERT OR REPLACE INTO customers (phone, name, address, last_order_date) VALUES (?, ?, ?, ?)", (phone, name, address, now))
Â  Â  Â  Â Â 
Â  Â  Â  Â  total_val = sum(x['total'] for x in self.cart)
Â  Â  Â  Â Â 
Â  Â  Â  Â  details_list = []
Â  Â  Â  Â  for x in self.cart:
Â  Â  Â  Â  Â  Â  qty_val = x['qty']
Â  Â  Â  Â  Â  Â  qty_fmt = str(int(qty_val)) if abs(qty_val - int(qty_val)) < 0.001 else f"{qty_val:.3f}"
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  item_str = f"{x['name']} ({qty_fmt}{' ÙƒØºÙ…' if x['weight_based'] else ''})"
Â  Â  Â  Â  Â  Â  if x['note']:
Â  Â  Â  Â  Â  Â  Â  Â  item_str += f" [Ù…Ù„Ø§Ø­Ø¸Ø©: {x['note']}]"
Â  Â  Â  Â  Â  Â  details_list.append(item_str)
Â  Â  Â  Â  details = ", ".join(details_list)
Â  Â  Â  Â Â 
Â  Â  Â  Â  is_paid_status = self.payment_status_var.get()
Â  Â  Â  Â  status_text = "ÙˆØ§ØµÙ„" if is_paid_status == "paid" else "ØºÙŠØ± ÙˆØ§ØµÙ„"
Â  Â  Â  Â  general_note = self.general_notes_var.get()
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute('''INSERT INTO orders (date, customer_name, phone, type, details, total, notes, status, pickup_time, address, payment_status)
Â  Â  Â  Â  Â  Â  Â  Â  Â  VALUES (?,?,?,?,?,?,?,?,?,?,?)''',
Â  Â  Â  Â  Â  Â  Â  Â  Â  (now, name, phone, current_order_type, details, total_val, general_note, status_text, pickup_time, address, is_paid_status))
Â  Â  Â  Â Â 
Â  Â  Â  Â  order_id = c.lastrowid
Â  Â  Â  Â Â 
Â  Â  Â  Â  for x in self.cart:
Â  Â  Â  Â  Â  Â  c.execute("INSERT INTO order_items (order_id, product_name, qty, price, total, note) VALUES (?, ?, ?, ?, ?, ?)",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (order_id, x['name'], x['qty'], x['price'], x['total'], x['note']))
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute("INSERT INTO sales (date, order_id, amount, type) VALUES (?, ?, ?, ?)", (now, order_id, total_val, "order"))
Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.print_receipt(order_id, name, phone, current_order_type, pickup_time, address, self.cart, total_val, status_text, general_note)
Â  Â  Â  Â  self.clear_cart()
Â  Â  Â  Â  self.pickup_time_var.set(datetime.datetime.now().strftime("%I:%M %p")) # Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
Â  Â  Â  Â  self.customer_name_var.set("")
Â  Â  Â  Â  self.phone_var.set("")
Â  Â  Â  Â Â 
Â  Â  # --- Ø¯Ø§Ù„Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (ØªÙ… ØªØ¹Ø¯ÙŠÙ„ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆØ²Ù†) ---
Â  Â  def print_receipt(self, oid, name, phone, order_type, time_str, address_str, cart_items, total, status, g_note, is_reprint=False):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  # 1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙˆØ±Ø© (Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ù‚ÙŠØ§Ø³ÙŠ 80Ù…Ù… Ù‡Ùˆ Ø­ÙˆØ§Ù„ÙŠ 570 Ø¨ÙƒØ³Ù„)
Â  Â  Â  Â  Â  Â  PAPER_WIDTH = 570
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
Â  Â  Â  Â  Â  Â  items_count = len(cart_items)
Â  Â  Â  Â  Â  Â  estimated_height = 400 + (items_count * 50) + 400 # Ø±Ø£Ø³ + Ø¹Ù†Ø§ØµØ± + ØªØ°ÙŠÙŠÙ„
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø¥Ù†Ø´Ø§Ø¡ ØµÙˆØ±Ø© Ø¨ÙŠØ¶Ø§Ø¡ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
Â  Â  Â  Â  Â  Â  img = Image.new('RGB', (PAPER_WIDTH, estimated_height), color='white')
Â  Â  Â  Â  Â  Â  draw = ImageDraw.Draw(img)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ·
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  font_path = "C:\\Windows\\Fonts\\arial.ttf"
Â  Â  Â  Â  Â  Â  Â  Â  font_header = ImageFont.truetype(font_path, 30)
Â  Â  Â  Â  Â  Â  Â  Â  font_bold = ImageFont.truetype(font_path, 22)
Â  Â  Â  Â  Â  Â  Â  Â  font_reg = ImageFont.truetype(font_path, 20)
Â  Â  Â  Â  Â  Â  Â  Â  font_small = ImageFont.truetype(font_path, 18)
Â  Â  Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  Â  Â  font_header = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â  font_bold = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â  font_reg = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â  font_small = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø±Ø³Ù… Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
Â  Â  Â  Â  Â  Â  def draw_text_centered(text, y, font, color='black'):
Â  Â  Â  Â  Â  Â  Â  Â  reshaped_text = arabic_reshaper.reshape(str(text))
Â  Â  Â  Â  Â  Â  Â  Â  bidi_text = get_display(reshaped_text)
Â  Â  Â  Â  Â  Â  Â  Â  bbox = draw.textbbox((0, 0), bidi_text, font=font)
Â  Â  Â  Â  Â  Â  Â  Â  text_width = bbox[2] - bbox[0]
Â  Â  Â  Â  Â  Â  Â  Â  x = (PAPER_WIDTH - text_width) / 2
Â  Â  Â  Â  Â  Â  Â  Â  draw.text((x, y), bidi_text, font=font, fill=color)
Â  Â  Â  Â  Â  Â  Â  Â  return y + font.size + 10
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  def draw_text_right(text, y, font, margin=20, color='black'):
Â  Â  Â  Â  Â  Â  Â  Â  reshaped_text = arabic_reshaper.reshape(str(text))
Â  Â  Â  Â  Â  Â  Â  Â  bidi_text = get_display(reshaped_text)
Â  Â  Â  Â  Â  Â  Â  Â  bbox = draw.textbbox((0, 0), bidi_text, font=font)
Â  Â  Â  Â  Â  Â  Â  Â  text_width = bbox[2] - bbox[0]
Â  Â  Â  Â  Â  Â  Â  Â  x = PAPER_WIDTH - margin - text_width
Â  Â  Â  Â  Â  Â  Â  Â  draw.text((x, y), bidi_text, font=font, fill=color)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  def draw_text_left(text, y, font, margin=20, color='black'):
Â  Â  Â  Â  Â  Â  Â  Â  draw.text((margin, y), str(text), font=font, fill=color)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # --- Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ø±Ø³Ù… ---
Â  Â  Â  Â  Â  Â  y = 20
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # 1. Ø§Ù„Ù„ÙˆÙƒÙˆ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
Â  Â  Â  Â  Â  Â  logo_path = self.settings.get('logo_path', '')
Â  Â  Â  Â  Â  Â  if self.settings['receipt_design']['show_logo'] and logo_path and os.path.exists(logo_path):
Â  Â  Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logo = Image.open(logo_path)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  basewidth = 200
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wpercent = (basewidth / float(logo.size[0]))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hsize = int((float(logo.size[1]) * float(wpercent)))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logo = logo.resize((basewidth, hsize), Image.Resampling.LANCZOS)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  img.paste(logo, (int((PAPER_WIDTH - basewidth)/2), y))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y += hsize + 20
Â  Â  Â  Â  Â  Â  Â  Â  except: pass
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # 2. Ø±Ø£Ø³ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
Â  Â  Â  Â  Â  Â  header_text = self.settings['receipt_design']['header_text']
Â  Â  Â  Â  Â  Â  y = draw_text_centered(header_text, y, font_header)
Â  Â  Â  Â  Â  Â  y = draw_text_centered("07736161216", y, font_bold)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  draw.line((20, y, PAPER_WIDTH-20, y), fill="black", width=2)
Â  Â  Â  Â  Â  Â  y += 15
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  order_type_txt = "Ø³ÙØ±ÙŠ (Ø§Ø³ØªÙ„Ø§Ù…)" if order_type == "takeaway" else "ØªÙˆØµÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ"
Â  Â  Â  Â  Â  Â  draw_text_right(f"Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: {oid}", y, font_bold)
Â  Â  Â  Â  Â  Â  draw_text_left(datetime.datetime.now().strftime("%I:%M %p"), y, font_small)
Â  Â  Â  Â  Â  Â  y += 35
Â  Â  Â  Â  Â  Â  y = draw_text_centered(f"-- {order_type_txt} --", y, font_bold)
Â  Â  Â  Â  Â  Â  y += 10
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # 3. Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯
Â  Â  Â  Â  Â  Â  draw.rectangle((10, y, PAPER_WIDTH-10, y+35), fill="#EEE")
Â  Â  Â  Â  Â  Â  draw_text_right("Ø§Ù„Ù…Ø§Ø¯Ø©", y+5, font_bold, margin=30)
Â  Â  Â  Â  Â  Â  draw_text_centered("Ø§Ù„ÙƒÙ…ÙŠØ©", y+5, font_bold)
Â  Â  Â  Â  Â  Â  draw_text_left("Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ", y+5, font_bold, margin=30)
Â  Â  Â  Â  Â  Â  y += 45
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  def draw_row(name, qty, price, total_item, note="", weight_based=False):
Â  Â  Â  Â  Â  Â  Â  Â  nonlocal y
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  qty_val = qty
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # --- ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆØ²Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ---
Â  Â  Â  Â  Â  Â  Â  Â  qty_txt = str(int(qty_val)) if abs(qty_val - int(qty_val)) < 0.001 else f"{qty_val:.3f}"
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if weight_based:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  int_part = int(qty_val)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_part = qty_val - int_part
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if abs(frac_part) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty_txt = str(int_part) # 1 Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† 1.000
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = ""
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if abs(frac_part - 0.25) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = "1/4"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elif abs(frac_part - 0.5) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = "1/2"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  elif abs(frac_part - 0.75) < 0.001:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = "3/4"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  frac_str = f"{frac_part:.3f}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if int_part > 0:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty_txt = f"{int_part} Ùˆ {frac_str}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty_txt = frac_str
Â  Â  Â  Â  Â  Â  Â  Â  # --- Ù†Ù‡Ø§ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆØ²Ù†ÙŠØ© ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ---
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_left(f"{total_item:,.0f}", y, font_reg, margin=30)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  bbox = draw.textbbox((0, 0), qty_txt, font=font_reg)
Â  Â  Â  Â  Â  Â  Â  Â  q_w = bbox[2] - bbox[0]
Â  Â  Â  Â  Â  Â  Â  Â  draw.text(((PAPER_WIDTH/2) - (q_w/2), y), qty_txt, font=font_reg, fill="black")
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # Ø§Ù„Ø§Ø³Ù…
Â  Â  Â  Â  Â  Â  Â  Â  max_name_width = 250
Â  Â  Â  Â  Â  Â  Â  Â  name_disp = name
Â  Â  Â  Â  Â  Â  Â  Â  name_reshaped = get_display(arabic_reshaper.reshape(name))
Â  Â  Â  Â  Â  Â  Â  Â  if draw.textlength(name_reshaped, font_reg) > max_name_width:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â name_disp = name[:25] + "..."
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_right(name_disp, y, font_reg, margin=30)
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  y += 30
Â  Â  Â  Â  Â  Â  Â  Â  if note:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw_text_right(f"({note})", y, font_small, margin=30, color="#555")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y += 25
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  draw.line((30, y, PAPER_WIDTH-30, y), fill="#DDD", width=1)
Â  Â  Â  Â  Â  Â  Â  Â  y += 10
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  grand_total = 0
Â  Â  Â  Â  Â  Â  if isinstance(cart_items, list):
Â  Â  Â  Â  Â  Â  Â  Â  for item in cart_items:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  draw_row(item['name'], item['qty'], item['price'], item['total'], item.get('note', ''), item.get('weight_based', False))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grand_total += item['total']
Â  Â  Â  Â  Â  Â  else: # ÙÙŠ Ø­Ø§Ù„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø­ÙŠØ« Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ù‚Ø¯ ØªÙƒÙˆÙ† Ø³Ù„Ø³Ù„Ø© Ù†ØµÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  Â # ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙƒØ³Ù„Ø³Ù„Ø©ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ weight_basedØŒ ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø¹Ø±Ø¶Ù‡Ø§
Â  Â  Â  Â  Â  Â  Â  Â  items_str = str(cart_items).split(',')
Â  Â  Â  Â  Â  Â  Â  Â  for item_str in items_str:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â name_part = item_str.split('(')[0].strip()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â draw_row(name_part, "-", 0, 0, item_str) # ÙˆØ¶Ø¹ Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙƒÙ†Øµ Ù…Ù„Ø§Ø­Ø¸Ø©

Â  Â  Â  Â  Â  Â  # 4. Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
Â  Â  Â  Â  Â  Â  y += 10
Â  Â  Â  Â  Â  Â  draw.rectangle((10, y, PAPER_WIDTH-10, y+50), outline="black", width=2)
Â  Â  Â  Â  Â  Â  draw_text_right("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:", y+10, font_header, margin=40)
Â  Â  Â  Â  Â  Â  draw_text_left(f"{total:,.0f}", y+10, font_header, margin=40)
Â  Â  Â  Â  Â  Â  y += 70
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  draw_text_right(f"Ø§Ù„Ø²Ø¨ÙˆÙ†: {name}", y, font_bold)
Â  Â  Â  Â  Â  Â  y += 30
Â  Â  Â  Â  Â  Â  if phone:
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_right(f"Ù‡Ø§ØªÙ: {phone}", y, font_bold)
Â  Â  Â  Â  Â  Â  Â  Â  y += 30
Â  Â  Â  Â  Â  Â  if address_str:
Â  Â  Â  Â  Â  Â  Â  Â  addr_reshaped = get_display(arabic_reshaper.reshape(f"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: {address_str}"))
Â  Â  Â  Â  Â  Â  Â  Â  draw.text((PAPER_WIDTH - 20 - draw.textlength(addr_reshaped, font_reg), y), addr_reshaped, font=font_reg, fill="black")
Â  Â  Â  Â  Â  Â  Â  Â  y += 30
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if time_str:
Â  Â  Â  Â  Â  Â  Â  Â  y += 10
Â  Â  Â  Â  Â  Â  Â  Â  draw.rectangle((50, y, PAPER_WIDTH-50, y+40), fill="black")
Â  Â  Â  Â  Â  Â  Â  Â  reshaped_time = get_display(arabic_reshaper.reshape(f"Ø§Ù„ÙˆÙ‚Øª: {time_str}"))
Â  Â  Â  Â  Â  Â  Â  Â  w_time = draw.textlength(reshaped_time, font_bold)
Â  Â  Â  Â  Â  Â  Â  Â  draw.text(((PAPER_WIDTH-w_time)/2, y+5), reshaped_time, font=font_bold, fill="white")
Â  Â  Â  Â  Â  Â  Â  Â  y += 50
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if g_note:
Â  Â  Â  Â  Â  Â  Â  Â  draw_text_centered(f"Ù…Ù„Ø§Ø­Ø¸Ø§Øª: {g_note}", y, font_small)
Â  Â  Â  Â  Â  Â  Â  Â  y += 25
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # 5. Ø§Ù„ØªØ°ÙŠÙŠÙ„
Â  Â  Â  Â  Â  Â  y += 20
Â  Â  Â  Â  Â  Â  footer_text = self.settings['receipt_design']['footer_text']
Â  Â  Â  Â  Â  Â  draw_text_centered(footer_text, y, font_reg)
Â  Â  Â  Â  Â  Â  y += 40
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø©
Â  Â  Â  Â  Â  Â  final_img = img.crop((0, 0, PAPER_WIDTH, y))
Â  Â  Â  Â  Â  Â  self.send_image_to_printer(final_img)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©", str(e))
Â  Â  Â  Â  Â  Â  print(e)

Â  Â  # ... (Ø¨Ù‚ÙŠØ© Ø¯ÙˆØ§Ù„ RestaurantPOS)
Â  Â  def generate_daily_report(self):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  c.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='order_items'")
Â  Â  Â  Â  Â  Â  if not c.fetchone():
Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showerror("ØªÙ†Ø¨ÙŠÙ‡", "Ø¬Ø¯ÙˆÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.\nÙŠØ¬Ø¨ Ø¹Ù…Ù„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.")
Â  Â  Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  now_date = datetime.datetime.now().strftime("%Y-%m-%d")
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¥ØºÙ„Ø§Ù‚ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…
Â  Â  Â  Â  Â  Â  c.execute("SELECT date FROM daily_closings WHERE date=?", (now_date,))
Â  Â  Â  Â  Â  Â  if c.fetchone():
Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", f"âš ï¸ ØªÙ… Ø¬Ø±Ø¯ ÙŠÙˆÙ… **{now_date}** Ù…Ø³Ø¨Ù‚Ø§Ù‹.\n\nÙ„Ù† ÙŠØªÙ… Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.")
Â  Â  Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø¬Ù„Ø¨ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø·
Â  Â  Â  Â  Â  Â  c.execute("SELECT COUNT(*), SUM(total) FROM orders WHERE date LIKE ? AND status != 'Ù…Ø±ØªØ¬Ø¹'", (f"{now_date}%",))
Â  Â  Â  Â  Â  Â  summary = c.fetchone()
Â  Â  Â  Â  Â  Â  total_orders = summary[0] if summary[0] else 0
Â  Â  Â  Â  Â  Â  total_sales = summary[1] if summary[1] else 0
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  c.execute('''
Â  Â  Â  Â  Â  Â  Â  Â  SELECT product_name, SUM(qty), SUM(order_items.total)
Â  Â  Â  Â  Â  Â  Â  Â  FROM order_items
Â  Â  Â  Â  Â  Â  Â  Â  JOIN orders ON order_items.order_id = orders.id
Â  Â  Â  Â  Â  Â  Â  Â  WHERE orders.date LIKE ? AND orders.status != 'Ù…Ø±ØªØ¬Ø¹'
Â  Â  Â  Â  Â  Â  Â  Â  GROUP BY product_name
Â  Â  Â  Â  Â  Â  ''', (f"{now_date}%",))
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  items_summary = c.fetchall()
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if total_orders == 0:
Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showinfo("ØªÙ†Ø¨ÙŠÙ‡", "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.")
Â  Â  Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  msg = f"ØªÙ‚Ø±ÙŠØ± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ… ({now_date})\n--------------------------------\n"
Â  Â  Â  Â  Â  Â  msg += f"Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: {total_orders}\nØ¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: {total_sales:,.0f} Ø¯.Ø¹\n--------------------------------\n"
Â  Â  Â  Â  Â  Â  msg += "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠØŸ\n(Ø³ÙŠØªÙ… Ø®ØªÙ… Ø§Ù„ÙŠÙˆÙ… ÙˆÙ…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ø±Ø¯)."
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if messagebox.askyesno("Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…", msg):
Â  Â  Â  Â  Â  Â  Â  Â  self.print_daily_report_image(now_date, total_orders, total_sales, items_summary)
Â  Â  Â  Â  Â  Â  Â  Â  # Ø¥Ø¶Ø§ÙØ© Ø®ØªÙ… Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
Â  Â  Â  Â  Â  Â  Â  Â  c.execute("INSERT INTO daily_closings (date, total_sales, total_orders) VALUES (?, ?, ?)", (now_date, total_sales, total_orders))
Â  Â  Â  Â  Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  Â  Â  Â  Â  messagebox.showinfo("Ù†Ø¬Ø§Ø­", f"ØªÙ… Ø¥ØºÙ„Ø§Ù‚ ÙˆØ¬Ø±Ø¯ ÙŠÙˆÙ… **{now_date}** Ø¨Ù†Ø¬Ø§Ø­.")
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {str(e)}")
Â  Â  Â  Â  Â  Â Â 
Â  Â  # --- Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…ÙŠ ÙƒØµÙˆØ±Ø© (Ø¨Ø¯ÙˆÙ† PDF) ---
Â  Â  def print_daily_report_image(self, date_str, total_orders, total_sales, items_summary):
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  PAPER_WIDTH = 570
Â  Â  Â  Â  Â  Â  estimated_height = 400 + (len(items_summary) * 40) + 200
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  img = Image.new('RGB', (PAPER_WIDTH, estimated_height), color='white')
Â  Â  Â  Â  Â  Â  draw = ImageDraw.Draw(img)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  font_path = "C:\\Windows\\Fonts\\arial.ttf"
Â  Â  Â  Â  Â  Â  Â  Â  font_header = ImageFont.truetype(font_path, 30)
Â  Â  Â  Â  Â  Â  Â  Â  font_bold = ImageFont.truetype(font_path, 22)
Â  Â  Â  Â  Â  Â  Â  Â  font_reg = ImageFont.truetype(font_path, 20)
Â  Â  Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  Â  Â  font_header = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â  font_bold = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â  font_reg = ImageFont.load_default()
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  def draw_text_centered(text, y, font, color='black'):
Â  Â  Â  Â  Â  Â  Â  Â  reshaped_text = arabic_reshaper.reshape(str(text))
Â  Â  Â  Â  Â  Â  Â  Â  bidi_text = get_display(reshaped_text)
Â  Â  Â  Â  Â  Â  Â  Â  bbox = draw.textbbox((0, 0), bidi_text, font=font)
Â  Â  Â  Â  Â  Â  Â  Â  text_width = bbox[2] - bbox[0]
Â  Â  Â  Â  Â  Â  Â  Â  x = (PAPER_WIDTH - text_width) / 2
Â  Â  Â  Â  Â  Â  Â  Â  draw.text((x, y), bidi_text, font=font, fill=color)
Â  Â  Â  Â  Â  Â  Â  Â  return y + font.size + 10
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  y = 20
Â  Â  Â  Â  Â  Â  y = draw_text_centered("ØªÙ‚Ø±ÙŠØ± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙŠÙˆÙ…", y, font_header)
Â  Â  Â  Â  Â  Â  y = draw_text_centered(date_str, y, font_reg)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  draw.line((20, y, PAPER_WIDTH-20, y), fill="black", width=2)
Â  Â  Â  Â  Â  Â  y += 20
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø§Ù„Ù…Ù„Ø®Øµ Ø£ÙˆÙ„Ø§Ù‹
Â  Â  Â  Â  Â  Â  draw.rectangle((10, y, PAPER_WIDTH-10, y+80), outline="#007AFF", width=2)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  reshaped_orders = get_display(arabic_reshaper.reshape(f"Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: {total_orders}"))
Â  Â  Â  Â  Â  Â  draw.text((PAPER_WIDTH - 30 - draw.textlength(reshaped_orders, font_bold), y+10), reshaped_orders, font=font_bold, fill="black")
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  reshaped_sales = get_display(arabic_reshaper.reshape(f"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: {total_sales:,.0f} Ø¯.Ø¹"))
Â  Â  Â  Â  Â  Â  draw.text((PAPER_WIDTH - 30 - draw.textlength(reshaped_sales, font_bold), y+40), reshaped_sales, font=font_bold, fill="#28a745")
Â  Â  Â  Â  Â  Â  y += 100
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  draw.line((20, y, PAPER_WIDTH-20, y), fill="black", width=2)
Â  Â  Â  Â  Â  Â  y += 20
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  # Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„
Â  Â  Â  Â  Â  Â  draw.rectangle((10, y, PAPER_WIDTH-10, y+30), fill="#EEE")
Â  Â  Â  Â  Â  Â  reshaped_h1 = get_display(arabic_reshaper.reshape("Ø§Ù„Ù…Ø§Ø¯Ø©"))
Â  Â  Â  Â  Â  Â  draw.text((PAPER_WIDTH - 30 - draw.textlength(reshaped_h1, font_bold), y+5), reshaped_h1, font=font_bold, fill="black")
Â  Â  Â  Â  Â  Â  draw.text((20, y+5), get_display(arabic_reshaper.reshape("Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹")), font=font_bold, fill="black")
Â  Â  Â  Â  Â  Â  draw.text(((PAPER_WIDTH/2 - 20), y+5), get_display(arabic_reshaper.reshape("Ø§Ù„ÙƒÙ…ÙŠØ©")), font=font_bold, fill="gray")
Â  Â  Â  Â  Â  Â  y += 40
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for name, qty, total in items_summary:
Â  Â  Â  Â  Â  Â  Â  Â  name_fixed = get_display(arabic_reshaper.reshape(name))
Â  Â  Â  Â  Â  Â  Â  Â  draw.text((PAPER_WIDTH - 30 - draw.textlength(name_fixed, font_reg), y), name_fixed, font=font_reg, fill="black")
Â  Â  Â  Â  Â  Â  Â  Â  draw.text((20, y), f"{total:,.0f}", font=font_reg, fill="black")
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  # ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆØ²Ù†ÙŠØ©
Â  Â  Â  Â  Â  Â  Â  Â  qty_val = qty
Â  Â  Â  Â  Â  Â  Â  Â  qty_txt = str(int(qty_val)) if abs(qty_val - int(qty_val)) < 0.001 else f"{qty_val:.3f}"
Â  Â  Â  Â  Â  Â  Â  Â  draw.text(((PAPER_WIDTH/2 - 20), y), qty_txt, font=font_reg, fill="gray")
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  y += 30
Â  Â  Â  Â  Â  Â  Â  Â  draw.line((20, y, PAPER_WIDTH-20, y), fill="#EEE")
Â  Â  Â  Â  Â  Â  Â  Â  y += 5
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  y += 20
Â  Â  Â  Â  Â  Â  draw_text_centered("Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¹Ù…Ù„ÙƒÙ… Ø§Ù„Ø´Ø§Ù‚!", y, font_reg)
Â  Â  Â  Â  Â  Â  y += 40
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  final_img = img.crop((0, 0, PAPER_WIDTH, y))
Â  Â  Â  Â  Â  Â  self.send_image_to_printer(final_img)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", str(e))
Â  Â  Â  Â  Â  Â Â 
Â  Â  def send_image_to_printer(self, image):
Â  Â  Â  Â  """Ø¥Ø±Ø³Ø§Ù„ ÙƒØ§Ø¦Ù† ØµÙˆØ±Ø© PIL Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø·Ø§Ø¨Ø¹Ø© ÙˆÙŠÙ†Ø¯ÙˆØ²"""
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  selected_printers = self.settings.get('printers', ["Default"])
Â  Â  Â  Â  Â  Â  printer_name = selected_printers[0]
Â  Â  Â  Â  Â  Â  if printer_name == "Default" or printer_name == "Default Printer":
Â  Â  Â  Â  Â  Â  Â  Â  printer_name = win32print.GetDefaultPrinter()
Â  Â  Â  Â  Â  Â  hDC = win32ui.CreateDC()
Â  Â  Â  Â  Â  Â  hDC.CreatePrinterDC(printer_name)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  hDC.StartDoc("Receipt")
Â  Â  Â  Â  Â  Â  hDC.StartPage()
Â  Â  Â  Â  Â  Â  dib = ImageWin.Dib(image)
Â  Â  Â  Â  Â  Â  dib.draw(hDC.GetHandleOutput(), (0, 0, image.size[0], image.size[1]))
Â  Â  Â  Â  Â  Â  hDC.EndPage()
Â  Â  Â  Â  Â  Â  hDC.EndDoc()
Â  Â  Â  Â  Â  Â  hDC.DeleteDC()
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£ Ø·Ø§Ø¨Ø¹Ø©", f"Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø·Ø§Ø¨Ø¹Ø©.\n{str(e)}")
Â  Â  Â  Â  Â  Â Â 
Â  Â  def build_products_tab(self):
Â  Â  Â  Â  main_frame = tk.Frame(self.products_frame, bg=BG_MAIN_COLOR, padx=20, pady=20)
Â  Â  Â  Â  main_frame.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  side_panel = tk.Frame(main_frame, bg=PANEL_COLOR, width=350, relief='raised', bd=1, padx=15, pady=15)
Â  Â  Â  Â  side_panel.pack(side='right', fill='y', padx=(10, 0))
Â  Â  Â  Â  side_panel.pack_propagate(False)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(side_panel, text="â• Ø¥Ø¶Ø§ÙØ© ÙˆØ¬Ø¨Ø©", font=FONT_TITLE, bg=PANEL_COLOR, fg="white").pack(pady=(0, 20))
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.p_name = tk.StringVar()
Â  Â  Â  Â  self.p_price = tk.DoubleVar()
Â  Â  Â  Â  self.p_weight_based = tk.BooleanVar()
Â  Â  Â  Â  self.p_card_color = tk.StringVar(value="Ø£Ø¨ÙŠØ¶ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)")
Â  Â  Â  Â  self.p_suggestions = tk.StringVar()
Â  Â  Â  Â  self.p_image_path = None
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(side_panel, text="Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  p_name_entry = tk.Entry(side_panel, textvariable=self.p_name, font=FONT_MAIN, bg="#F9F9F9")
Â  Â  Â  Â  p_name_entry.pack(fill='x', pady=(5, 10), ipady=5)
Â  Â  Â  Â  p_name_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.p_name, "Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©", "arabic"))
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(side_panel, text="Ø§Ù„Ø³Ø¹Ø±", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  tk.Entry(side_panel, textvariable=self.p_price, font=FONT_MAIN, bg="#F9F9F9").pack(fill='x', pady=(5, 10), ipady=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(side_panel, text="Ù„ÙˆÙ† Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆØ¬Ø¨Ø© ğŸ¨", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  cb_colors = ttk.Combobox(side_panel, textvariable=self.p_card_color, values=list(CARD_COLORS.keys()), state="readonly", font=FONT_MAIN)
Â  Â  Â  Â  cb_colors.pack(fill='x', pady=(5, 10))
Â  Â  Â  Â  cb_colors.current(0)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(side_panel, text="Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)", bg=PANEL_COLOR, font=FONT_BOLD, fg="white").pack(anchor='e')
Â  Â  Â  Â  p_sug_entry = tk.Entry(side_panel, textvariable=self.p_suggestions, font=("Segoe UI", 10), bg="#F9F9F9")
Â  Â  Â  Â  p_sug_entry.pack(fill='x', pady=(5, 10), ipady=5)
Â  Â  Â  Â  p_sug_entry.bind("<Button-1>", lambda e: self.open_text_keypad(self.p_suggestions, "Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª", "arabic"))

Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Checkbutton(side_panel, text="Ø¨ÙŠØ¹ Ø¨Ø§Ù„ÙˆØ²Ù† (ÙƒØºÙ…) âš–ï¸", variable=self.p_weight_based, bg=PANEL_COLOR, font=FONT_MAIN, fg="white", selectcolor=PANEL_COLOR).pack(anchor='e', pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(side_panel, text="ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© ğŸ–¼ï¸", command=self.upload_image, bg=SECONDARY_COLOR, fg="white", font=FONT_MAIN, relief='flat').pack(fill='x', pady=5)
Â  Â  Â  Â  self.lbl_img_path = tk.Label(side_panel, text="Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©", bg=PANEL_COLOR, fg="#DDD")
Â  Â  Â  Â  self.lbl_img_path.pack()
Â  Â  Â  Â Â 
Â  Â  Â  Â  save_btn = tk.Button(side_panel, text="ğŸ’¾ Ø­Ù€ÙÙ€Ø¸ Ø§Ù„Ù€ÙˆØ¬Ù€Ø¨Ù€Ø©", command=self.save_product,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â bg=SUCCESS_COLOR, fg="white", font=("Segoe UI", 20, "bold"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â height=1, relief='raised', bd=2, cursor="hand2")
Â  Â  Â  Â  save_btn.pack(fill='x', pady=0)
Â  Â  Â  Â Â 
Â  Â  Â  Â  list_frame = tk.Frame(main_frame, bg=BG_MAIN_COLOR)
Â  Â  Â  Â  list_frame.pack(side='left', fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(list_frame, text="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©", font=FONT_TITLE, bg=BG_MAIN_COLOR, fg=TEXT_COLOR).pack(anchor='e', pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  cols = ('id', 'name', 'price', 'type')
Â  Â  Â  Â  self.products_tree = ttk.Treeview(list_frame, columns=cols, show='headings')
Â  Â  Â  Â  self.products_tree.heading('id', text='#')
Â  Â  Â  Â  self.products_tree.heading('name', text='Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø©')
Â  Â  Â  Â  self.products_tree.heading('price', text='Ø§Ù„Ø³Ø¹Ø±')
Â  Â  Â  Â  self.products_tree.heading('type', text='Ø§Ù„Ù†ÙˆØ¹')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.products_tree.column('id', width=50, anchor='center')
Â  Â  Â  Â  self.products_tree.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  btn_frame = tk.Frame(list_frame, bg=BG_MAIN_COLOR, pady=10)
Â  Â  Â  Â  btn_frame.pack(fill='x')
Â  Â  Â  Â  tk.Button(btn_frame, text="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ”„", command=self.load_products_list, font=FONT_MAIN, bg="white").pack(side='right', padx=5)
Â  Â  Â  Â  tk.Button(btn_frame, text="Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ âŒ", command=self.delete_product, font=FONT_MAIN, bg=DANGER_COLOR, fg="white").pack(side='right', padx=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.load_products_list()
Â  Â  Â  Â Â 
Â  Â  def upload_image(self):
Â  Â  Â  Â  path = filedialog.askopenfilename(filetypes=[("Images", "*.jpg *.png *.jpeg")])
Â  Â  Â  Â  if path:
Â  Â  Â  Â  Â  Â  self.p_image_path = path
Â  Â  Â  Â  Â  Â  self.lbl_img_path.config(text=os.path.basename(path))
Â  Â  Â  Â  Â  Â Â 
Â  Â  def save_product(self):
Â  Â  Â  Â  if not self.p_name.get() or self.p_price.get() <= 0:
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", "ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  img = None
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  if self.p_image_path:
Â  Â  Â  Â  Â  Â  Â  Â  with open(self.p_image_path, 'rb') as f: img = f.read()
Â  Â  Â  Â  except: img = None
Â  Â  Â  Â Â 
Â  Â  Â  Â  color_hex = CARD_COLORS.get(self.p_card_color.get(), "#FFFFFF")
Â  Â  Â  Â  suggestions_txt = self.p_suggestions.get()
Â  Â  Â  Â Â 
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  c.execute("INSERT INTO products (name, price, image, category, weight_based, card_color, suggestions) VALUES (?,?,?,?,?,?,?)",
Â  Â  Â  Â  Â  Â  Â  Â  Â  (self.p_name.get(), self.p_price.get(), img, "Ø¹Ø§Ù…", 1 if self.p_weight_based.get() else 0, color_hex, suggestions_txt))
Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.search_var.set("")
Â  Â  Â  Â  self.load_products_list()
Â  Â  Â  Â  self.load_products_grid()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.p_name.set("")
Â  Â  Â  Â  self.p_price.set(0)
Â  Â  Â  Â  self.p_weight_based.set(False)
Â  Â  Â  Â  self.p_suggestions.set("")
Â  Â  Â  Â  self.p_card_color.set("Ø£Ø¨ÙŠØ¶ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)")
Â  Â  Â  Â  self.lbl_img_path.config(text="Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©")
Â  Â  Â  Â  self.p_image_path = None
Â  Â  Â  Â  messagebox.showinfo("ØªÙ…", "ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙˆØ¬Ø¨Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©")
Â  Â  Â  Â Â 
Â  Â  def load_products_list(self):
Â  Â  Â  Â  for i in self.products_tree.get_children(): self.products_tree.delete(i)
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â  c.execute("SELECT id, name, price, weight_based FROM products")
Â  Â  Â  Â  for r in c.fetchall():
Â  Â  Â  Â  Â  Â  t = "ÙˆØ²Ù†" if r[3] else "Ù‚Ø·Ø¹Ø©"
Â  Â  Â  Â  Â  Â  self.products_tree.insert('', 'end', values=(r[0], r[1], r[2], t))
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  def delete_product(self):
Â  Â  Â  Â  sel = self.products_tree.selection()
Â  Â  Â  Â  if not sel: return
Â  Â  Â  Â  pid = self.products_tree.item(sel[0])['values'][0]
Â  Â  Â  Â  if messagebox.askyesno("ØªØ£ÙƒÙŠØ¯", "Ø­Ø°Ù Ø§Ù„ÙˆØ¬Ø¨Ø©ØŸ"):
Â  Â  Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  Â  Â  conn.cursor().execute("DELETE FROM products WHERE id=?", (pid,))
Â  Â  Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  Â  Â  self.load_products_list()
Â  Â  Â  Â  Â  Â  self.load_products_grid()
Â  Â  Â  Â  Â  Â Â 
Â  Â  def build_reports_tab(self):
Â  Â  Â  Â  main_frame = tk.Frame(self.reports_frame, bg="#E6EBEF")
Â  Â  Â  Â  main_frame.pack(fill='both', expand=True, padx=0, pady=0)
Â  Â  Â  Â Â 
Â  Â  Â  Â  header_frame = tk.Frame(main_frame, bg="#CAD6DC", pady=10, padx=20, relief='raised', bd=1)
Â  Â  Â  Â  header_frame.pack(fill='x')
Â  Â  Â  Â  tk.Label(header_frame, text="ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙˆØ§ØªÙŠØ±", font=("Segoe UI", 16, "bold", "underline"), bg="#CAD6DC", fg="#333").pack(side='top', pady=(0,5))
Â  Â  Â  Â Â 
Â  Â  Â  Â  filter_frame = tk.Frame(header_frame, bg="#CAD6DC")
Â  Â  Â  Â  filter_frame.pack(side='top', fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.report_period = tk.StringVar(value="today")
Â  Â  Â  Â  modes = [("Ø§Ù„ÙŠÙˆÙ…", "today"), ("Ø£Ø³Ø¨ÙˆØ¹", "week"), ("Ø´Ù‡Ø±", "month"), ("Ø³Ù†Ø©", "year"), ("Ø§Ù„ÙƒÙ„", "all")]
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(filter_frame, text="Ø¹Ø±Ø¶ Ø­Ø³Ø¨:", bg="#CAD6DC", font=FONT_BOLD).pack(side='right', padx=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  for txt, val in modes:
Â  Â  Â  Â  Â  Â  rb = tk.Radiobutton(filter_frame, text=txt, variable=self.report_period, value=val,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â command=self.load_reports, bg="#CAD6DC", font=FONT_MAIN,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â selectcolor="white", indicatoron=0, width=8, relief='groove')
Â  Â  Â  Â  Â  Â  rb.pack(side='right', padx=2)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(filter_frame, text="ØªØµØ¯ÙŠØ± ğŸ“„", command=self.export_report, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD).pack(side='left', padx=10)
Â  Â  Â  Â  tk.Button(filter_frame, text="ØªØ­Ø¯ÙŠØ« ğŸ”„", command=self.load_reports, bg=PRIMARY_COLOR, fg="white", font=FONT_BOLD).pack(side='left', padx=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(filter_frame, text="Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ… (ØªÙ‚Ø±ÙŠØ± Ø¬Ø±Ø¯) ğŸ", command=self.generate_daily_report,
Â  Â  Â  Â  Â  Â  Â  Â  Â  bg="#FF9800", fg="white", font=FONT_BOLD, relief='raised', bd=2).pack(side='left', padx=20)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tree_frame = tk.Frame(main_frame, bg="white", padx=10, pady=10)
Â  Â  Â  Â  tree_frame.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  cols = ('seq', 'date', 'type', 'cust', 'total')
Â  Â  Â  Â  self.report_tree = ttk.Treeview(tree_frame, columns=cols, show='headings', selectmode='extended')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.report_tree.heading('seq', text='Øª')
Â  Â  Â  Â  self.report_tree.heading('date', text='Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª')
Â  Â  Â  Â  self.report_tree.heading('type', text='Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨')
Â  Â  Â  Â  self.report_tree.heading('cust', text='Ø§Ù„Ø²Ø¨ÙˆÙ†')
Â  Â  Â  Â  self.report_tree.heading('total', text='Ø§Ù„Ù…Ø¨Ù„Øº')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.report_tree.column('seq', width=50, anchor='center')
Â  Â  Â  Â  self.report_tree.column('date', width=150, anchor='center')
Â  Â  Â  Â  self.report_tree.column('type', width=100, anchor='center')
Â  Â  Â  Â  self.report_tree.column('cust', width=150, anchor='center')
Â  Â  Â  Â  self.report_tree.column('total', width=100, anchor='center')
Â  Â  Â  Â Â 
Â  Â  Â  Â  scrollbar = ttk.Scrollbar(tree_frame, orient="vertical", command=self.report_tree.yview)
Â  Â  Â  Â  self.report_tree.configure(yscrollcommand=scrollbar.set)
Â  Â  Â  Â  scrollbar.pack(side='right', fill='y')
Â  Â  Â  Â  self.report_tree.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø£Ø²Ø±Ø§Ø± Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
Â  Â  Â  Â  delete_btns_frame = tk.Frame(tree_frame, bg="white", pady=5)
Â  Â  Â  Â  delete_btns_frame.pack(fill='x', side='bottom')
Â  Â  Â  Â  tk.Button(delete_btns_frame, text="Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ğŸ—‘ï¸", command=self.delete_selected_reports, bg=DANGER_COLOR, fg="white", font=FONT_BOLD).pack(side='right', padx=5)
Â  Â  Â  Â  tk.Button(delete_btns_frame, text="Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ğŸ’£", command=self.delete_all_reports, bg="#8B0000", fg="white", font=FONT_BOLD).pack(side='right', padx=5)

Â  Â  Â  Â Â 
Â  Â  Â  Â  # Ø§Ù„Ù…Ù„Ø®Øµ (Ø£Ø³ÙÙ„)
Â  Â  Â  Â  summary_container = tk.Frame(main_frame, bg="#D5DBDB", pady=10, padx=20, relief='raised', bd=2)
Â  Â  Â  Â  summary_container.pack(fill='x', side='bottom')
Â  Â  Â  Â Â 
Â  Â  Â  Â  # ØªÙ… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„ÙŠØµØ¨Ø­ Ø§Ù„Ù…Ø¨Ù„Øº Ø£ÙˆÙ„Ø§Ù‹
Â  Â  Â  Â  total_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid")
Â  Â  Â  Â  total_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(total_frame, text="Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº", bg="#95A5A6", fg="white", font=("Segoe UI", 12, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_total_sales = tk.Label(total_frame, text="0", bg="white", font=("Segoe UI", 14, "bold"), fg=SUCCESS_COLOR, height=2)
Â  Â  Â  Â  self.lbl_total_sales.pack(fill='x')

Â  Â  Â  Â  disc_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid")
Â  Â  Â  Â  disc_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(disc_frame, text="Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±", bg="#95A5A6", fg="white", font=("Segoe UI", 12, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_count = tk.Label(disc_frame, text="0", bg="white", font=("Segoe UI", 14, "bold"), fg="#2C3E50", height=2)
Â  Â  Â  Â  self.lbl_count.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  # ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ Ù„Ù„ÙŠÙ…ÙŠÙ† Ø£ÙŠØ¶Ù‹Ø§
Â  Â  Â  Â  exp_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid")
Â  Â  Â  Â  exp_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(exp_frame, text="Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ", bg="#95A5A6", fg="white", font=("Segoe UI", 12, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_expenses = tk.Label(exp_frame, text="0", bg="white", font=("Segoe UI", 14, "bold"), fg=DANGER_COLOR, height=2)
Â  Â  Â  Â  self.lbl_expenses.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  net_frame = tk.Frame(summary_container, bg="#D5DBDB", borderwidth=2, relief="solid")
Â  Â  Â  Â  net_frame.pack(side='right', padx=10, fill='y')
Â  Â  Â  Â  tk.Label(net_frame, text="Ø§Ù„ØµØ§ÙÙŠ", bg="#95A5A6", fg="white", font=("Segoe UI", 12, "bold"), width=15).pack(fill='x')
Â  Â  Â  Â  self.lbl_net_profit = tk.Label(net_frame, text="0", bg="white", font=("Segoe UI", 14, "bold"), fg="#2C3E50", height=2)
Â  Â  Â  Â  self.lbl_net_profit.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.load_reports()
Â  Â  Â  Â Â 
Â  Â  def delete_selected_reports(self):
Â  Â  Â  Â  selected_items = self.report_tree.selection()
Â  Â  Â  Â  if not selected_items:
Â  Â  Â  Â  Â  Â  messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø£ÙƒØ«Ø± Ù„Ù„Ø­Ø°Ù.")
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  if not messagebox.askyesno("ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù", f"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù {len(selected_items)} ÙØ§ØªÙˆØ±Ø©ØŸ"):
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â Â 
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  for item in selected_items:
Â  Â  Â  Â  Â  Â  Â  Â  order_id = self.report_tree.item(item)['values'][0]
Â  Â  Â  Â  Â  Â  Â  Â  # Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
Â  Â  Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM orders WHERE id=?", (order_id,))
Â  Â  Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM order_items WHERE order_id=?", (order_id,))
Â  Â  Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM sales WHERE order_id=?", (order_id,))
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  Â  Â  messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­.")
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  conn.rollback()
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: {str(e)}")
Â  Â  Â  Â  finally:
Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  Â  Â  self.load_reports()
Â  Â  Â  Â  Â  Â Â 
Â  Â  def delete_all_reports(self):
Â  Â  Â  Â  if not messagebox.askyesno("ØªØ­Ø°ÙŠØ±! Ø­Ø°Ù Ø´Ø§Ù…Ù„", "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù **Ø¬Ù…ÙŠØ¹** Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡."):
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â Â 
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM orders")
Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM order_items")
Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM sales")
Â  Â  Â  Â  Â  Â  c.execute("DELETE FROM daily_closings")
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  conn.commit()
Â  Â  Â  Â  Â  Â  messagebox.showinfo("Ù†Ø¬Ø§Ø­", "ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ø³Ø¬Ù„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.")
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  conn.rollback()
Â  Â  Â  Â  Â  Â  messagebox.showerror("Ø®Ø·Ø£", f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù Ø§Ù„Ø´Ø§Ù…Ù„: {str(e)}")
Â  Â  Â  Â  finally:
Â  Â  Â  Â  Â  Â  conn.close()
Â  Â  Â  Â  Â  Â  self.load_reports()
Â  Â  Â  Â  Â  Â Â 
Â  Â  def load_reports(self):
Â  Â  Â  Â  for i in self.report_tree.get_children(): self.report_tree.delete(i)
Â  Â  Â  Â  conn = sqlite3.connect(self.db_name)
Â  Â  Â  Â  c = conn.cursor()
Â  Â  Â  Â Â 
Â  Â  Â  Â  period = self.report_period.get()
Â  Â  Â  Â  now = datetime.datetime.now()
Â  Â  Â  Â Â 
Â  Â  Â  Â  query = "SELECT id, date, type, customer_name, total, status FROM orders WHERE 1=1"
Â  Â  Â  Â  params = []
Â  Â  Â  Â Â 
Â  Â  Â  Â  if period == "today":
Â  Â  Â  Â  Â  Â  date_filter = now.strftime("%Y-%m-%d")
Â  Â  Â  Â  Â  Â  query += " AND date LIKE ?"
Â  Â  Â  Â  Â  Â  params.append(f"{date_filter}%")
Â  Â  Â  Â  elif period == "week":
Â  Â  Â  Â  Â  Â  d = (now - datetime.timedelta(days=7)).strftime("%Y-%m-%d")
Â  Â  Â  Â  Â  Â  query += " AND date >= ?"
Â  Â  Â  Â  Â  Â  params.append(d)
Â  Â  Â  Â  elif period == "month":
Â  Â  Â  Â  Â  Â  d = (now - datetime.timedelta(days=30)).strftime("%Y-%m-%d")
Â  Â  Â  Â  Â  Â  query += " AND date >= ?"
Â  Â  Â  Â  Â  Â  params.append(d)
Â  Â  Â  Â  elif period == "year":
Â  Â  Â  Â  Â  Â  d = (now - datetime.timedelta(days=365)).strftime("%Y-%m-%d")
Â  Â  Â  Â  Â  Â  query += " AND date >= ?"
Â  Â  Â  Â  Â  Â  params.append(d)
Â  Â  Â  Â Â 
Â  Â  Â  Â  query += " ORDER BY id DESC"
Â  Â  Â  Â Â 
Â  Â  Â  Â  c.execute(query, params)
Â  Â  Â  Â  rows = c.fetchall()
Â  Â  Â  Â Â 
Â  Â  Â  Â  total_sum = 0
Â  Â  Â  Â  count = 0
Â  Â  Â  Â Â 
Â  Â  Â  Â  for idx, r in enumerate(rows):
Â  Â  Â  Â  Â  Â  t_type = "Ø³ÙØ±ÙŠ" if r[2] == "takeaway" else "ØªÙˆØµÙŠÙ„"
Â  Â  Â  Â  Â  Â  if r[5] == "Ù…Ø±ØªØ¬Ø¹": t_type += " (Ù…Ø±ØªØ¬Ø¹)"
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  self.report_tree.insert('', 'end', values=(r[0], r[1][:16], t_type, r[3], f"{r[4]:,.0f}"))
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if r[5] != "Ù…Ø±ØªØ¬Ø¹":
Â  Â  Â  Â  Â  Â  Â  Â  total_sum += r[4]
Â  Â  Â  Â  Â  Â  count += 1
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  conn.close()
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.lbl_total_sales.config(text=f"{total_sum:,.0f}")
Â  Â  Â  Â  self.lbl_count.config(text=str(count))
Â  Â  Â  Â  self.lbl_net_profit.config(text=f"{total_sum:,.0f}")
Â  Â  Â  Â  self.lbl_expenses.config(text="0")
Â  Â  Â  Â Â 
Â  Â  def export_report(self):
Â  Â  Â  Â  path = filedialog.asksaveasfilename(defaultextension=".txt")
Â  Â  Â  Â  if path:
Â  Â  Â  Â  Â  Â  with open(path, 'w', encoding='utf-8') as f:
Â  Â  Â  Â  Â  Â  Â  Â  f.write("ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª\n")
Â  Â  Â  Â  Â  Â  Â  Â  f.write(f"Ø§Ù„ÙØªØ±Ø©: {self.report_period.get()}\n")
Â  Â  Â  Â  Â  Â  Â  Â  f.write("-" * 50 + "\n")
Â  Â  Â  Â  Â  Â  Â  Â  for item in self.report_tree.get_children():
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vals = self.report_tree.item(item)['values']
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  f.write(f"{vals}\n")
Â  Â  Â  Â  Â  Â  Â  Â  f.write("-" * 50 + "\n")
Â  Â  Â  Â  Â  Â  Â  Â  f.write(f"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: {self.lbl_total_sales.cget('text')}\n")
Â  Â  Â  Â  Â  Â  messagebox.showinfo("ØªÙ…", "ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ±")
Â  Â  Â  Â  Â  Â Â 
Â  Â  def build_settings_tab(self):
Â  Â  Â  Â  frame = tk.Frame(self.settings_frame, bg=BG_MAIN_COLOR, padx=30, pady=30)
Â  Â  Â  Â  frame.pack(fill='both', expand=True)
Â  Â  Â  Â Â 
Â  Â  Â  Â  p_frame = tk.LabelFrame(frame, text=" Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ø¨Ø¹Ø§Øª ", font=FONT_BOLD, bg=BG_MAIN_COLOR, padx=20, pady=20)
Â  Â  Â  Â  p_frame.pack(fill='x', pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  printers = [p[2] for p in win32print.EnumPrinters(win32print.PRINTER_ENUM_LOCAL)]
Â  Â  Â  Â  except: printers = ["Default"]
Â  Â  Â  Â Â 
Â  Â  Â  Â  self.printer_list = tk.Listbox(p_frame, selectmode='single', height=6, font=FONT_MAIN)
Â  Â  Â  Â  self.printer_list.pack(fill='x', pady=5)
Â  Â  Â  Â  for p in printers: self.printer_list.insert('end', p)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(p_frame, text="Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙƒØ·Ø§Ø¨Ø¹Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± ğŸ’¾", command=self.save_printers, bg=PRIMARY_COLOR, fg="white", font=FONT_MAIN).pack(pady=5)
Â  Â  Â  Â Â 
Â  Â  Â  Â  r_frame = tk.LabelFrame(frame, text=" ØªØµÙ…ÙŠÙ… Ø§Ù„ÙØ§ØªÙˆØ±Ø© ", font=FONT_BOLD, bg=BG_MAIN_COLOR, padx=20, pady=20)
Â  Â  Â  Â  r_frame.pack(fill='x', pady=10)
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(r_frame, text="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø©", bg=BG_MAIN_COLOR).pack(anchor='e')
Â  Â  Â  Â  self.h_text = tk.Entry(r_frame, font=FONT_MAIN)
Â  Â  Â  Â  self.h_text.insert(0, self.settings['receipt_design']['header_text'])
Â  Â  Â  Â  self.h_text.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Label(r_frame, text="ØªØ°ÙŠÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©", bg=BG_MAIN_COLOR).pack(anchor='e')
Â  Â  Â  Â  self.f_text = tk.Entry(r_frame, font=FONT_MAIN)
Â  Â  Â  Â  self.f_text.insert(0, self.settings['receipt_design']['footer_text'])
Â  Â  Â  Â  self.f_text.pack(fill='x')
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(r_frame, text="Ø§Ø®ØªÙŠØ§Ø± Ø´Ø¹Ø§Ø±", command=self.choose_logo, bg=SECONDARY_COLOR, fg="white").pack(pady=5)
Â  Â  Â  Â  self.s_logo_lbl = tk.Label(r_frame, text=self.settings['logo_path'], bg=BG_MAIN_COLOR)
Â  Â  Â  Â  self.s_logo_lbl.pack()
Â  Â  Â  Â Â 
Â  Â  Â  Â  tk.Button(r_frame, text="Ø­ÙØ¸ Ø§Ù„ØªØµÙ…ÙŠÙ… ğŸ’¾", command=self.save_design, bg=SUCCESS_COLOR, fg="white", font=FONT_BOLD).pack(pady=10)
Â  Â  Â  Â Â 
Â  Â  def save_printers(self):
Â  Â  Â  Â  idxs = self.printer_list.curselection()
Â  Â  Â  Â  if not idxs:
Â  Â  Â  Â  Â  Â  Â messagebox.showwarning("ØªÙ†Ø¨ÙŠÙ‡", "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ø¨Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹")
Â  Â  Â  Â  Â  Â  Â return
Â  Â  Â  Â Â 
Â  Â  Â  Â  selected_printer = self.printer_list.get(idxs[0])
Â  Â  Â  Â  self.settings['printers'] = [selected_printer]
Â  Â  Â  Â  self.save_settings()
Â  Â  Â  Â  messagebox.showinfo("ØªÙ…", f"ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·Ø§Ø¨Ø¹Ø©: {selected_printer}")
Â  Â  Â  Â Â 
Â  Â  def choose_logo(self):
Â  Â  Â  Â  p = filedialog.askopenfilename()
Â  Â  Â  Â  if p:
Â  Â  Â  Â  Â  Â  self.settings['logo_path'] = p
Â  Â  Â  Â  Â  Â  self.s_logo_lbl.config(text=p)
Â  Â  Â  Â  Â  Â Â 
Â  Â  def save_design(self):
Â  Â  Â  Â  self.settings['receipt_design']['header_text'] = self.h_text.get()
Â  Â  Â  Â  self.settings['receipt_design']['footer_text'] = self.f_text.get()
Â  Â  Â  Â  self.save_settings()
Â  Â  Â  Â  messagebox.showinfo("ØªÙ…", "Ø­ÙØ¸ Ø§Ù„ØªØµÙ…ÙŠÙ…")

def start_app():
Â  Â  root = tk.Tk()
Â  Â  app = RestaurantPOS(root)
Â  Â  root.mainloop()
Â  Â Â 
if __name__ == "__main__":
Â  Â  l_root = tk.Tk()
Â  Â  LoginWindow(l_root, start_app)
Â  Â  l_root.mainloop()  Ø§Ø±ÙŠØ¯ ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø³ÙØ±ÙŠ ÙŠÙƒÙˆÙ†Ø§Ù† Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„ Ø¹Ù† ÙƒØªØ§Ø¨Ø© ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ… Ø§Ù…ÙƒØ§Ù†ÙŠØ© ØªØ§ÙƒÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª Ù„Ø§Ù† Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± Ù…Ø®ÙÙŠ ÙˆØ§ÙŠØ¶Ø§ Ø¹Ù†Ø¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ø¹Ø§Ø¯Ø© Ø·Ø¨Ø§Ø¹Ø© Ù…Ø®ÙÙŠ Ø²Ø± Ø§Ù„ØªØ§ÙƒÙŠØ¯ ÙˆØ§Ø¬Ø¹Ù„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø±Ø¯ ÙÙ‚Ø· Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆÙŠÙƒÙˆÙ† Ø¨Ø´ÙƒÙ„ Ø¬Ù…ÙŠÙ„
